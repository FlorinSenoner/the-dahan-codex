---
phase: 03.1-spirit-board-polish
plan: 05
type: execute
wave: 2
depends_on: ["03.1-02"]
files_modified:
  - app/components/spirits/presence-track.tsx
  - app/components/spirits/presence-slot.tsx
autonomous: true

must_haves:
  truths:
    - "Presence tracks support flexible array structure"
    - "Slots have cursor-pointer on hover"
    - "Tracks have gradient backgrounds"
    - "Reclaim slots display correctly"
  artifacts:
    - path: "app/components/spirits/presence-track.tsx"
      provides: "Flexible track rendering supporting any number of tracks"
      contains: "tracks.map"
    - path: "app/components/spirits/presence-slot.tsx"
      provides: "Enhanced slot styling with gradient and pointer cursor"
      contains: "cursor-pointer"
  key_links:
    - from: "app/components/spirits/presence-track.tsx"
      to: "convex/schema.ts"
      via: "presenceTracks.tracks array"
      pattern: "tracks\\.map"
---

<objective>
Redesign presence track components to support flexible track array structure and improve visual design with gradient backgrounds and pointer cursor.

Purpose: Current implementation hardcodes exactly two tracks (energy, cardPlays) and lacks visual appeal. The new schema supports arbitrary track types for complex spirits like Serpent.

Output:
- Presence track component supporting dynamic track array
- Enhanced slot styling with gradients and cursor-pointer
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03.1-spirit-board-polish/03.1-RESEARCH.md
@.planning/phases/03.1-spirit-board-polish/03.1-02-SUMMARY.md
@app/components/spirits/presence-track.tsx
@app/components/spirits/presence-slot.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Presence Slot Component</name>
  <files>app/components/spirits/presence-slot.tsx</files>
  <action>
Update presence-slot.tsx with visual improvements:

1. Add cursor-pointer to slot button:
```typescript
className={cn(
  "w-11 h-11 min-w-[44px] min-h-[44px] rounded-full",
  "border-2 flex items-center justify-center",
  "cursor-pointer",  // ADD THIS
  "hover:bg-muted/50 hover:border-primary/50",
  "transition-colors",
  // ... rest of classes
)}
```

2. Accept trackColor prop for consistent theming:
```typescript
interface PresenceSlotProps {
  slot: {
    value: number | string;
    elements?: string[];
    reclaim?: boolean;
    innateUnlock?: string;
    specialAbility?: string;
  };
  index: number;
  trackColor?: "amber" | "blue" | "purple" | "emerald";
}
```

3. Update border color based on trackColor:
```typescript
const borderColors = {
  amber: "border-amber-500/50",
  blue: "border-blue-500/50",
  purple: "border-purple-500/50",
  emerald: "border-emerald-500/50",
};
```

4. Ensure reclaim slots display with distinct styling:
- Show "R" text for reclaim: true slots
- Use amber styling for reclaim indicator
- Keep existing tooltip functionality

5. Support innateUnlock and specialAbility in tooltip:
```typescript
{slot.innateUnlock && (
  <p className="text-xs">Unlocks: {slot.innateUnlock}</p>
)}
{slot.specialAbility && (
  <p className="text-xs">{slot.specialAbility}</p>
)}
```
  </action>
  <verify>
Run `pnpm typecheck` - no errors in presence-slot.tsx.
  </verify>
  <done>
Presence slot has cursor-pointer, supports trackColor prop, displays reclaim/innateUnlock/specialAbility correctly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Presence Track Component</name>
  <files>app/components/spirits/presence-track.tsx</files>
  <action>
Redesign presence-track.tsx for new schema structure:

1. Update interface for new schema:
```typescript
interface PresenceTrackProps {
  presenceTracks: {
    tracks: Array<{
      type: string;
      label: string;
      color?: string;
      slots: Array<{
        value: number | string;
        elements?: string[];
        reclaim?: boolean;
        innateUnlock?: string;
        specialAbility?: string;
      }>;
    }>;
  };
}
```

2. Create gradient background styles for each track:
```typescript
const trackGradients: Record<string, string> = {
  amber: "bg-gradient-to-r from-amber-500/15 via-amber-500/5 to-transparent",
  blue: "bg-gradient-to-r from-blue-500/15 via-blue-500/5 to-transparent",
  purple: "bg-gradient-to-r from-purple-500/15 via-purple-500/5 to-transparent",
  emerald: "bg-gradient-to-r from-emerald-500/15 via-emerald-500/5 to-transparent",
};

const trackLabelColors: Record<string, string> = {
  amber: "text-amber-400",
  blue: "text-blue-400",
  purple: "text-purple-400",
  emerald: "text-emerald-400",
};
```

3. Render tracks dynamically from array:
```typescript
export function PresenceTrack({ presenceTracks }: PresenceTrackProps) {
  if (!presenceTracks?.tracks?.length) {
    return <EmptyState />;
  }

  return (
    <section className="space-y-4 mt-6">
      <Heading variant="h3" as="h2">Presence Tracks</Heading>

      <div className="space-y-3">
        {presenceTracks.tracks.map((track) => (
          <div
            key={track.type}
            className={cn(
              "rounded-lg p-3",
              trackGradients[track.color || "amber"]
            )}
          >
            <div className="flex items-center gap-2 mb-2">
              <Text
                variant="small"
                className={cn(
                  "font-medium uppercase tracking-wider",
                  trackLabelColors[track.color || "amber"]
                )}
              >
                {track.label}
              </Text>
            </div>

            <div className="flex flex-wrap gap-2">
              {track.slots.map((slot, idx) => (
                <PresenceSlot
                  key={`${track.type}-${idx}`}
                  slot={slot}
                  index={idx}
                  trackColor={track.color as "amber" | "blue" | "purple"}
                />
              ))}
            </div>
          </div>
        ))}
      </div>
    </section>
  );
}
```

4. Handle backward compatibility - check if old format (energy/cardPlays direct fields):
```typescript
// Backward compatibility: convert old format to new
function normalizePresenceTracks(data: unknown): PresenceTrackProps["presenceTracks"] {
  if (data && typeof data === "object" && "tracks" in data) {
    return data as PresenceTrackProps["presenceTracks"];
  }

  // Old format: { energy: [...], cardPlays: [...] }
  const oldData = data as { energy?: unknown[]; cardPlays?: unknown[] };
  return {
    tracks: [
      oldData.energy && {
        type: "energy",
        label: "Energy/Turn",
        color: "amber",
        slots: oldData.energy,
      },
      oldData.cardPlays && {
        type: "cardPlays",
        label: "Card Plays",
        color: "blue",
        slots: oldData.cardPlays,
      },
    ].filter(Boolean),
  };
}
```

5. Keep existing 44px touch target sizing for WCAG compliance.
  </action>
  <verify>
Run `pnpm dev` and navigate to /spirits/river-surges-in-sunlight.
Verify: Two presence tracks shown with gradient backgrounds, cursor changes to pointer on hover, reclaim slot shows "R".
  </verify>
  <done>
Presence tracks render from flexible array, have gradient backgrounds, cursor-pointer on slots.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. Presence tracks show with gradient backgrounds
3. Slots have cursor-pointer on hover
4. Reclaim slots display "R" correctly
5. Component handles both old and new data formats
</verification>

<success_criteria>
- Presence track UAT issues resolved: gradient backgrounds, cursor-pointer
- Flexible array structure supports any number of tracks
- Backward compatible with old schema format
- Visual design improved with color-coded gradients per track type
</success_criteria>

<output>
After completion, create `.planning/phases/03.1-spirit-board-polish/03.1-05-SUMMARY.md`
</output>
