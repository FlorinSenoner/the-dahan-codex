---
phase: 03.1-spirit-board-polish
plan: 07
type: execute
wave: 3
depends_on: ["03.1-03", "03.1-04", "03.1-05", "03.1-06"]
files_modified:
  - app/routes/spirits.$slug.tsx
  - app/routes/spirits.$slug.$aspect.tsx
  - app/components/spirits/overview-section.tsx
  - app/components/spirits/external-links.tsx
autonomous: false

must_haves:
  truths:
    - "Overview section displays in sidebar on desktop"
    - "Overview section is collapsible on mobile"
    - "External links use consistent styling with credits page"
    - "All UAT issues from Phase 3 are addressed"
  artifacts:
    - path: "app/routes/spirits.$slug.tsx"
      provides: "Responsive layout with sidebar grid"
      contains: "lg:grid-cols"
    - path: "app/components/spirits/overview-section.tsx"
      provides: "Sidebar-compatible overview component"
      contains: "Collapsible"
    - path: "app/components/spirits/external-links.tsx"
      provides: "External links matching credits page style"
      contains: "ExternalLink"
  key_links:
    - from: "app/routes/spirits.$slug.tsx"
      to: "app/components/spirits/overview-section.tsx"
      via: "Sidebar aside element"
      pattern: "aside"
---

<objective>
Complete the Phase 3.1 polish by implementing responsive sidebar layout for overview/description and updating external links to match credits page styling.

Purpose: The overview section (radar chart, strengths, weaknesses) creates too much whitespace on desktop. Moving it to a sidebar improves layout. External links should match the credits page for consistency.

Output:
- Responsive two-column layout with sidebar on desktop
- Collapsible overview on mobile
- External links matching credits page styling
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03.1-spirit-board-polish/03.1-RESEARCH.md
@.planning/phases/03.1-spirit-board-polish/03.1-03-SUMMARY.md
@.planning/phases/03.1-spirit-board-polish/03.1-04-SUMMARY.md
@.planning/phases/03.1-spirit-board-polish/03.1-05-SUMMARY.md
@.planning/phases/03.1-spirit-board-polish/03.1-06-SUMMARY.md
@app/routes/spirits.$slug.tsx
@app/components/spirits/overview-section.tsx
@app/components/spirits/external-links.tsx
@app/routes/credits.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Responsive Sidebar Layout</name>
  <files>
    app/routes/spirits.$slug.tsx
    app/routes/spirits.$slug.$aspect.tsx
    app/components/spirits/overview-section.tsx
  </files>
  <action>
Update spirit detail routes and overview component for responsive sidebar:

**Pre-check:** Verify overview-section.tsx exists and imports PowerRadarChart before modifying.

1. Update overview-section.tsx to be sidebar-compatible:
```typescript
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from "@/components/ui/collapsible";
import { ChevronDown } from "lucide-react";
import { PowerRadarChart } from "./power-radar-chart"; // Verify this import exists

export function OverviewSection({ spirit }: OverviewSectionProps) {
  const content = (
    <div className="space-y-6">
      {spirit.description && (
        <Text variant="body" className="text-muted-foreground">
          {spirit.description}
        </Text>
      )}
      {spirit.powerRatings && <PowerRadarChart ratings={spirit.powerRatings} />}
      {spirit.strengths && <StrengthsList strengths={spirit.strengths} />}
      {spirit.weaknesses && <WeaknessesList weaknesses={spirit.weaknesses} />}
    </div>
  );

  return (
    <>
      {/* Mobile: Collapsible */}
      <Collapsible defaultOpen={false} className="lg:hidden">
        <CollapsibleTrigger className="w-full flex justify-between items-center py-3 px-4 bg-muted/30 rounded-lg">
          <span className="font-medium">Overview</span>
          <ChevronDown className="h-4 w-4 transition-transform duration-200 [&[data-state=open]>svg]:rotate-180" />
        </CollapsibleTrigger>
        <CollapsibleContent className="pt-4">
          {content}
        </CollapsibleContent>
      </Collapsible>

      {/* Desktop: Always visible */}
      <div className="hidden lg:block">
        {content}
      </div>
    </>
  );
}
```

2. Update spirits.$slug.tsx to use responsive grid layout:
```typescript
// In the main content area, after variant tabs:
<main className="p-4 lg:grid lg:grid-cols-[1fr_340px] lg:gap-8">
  {/* Left column: Main board content */}
  <div className="space-y-6">
    <GrowthPanel growth={spirit.growth} />
    <PresenceTrack presenceTracks={spirit.presenceTracks} />
    <InnatePowers innates={spirit.innates} />
    <SpecialRules specialRules={spirit.specialRules} />
    <CardHand uniquePowers={spirit.uniquePowers} />
    <ExternalLinks spiritName={spirit.name} wikiUrl={spirit.wikiUrl} />
  </div>

  {/* Right column: Sidebar (overview) */}
  <aside className="mt-6 lg:mt-0 lg:sticky lg:top-28 lg:self-start">
    <OverviewSection spirit={spirit} />
  </aside>
</main>
```

3. Apply same changes to spirits.$slug.$aspect.tsx.

4. Adjust sticky positioning to account for header (57px) and tabs (48px):
- Header: z-20, sticky top-0
- Tabs: z-10, sticky top-[57px]
- Sidebar: sticky top-28 (112px = 7rem)

5. On mobile, overview comes AFTER main content (natural document flow).
  </action>
  <verify>
Run `pnpm dev` and check at different viewport widths.
Desktop: Two-column layout with sidebar on right.
Mobile: Single column with collapsible overview after main content.
Verify overview-section.tsx imports and renders PowerRadarChart correctly.
  </verify>
  <done>
Responsive layout implemented with desktop sidebar and mobile collapsible overview.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update External Links Styling</name>
  <files>app/components/spirits/external-links.tsx</files>
  <action>
Update external-links.tsx to match credits page styling:

1. Import ExternalLink icon (same as credits page):
```typescript
import { ExternalLink } from "lucide-react";
```

2. Create ResourceLink component matching credits page SourceLink:
```typescript
interface ResourceLinkProps {
  href: string;
  label: string;
  description: string;
}

function ResourceLink({ href, label, description }: ResourceLinkProps) {
  return (
    <a
      href={href}
      target="_blank"
      rel="noopener noreferrer"
      className="flex items-start gap-3 p-3 rounded-lg bg-card border border-border hover:bg-muted/50 transition-colors"
    >
      <div className="flex-1">
        <div className="flex items-center gap-2">
          <span className="font-medium text-foreground">{label}</span>
          <ExternalLink className="h-3 w-3 text-muted-foreground" />
        </div>
        <p className="text-sm text-muted-foreground mt-0.5">{description}</p>
      </div>
    </a>
  );
}
```

3. Update main component to use spirit-specific descriptions:
```typescript
export function ExternalLinks({
  spiritName,
  wikiUrl,
}: {
  spiritName: string;
  wikiUrl?: string;
}) {
  const links = [
    wikiUrl && {
      href: wikiUrl,
      label: "Spirit Island Wiki",
      description: `Strategy guides and details for ${spiritName}`,
    },
    {
      href: "https://querki.net/u/darker/spirit-island-faq/",
      label: "Official FAQ",
      description: `Rules clarifications for ${spiritName}`,
    },
    {
      href: "https://sick.oberien.de/",
      label: "Card Catalogue",
      description: `Power card reference and combos`,
    },
  ].filter(Boolean);

  return (
    <section className="space-y-3 mt-8">
      <Heading variant="h3" as="h2">
        Resources
      </Heading>
      <div className="space-y-2">
        {links.map((link) => (
          <ResourceLink
            key={link.href}
            href={link.href}
            label={link.label}
            description={link.description}
          />
        ))}
      </div>
      {/* REMOVE: "Links open in a new tab" text */}
    </section>
  );
}
```

4. Remove the "Links open in a new tab" hint text (unnecessary).

5. Use consistent ExternalLink icon instead of different icons (BookOpen, HelpCircle, Search).
  </action>
  <verify>
Run `pnpm dev` and compare external links styling with /credits page.
Verify: Same card styling, ExternalLink icon, spirit-specific descriptions, no "Links open in a new tab" text.
  </verify>
  <done>
External links use consistent styling matching credits page.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 3.1 Spirit Board Polish - all 8 UAT gaps addressed</what-built>
  <how-to-verify>
1. Navigate to http://localhost:3000/spirits/river-surges-in-sunlight
2. Check variant tabs:
   - [ ] Base tab shows "Base" label
   - [ ] No vertical scroll on tab bar
   - [ ] Active tab has gradient highlight
   - [ ] No rounded corners on tabs
3. Check radar chart:
   - [ ] Visible on dark background
   - [ ] Spider web grid lines
   - [ ] Values plotted and readable
4. Check layout:
   - Desktop: Overview in sidebar on right
   - Mobile: Collapsible overview section
5. Check growth panel:
   - [ ] Shows 3 options (G1, G2, G3)
   - [ ] SVG icons for actions
   - [ ] G1/G2/G3 labels on hover
6. Check presence tracks:
   - [ ] Gradient backgrounds
   - [ ] Cursor pointer on hover
   - [ ] Reclaim slot shows "R"
7. Check innate powers:
   - [ ] Element SVG icons in thresholds
   - [ ] Speed/Range/Target header
8. Check cards:
   - [ ] Section titled "Cards"
   - [ ] Fast cards have amber outline
   - [ ] Slow cards have blue outline
   - [ ] Element SVG icons shown
9. Check external links:
   - [ ] Matches credits page styling
   - [ ] Spirit-specific descriptions
   - [ ] No "Links open in a new tab" text
10. Repeat checks on /spirits/lightnings-swift-strike
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe remaining issues</resume-signal>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. Desktop layout shows sidebar with overview
3. Mobile layout shows collapsible overview
4. External links match credits page styling
5. All 8 UAT gaps from Phase 3 addressed
</verification>

<success_criteria>
- Responsive sidebar layout implemented (desktop: sidebar, mobile: collapsible)
- External links use consistent styling with credits page
- All Phase 3.1 UAT issues addressed
- Visual verification passed by user
</success_criteria>

<output>
After completion, create `.planning/phases/03.1-spirit-board-polish/03.1-07-SUMMARY.md`
</output>
