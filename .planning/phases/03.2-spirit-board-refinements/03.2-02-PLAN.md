---
phase: 03.2-spirit-board-refinements
plan: 02
type: execute
wave: 2
depends_on: ["03.2-01"]
files_modified:
  - app/components/spirits/variant-tabs.tsx
  - app/routes/_authenticated/spirits/$spiritSlug.tsx
  - app/components/spirits/overview-section.tsx
autonomous: true

must_haves:
  truths:
    - "Aspect tabs use flat border-b-2 indicator (no gradient background)"
    - "Tabs scroll behind sticky header when page scrolls down"
    - "Header displays aspect name when tabs are scrolled out of view"
    - "Aspect nav bar does not render for spirits with 0 aspects"
    - "Tab triggers have 44px minimum height for touch targets"
    - "Complexity and element pills appear below spirit/aspect name, not in collapsible overview"
    - "Spirit description text is inside the collapsible overview section"
  artifacts:
    - path: "app/components/spirits/variant-tabs.tsx"
      provides: "Minimalist tabs with scroll detection"
      contains: "useInView"
    - path: "app/routes/_authenticated/spirits/$spiritSlug.tsx"
      provides: "Conditional tab rendering and header aspect name"
      contains: "aspects.length"
  key_links:
    - from: "app/components/spirits/variant-tabs.tsx"
      to: "react-intersection-observer"
      via: "useInView hook"
      pattern: "useInView.*rootMargin"
    - from: "app/routes/_authenticated/spirits/$spiritSlug.tsx"
      to: "variant-tabs.tsx"
      via: "conditional render based on aspects"
      pattern: "aspects\\.length.*VariantTabs"
---

<objective>
Implement minimalist aspect navigation with scroll-aware header updates - tabs use flat border indicator, scroll behind sticky header, and header shows aspect name when tabs are out of view.

Purpose: Cleaner visual hierarchy with less noise, better scroll experience, and proper context when tabs are hidden.
Output: Updated variant-tabs.tsx with useInView, updated spirit detail route with conditional rendering
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03.2-spirit-board-refinements/03.2-RESEARCH.md
@app/components/spirits/variant-tabs.tsx
@app/routes/_authenticated/spirits/$spiritSlug.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update variant-tabs with minimalist styling and scroll detection</name>
  <files>app/components/spirits/variant-tabs.tsx</files>
  <action>
1. Import useInView from react-intersection-observer

2. Add scroll detection:
   ```typescript
   const { ref: tabsRef, inView: tabsVisible } = useInView({
     threshold: 0,
     rootMargin: "-57px 0px 0px 0px", // Header height offset (negative shrinks detection area)
   });
   ```

3. Pass tabsVisible state to parent via callback prop:
   - Add `onVisibilityChange?: (visible: boolean) => void` to props
   - Call `onVisibilityChange?.(tabsVisible)` in useEffect when tabsVisible changes

4. Update TabsList styling - REMOVE gradient, use flat indicator:
   - Remove: `data-[state=active]:bg-gradient-to-r`, `from-primary/20`, gradient classes
   - Keep: `sticky top-[57px] z-10 w-full bg-background/95 backdrop-blur border-b border-border`
   - TabsTrigger: `min-h-[44px] min-w-fit shrink-0 cursor-pointer rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:text-foreground text-muted-foreground hover:text-foreground transition-colors`

5. Attach ref to TabsList: `ref={tabsRef}`

6. Ensure "Base" label shows for base spirit tab (already should be there, verify)
  </action>
  <verify>
   - `grep -q "useInView" app/components/spirits/variant-tabs.tsx` returns 0
   - `grep -q "onVisibilityChange" app/components/spirits/variant-tabs.tsx` returns 0
   - `grep -v "gradient" app/components/spirits/variant-tabs.tsx | grep -q "border-b-2"` returns 0 (has border, no gradient)
  </verify>
  <done>Variant tabs use flat border-b-2 indicator, useInView detects scroll position, visibility passed to parent</done>
</task>

<task type="auto">
  <name>Task 2: Add conditional tab rendering and header aspect name</name>
  <files>app/routes/_authenticated/spirits/$spiritSlug.tsx</files>
  <action>
1. Add state for tabs visibility:
   ```typescript
   const [tabsVisible, setTabsVisible] = useState(true);
   ```

2. Conditionally render VariantTabs only when aspects exist:
   ```typescript
   {aspects.length > 0 && (
     <VariantTabs
       base={spirit}
       aspects={aspects}
       onVisibilityChange={setTabsVisible}
     />
   )}
   ```

3. Update header to show aspect name when tabs scrolled away:
   - Find the header/title section (likely has spirit name)
   - When `!tabsVisible && currentAspect`, display aspect name instead of/below spirit name
   - Use subtle styling: smaller text, muted color, or badge format
   - Example: When viewing "Sunshine" aspect and tabs hidden, header shows "Sunshine" or "River - Sunshine"

4. Ensure proper handling for base spirits without aspects:
   - When aspects.length === 0, no VariantTabs renders
   - Header just shows spirit name (no aspect logic needed)

Note: The exact header structure may vary - adapt the aspect name display to fit existing layout. The goal is contextual awareness when tabs are hidden.
  </action>
  <verify>
   - `grep -q "aspects.length" app/routes/_authenticated/spirits/$spiritSlug.tsx` returns 0
   - `grep -q "tabsVisible" app/routes/_authenticated/spirits/$spiritSlug.tsx` returns 0
   - `grep -q "onVisibilityChange" app/routes/_authenticated/spirits/$spiritSlug.tsx` returns 0
  </verify>
  <done>Tabs only render for spirits with aspects, header shows aspect name when tabs scroll out of view</done>
</task>

<task type="auto">
  <name>Task 3: Extract pills below name and move description into overview</name>
  <files>app/routes/_authenticated/spirits/$spiritSlug.tsx, app/components/spirits/overview-section.tsx</files>
  <action>
1. In spirit detail route, restructure the layout:
   - Spirit/aspect name (h1)
   - Complexity and element pills directly below name (NOT inside collapsible)
   - OverviewSection component (collapsible) containing:
     - Spirit description text
     - Radar chart
     - Strengths/weaknesses

2. Update the spirit detail page layout:
   ```typescript
   {/* Spirit Name */}
   <Heading variant="h1">{displayName}</Heading>

   {/* Pills below name - always visible */}
   <div className="flex flex-wrap gap-2 mt-2">
     <ComplexityBadge complexity={spirit.complexity} modifier={spirit.complexityModifier} />
     {spirit.elements.map(el => <ElementBadge key={el} element={el} />)}
   </div>

   {/* Collapsible Overview with description inside */}
   <Collapsible defaultOpen>
     <CollapsibleTrigger>Overview</CollapsibleTrigger>
     <CollapsibleContent>
       {spirit.description && <Text variant="muted">{spirit.description}</Text>}
       <RadarChart ... />
       <StrengthsWeaknesses ... />
     </CollapsibleContent>
   </Collapsible>
   ```

3. Ensure the overview section is collapsible on mobile (use Radix Collapsible from shadcn)

4. Verify pills render correctly for both base spirits and aspects
  </action>
  <verify>
   - Visual check: Pills appear below spirit name, not inside collapsible section
   - Visual check: Description text is inside collapsible overview
   - `grep -q "Collapsible" app/routes/_authenticated/spirits/$spiritSlug.tsx || grep -q "Collapsible" app/components/spirits/overview-section.tsx` returns 0
  </verify>
  <done>Complexity/element pills extracted below name, description moved inside collapsible overview section</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` - No type errors
2. `pnpm dev` - Visit River Surges (has aspects):
   - Tabs show with flat border indicator (no gradient)
   - Scroll down - tabs go behind header
   - When tabs hidden, header shows current aspect name
3. Visit a spirit without aspects (if one exists in seed data):
   - No tabs render
   - Spirit detail page works normally
</verification>

<success_criteria>
- Gradient background removed from active tab
- Active tab indicated by border-b-2 primary color only
- Tabs sticky at top-[57px], scrolling page hides them behind header
- useInView detects when tabs leave viewport
- Header displays aspect name when tabs not visible
- VariantTabs component not rendered when aspects.length === 0
- Touch targets remain 44px minimum
- Complexity and element pills render below spirit name (always visible)
- Description text is inside collapsible overview section
- Overview section is collapsible
</success_criteria>

<output>
After completion, create `.planning/phases/03.2-spirit-board-refinements/03.2-02-SUMMARY.md`
</output>
