---
phase: 03.2-spirit-board-refinements
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/seed.ts
  - app/components/spirits/presence-slot.tsx
  - app/components/spirits/presence-track.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Complex spirits (Fractured Days, Starlight, Finder, Serpent) visible in spirit list"
    - "River presence track shows cyan/amber colors (not amber/blue)"
    - "Lightning presence track shows orange/violet colors"
  artifacts:
    - path: "convex/seed.ts"
      provides: "Removed hardcoded color fields from River/Lightning tracks"
    - path: "app/components/spirits/presence-slot.tsx"
      provides: "Extended trackColor type for all spirit colors"
    - path: "app/components/spirits/presence-track.tsx"
      provides: "Removed restrictive type cast"
  key_links:
    - from: "presence-track.tsx"
      to: "spirit-colors.ts"
      via: "getSpiritTrackColors function"
      pattern: "getSpiritTrackColors"
    - from: "presence-track.tsx"
      to: "presence-slot.tsx"
      via: "trackColor prop without type cast"
      pattern: "trackColor={color}"
---

<objective>
Fix presence track colors and populate complex spirits data.

Purpose: UAT test 10 revealed presence tracks showing wrong colors because seed.ts has hardcoded `color: "amber"` and `color: "blue"` fields that override spirit-colors.ts. Tests 15-18 require complex spirits data in database.
Output: Spirit-specific presence track colors working correctly, complex spirits visible in list.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@convex/seed.ts
@app/components/spirits/presence-slot.tsx
@app/components/spirits/presence-track.tsx
@app/lib/spirit-colors.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove hardcoded color fields from seed.ts</name>
  <files>convex/seed.ts</files>
  <action>
The seed.ts file has hardcoded `color: "amber"` and `color: "blue"` fields on River's presence tracks (and likely Lightning's too). These override the spirit-colors.ts mappings.

In `convex/seed.ts`, find River's presenceTracks (around lines 84-115) and remove the `color` field from both tracks:

```typescript
// BEFORE (River's energy track)
{
  type: "energy",
  label: "Energy/Turn",
  color: "amber",  // DELETE THIS LINE
  slots: [...]
}

// AFTER
{
  type: "energy",
  label: "Energy/Turn",
  slots: [...]
}
```

Do the same for:
- River's cardPlays track (remove `color: "blue"`)
- Lightning's energy track (if has hardcoded color)
- Lightning's cardPlays track (if has hardcoded color)

The color should be derived from spirit-colors.ts via getSpiritTrackColors(), not hardcoded in seed data.
  </action>
  <verify>
Search seed.ts for `color:` within presenceTracks - should find none for River/Lightning base spirits.
  </verify>
  <done>
River and Lightning seed data no longer has hardcoded track colors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix presence track type cast and run reseed</name>
  <files>app/components/spirits/presence-track.tsx</files>
  <action>
In `app/components/spirits/presence-track.tsx`, line 127-129 has a restrictive type cast:

```typescript
// BEFORE
trackColor={
  color as "amber" | "blue" | "purple" | "emerald"
}

// AFTER
trackColor={color}
```

The PresenceSlot component already accepts all 9 colors (amber, blue, purple, emerald, cyan, orange, violet, indigo, stone) based on the current presence-slot.tsx, so the cast is unnecessary and truncates values.

After fixing the code, run the reseed to update database:
```bash
npx convex run seed:reseedSpirits
```
  </action>
  <verify>
Run `pnpm typecheck` - no type errors.
Run `npx convex run seed:reseedSpirits` - completes without error.
Visit http://localhost:3000/spirits - confirm complex spirits appear.
Visit River spirit page - confirm presence tracks show cyan energy track, amber card plays track.
Visit Lightning spirit page - confirm presence tracks show orange energy track, violet card plays track.
  </verify>
  <done>
Spirit-specific presence track colors display correctly. Complex spirits visible in spirit list.
  </done>
</task>

</tasks>

<verification>
- [ ] No `color:` fields in River/Lightning presenceTracks in seed.ts
- [ ] No type cast in presence-track.tsx line ~128
- [ ] `pnpm typecheck` passes
- [ ] `npx convex run seed:reseedSpirits` completes
- [ ] Complex spirits visible at /spirits
- [ ] River tracks: cyan (energy), amber (card plays)
- [ ] Lightning tracks: orange (energy), violet (card plays)
</verification>

<success_criteria>
1. Seed data no longer overrides spirit-colors.ts mappings
2. Presence track colors match spirit-colors.ts definitions
3. Four complex spirits visible in spirit list
4. No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03.2-spirit-board-refinements/03.2-07-SUMMARY.md`
</output>
