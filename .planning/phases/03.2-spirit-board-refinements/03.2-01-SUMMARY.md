---
phase: 03.2-spirit-board-refinements
plan: 01
subsystem: ui
tags: [react-intersection-observer, convex, schema, spirit-colors, tailwind]

# Dependency graph
requires:
  - phase: 03.1-spirit-board-polish
    provides: Element icons, growth DSL, presence track foundations
provides:
  - react-intersection-observer for scroll detection
  - Spirit-specific track color palettes
  - Extended schema for complex spirits (Fractured Days, Finder, Starlight, Serpent)
affects: [03.2-02, 03.2-03, 03.2-04, complex-spirits]

# Tech tracking
tech-stack:
  added: [react-intersection-observer]
  patterns: [spirit-track-color-mapping, orActions-growth-pattern, branching-track-layout]

key-files:
  created: []
  modified:
    - app/lib/spirit-colors.ts
    - convex/schema.ts
    - package.json
    - knip.json

key-decisions:
  - "Spirit track colors derived from primary/secondary elements (e.g., River: Water/Sun = cyan/amber)"
  - "All schema fields optional for backward compatibility with existing data"
  - "orActions pattern for choose-from-multiple growth options"
  - "react-intersection-observer added to knip ignoreDependencies until used"

patterns-established:
  - "getSpiritTrackColors(slug) with amber/blue fallback for unknown spirits"
  - "trackGradientClasses mapping color names to gradient Tailwind classes"
  - "orActions array for complex growth choices"
  - "layout/connectsTo/connectionPoint for branching presence tracks"

# Metrics
duration: 2min
completed: 2026-01-26
---

# Phase 3.2 Plan 01: Foundation Summary

**React-intersection-observer for scroll detection, spirit-specific track colors based on elements, and schema extensions for complex spirits (Fractured Days, Finder, Starlight, Serpent)**

## Performance

- **Duration:** 2 min
- **Started:** 2026-01-26T23:25:35Z
- **Completed:** 2026-01-26T23:27:36Z
- **Tasks:** 2
- **Files modified:** 4

## Accomplishments

- Installed react-intersection-observer ^10.0.2 for future scroll-aware tabs
- Added spiritTrackColors mapping for 6 spirits with element-derived palettes
- Extended schema with orActions, repeat, layout, connectsTo, connectionPoint, unlocksGrowth, presenceCap
- All existing spirit data remains valid (backward compatible additions)

## Task Commits

Each task was committed atomically:

1. **Task 1: Install react-intersection-observer and add spirit track colors** - `e96ece9` (feat)
2. **Task 2: Extend schema for complex spirit patterns** - `30959f3` (feat)

## Files Created/Modified

- `package.json` - Added react-intersection-observer dependency
- `pnpm-lock.yaml` - Lock file updated
- `knip.json` - Added react-intersection-observer to ignoreDependencies, removed unused recharts
- `app/lib/spirit-colors.ts` - Added spiritTrackColors, trackGradientClasses, getSpiritTrackColors
- `convex/schema.ts` - Extended growth and presenceTracks schema for complex spirits

## Decisions Made

- Spirit track colors based on primary/secondary elements:
  - River Surges in Sunlight: cyan/amber (Water/Sun)
  - Lightning's Swift Strike: orange/violet (Fire/Air)
  - Fractured Days Split the Sky: indigo/violet (Moon/Air)
  - Starlight Seeks Its Form: indigo/amber (Moon/Sun)
  - Finder of Paths Unseen: violet/emerald (Air/Plant)
  - Serpent Slumbering Beneath the Island: orange/stone (Fire/Earth)
- Default fallback: amber/blue for unknown spirits
- All schema extensions are optional to maintain backward compatibility

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Updated knip.json for react-intersection-observer**
- **Found during:** Task 1 (pre-commit hook failure)
- **Issue:** Knip flagged react-intersection-observer as unused dependency
- **Fix:** Added to ignoreDependencies since it will be used in plan 03.2-02
- **Files modified:** knip.json
- **Verification:** Pre-commit hooks pass
- **Committed in:** e96ece9 (Task 1 commit)

---

**Total deviations:** 1 auto-fixed (1 blocking)
**Impact on plan:** Necessary for clean commit. No scope creep.

## Issues Encountered

None

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- react-intersection-observer available for import in variant-tabs.tsx (plan 03.2-02)
- spiritTrackColors and getSpiritTrackColors ready for presence-track.tsx integration
- Schema ready to accept complex spirit data (Fractured Days, Finder, Starlight, Serpent)
- All existing spirit data remains valid

---
*Phase: 03.2-spirit-board-refinements*
*Completed: 2026-01-26*
