---
phase: 03-spirit-detail-board
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - package.json
  - app/components/ui/tabs.tsx
  - app/components/ui/accordion.tsx
  - app/components/ui/collapsible.tsx
  - app/components/ui/tooltip.tsx
  - app/components/spirits/variant-tabs.tsx
  - app/routes/spirits.$slug.tsx
  - app/routes/spirits.$slug.$aspect.tsx
autonomous: true

must_haves:
  truths:
    - "Recharts is installed and importable"
    - "shadcn/ui Tabs, Accordion, Collapsible, Tooltip components are installed"
    - "Variant tabs show base spirit and all aspects"
    - "Clicking a variant tab navigates to the correct URL"
    - "URL state syncs with active tab selection"
  artifacts:
    - path: "app/components/ui/tabs.tsx"
      provides: "shadcn/ui Tabs component"
      exports: ["Tabs", "TabsList", "TabsTrigger", "TabsContent"]
    - path: "app/components/spirits/variant-tabs.tsx"
      provides: "URL-synced variant selector"
      min_lines: 40
    - path: "app/routes/spirits.$slug.tsx"
      provides: "Spirit detail layout with tabs"
      contains: "VariantTabs"
  key_links:
    - from: "app/components/spirits/variant-tabs.tsx"
      to: "app/routes/spirits.$slug.tsx"
      via: "component import"
      pattern: "import.*VariantTabs"
    - from: "app/components/spirits/variant-tabs.tsx"
      to: "URL params"
      via: "useParams and navigate"
      pattern: "useNavigate|navigate.*to:"
---

<objective>
Install Phase 3 dependencies and build the variant tabs component that enables switching between base spirit and aspects.

Purpose: UI infrastructure for spirit detail page - tabs enable the variant selector requirement (DTAIL-02, DTAIL-03).
Output: Recharts installed, shadcn/ui components installed, variant tabs working with URL sync.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-spirit-detail-board/03-CONTEXT.md
@.planning/phases/03-spirit-detail-board/03-RESEARCH.md
@.planning/phases/03-spirit-detail-board/03-01-SUMMARY.md
@app/routes/spirits.$slug.tsx
@app/routes/spirits.$slug.$aspect.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies</name>
  <files>package.json</files>
  <action>
Install recharts and shadcn/ui components:

```bash
pnpm add recharts
pnpm dlx shadcn@latest add tabs accordion collapsible tooltip
```

After installation, verify the components were added:
- app/components/ui/tabs.tsx
- app/components/ui/accordion.tsx
- app/components/ui/collapsible.tsx
- app/components/ui/tooltip.tsx

If shadcn prompts for configuration, use existing settings (already configured in project).
  </action>
  <verify>Run `pnpm typecheck` and verify new files exist in app/components/ui/</verify>
  <done>recharts and all 4 shadcn components installed</done>
</task>

<task type="auto">
  <name>Task 2: Create VariantTabs component</name>
  <files>app/components/spirits/variant-tabs.tsx</files>
  <action>
Create a new component that renders horizontal tabs for base spirit and aspects with URL synchronization.

```typescript
import { Tabs, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useNavigate, useParams } from "@tanstack/react-router";
import type { Doc } from "convex/_generated/dataModel";

interface VariantTabsProps {
  base: Doc<"spirits">;
  aspects: Doc<"spirits">[];
}

export function VariantTabs({ base, aspects }: VariantTabsProps) {
  const params = useParams({ strict: false });
  const navigate = useNavigate();

  // Determine current tab from URL
  const aspect = (params as { aspect?: string }).aspect;
  const currentValue = aspect || "base";

  return (
    <Tabs
      value={currentValue}
      onValueChange={(value) => {
        const path = value === "base"
          ? `/spirits/${base.slug}`
          : `/spirits/${base.slug}/${value}`;
        navigate({ to: path, viewTransition: true });
      }}
      className="w-full"
    >
      <TabsList className="sticky top-[57px] z-10 w-full h-auto min-h-[44px] justify-start overflow-x-auto bg-background/95 backdrop-blur border-b border-border rounded-none px-4 gap-1">
        <TabsTrigger
          value="base"
          className="min-w-fit min-h-[44px] shrink-0 data-[state=active]:bg-primary/10"
        >
          {base.name.split(" ").slice(0, 2).join(" ")}
        </TabsTrigger>
        {aspects.map((a) => (
          <TabsTrigger
            key={a.aspectName}
            value={a.aspectName?.toLowerCase() || ""}
            className="min-w-fit min-h-[44px] shrink-0 data-[state=active]:bg-primary/10"
          >
            {a.aspectName}
          </TabsTrigger>
        ))}
      </TabsList>
    </Tabs>
  );
}
```

Key implementation details:
- 44px minimum touch targets per accessibility requirement
- Horizontal scroll when many aspects
- Sticky positioning below header (57px)
- URL as single source of truth (no local state)
- viewTransition: true for smooth navigation
- Shortened base spirit name (first 2 words) to fit tab width
  </action>
  <verify>Run `pnpm typecheck` - no errors</verify>
  <done>VariantTabs component created with URL sync</done>
</task>

<task type="auto">
  <name>Task 3: Refactor spirit detail routes to use tabs</name>
  <files>app/routes/spirits.$slug.tsx, app/routes/spirits.$slug.$aspect.tsx</files>
  <action>
Refactor the spirit detail routes to:
1. Use the new getSpiritWithAspects query
2. Render VariantTabs in the layout
3. Share the detail content between base and aspect views

In spirits.$slug.tsx:
- Change to always render as a layout (remove the hasChildRoute check)
- Fetch base spirit with aspects using getSpiritWithAspects
- Render VariantTabs below the header
- Use Outlet for child route content OR render SpiritDetailContent when no child

In spirits.$slug.$aspect.tsx:
- This route now renders the same content as base, just with different data
- It can share the same SpiritDetailContent component
- Import and reuse from the parent route file

The page structure should be:
```
Header (back button + spirit name)
VariantTabs (base + aspects)
Content (Overview, Special Rules, Growth, Presence, Innates, Cards, External Links)
```

IMPORTANT:
- Keep view transitions working (use variant-specific view-transition-name)
- Handle loading states (useSuspenseQuery pattern)
- Not found state should show for invalid slugs/aspects

Both routes use getSpiritBySlug for their specific spirit data (base or aspect), but the layout uses getSpiritWithAspects to populate the tabs.
  </action>
  <verify>Run `pnpm dev` and navigate between base spirit and aspects - tabs should highlight correctly and URL should update</verify>
  <done>Spirit detail page shows variant tabs, switching works with URL sync</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. Navigate to /spirits/river-surges-in-sunlight - see tabs for Base, Haven, Sunshine, Travel
3. Click "Sunshine" tab - URL changes to /spirits/river-surges-in-sunlight/sunshine
4. Click browser back - returns to base spirit
5. Direct navigation to /spirits/river-surges-in-sunlight/travel - loads with Travel tab active
6. Tabs are scrollable if many aspects
</verification>

<success_criteria>
- recharts package in package.json
- 4 shadcn components installed (tabs, accordion, collapsible, tooltip)
- VariantTabs component renders horizontally scrollable tabs
- Base spirit and all aspects shown as tabs
- URL updates when switching tabs
- Tab selection matches URL on page load
- 44px touch targets maintained
</success_criteria>

<output>
After completion, create `.planning/phases/03-spirit-detail-board/03-02-SUMMARY.md`
</output>
