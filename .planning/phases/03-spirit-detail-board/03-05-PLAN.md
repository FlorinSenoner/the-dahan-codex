---
phase: 03-spirit-detail-board
plan: 05
type: execute
wave: 4
depends_on: ["03-03", "03-04"]
files_modified:
  - app/components/spirits/innate-powers.tsx
  - app/components/spirits/special-rules.tsx
  - app/components/spirits/card-hand.tsx
  - app/routes/spirits.$slug.tsx
  - app/routes/spirits.$slug.$aspect.tsx
autonomous: true

must_haves:
  truths:
    - "Innate powers display with element thresholds"
    - "Innate powers are collapsed by default"
    - "Special rules display in a collapsible section"
    - "Card hand shows unique power cards"
    - "Card names and costs are visible"
  artifacts:
    - path: "app/components/spirits/innate-powers.tsx"
      provides: "Accordion of innate power thresholds"
      min_lines: 50
    - path: "app/components/spirits/special-rules.tsx"
      provides: "Collapsible special rules section"
      min_lines: 30
    - path: "app/components/spirits/card-hand.tsx"
      provides: "Row of unique power cards"
      min_lines: 40
  key_links:
    - from: "app/routes/spirits.$slug.tsx"
      to: "app/components/spirits/innate-powers.tsx"
      via: "component import"
      pattern: "import.*InnatePowers"
    - from: "app/routes/spirits.$slug.tsx"
      to: "app/components/spirits/card-hand.tsx"
      via: "component import"
      pattern: "import.*CardHand"
---

<objective>
Build the remaining board sections: Innate Powers, Special Rules, and Card Hand.

Purpose: Complete the board visualization (BOARD-04, BOARD-05) and show starting cards.
Output: Innate powers in accordion, special rules collapsible, unique power cards displayed.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-spirit-detail-board/03-CONTEXT.md
@.planning/phases/03-spirit-detail-board/03-RESEARCH.md
@.planning/phases/03-spirit-detail-board/03-03-SUMMARY.md
@.planning/phases/03-spirit-detail-board/03-04-SUMMARY.md
@app/components/ui/accordion.tsx
@app/components/ui/collapsible.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create InnatePowers component</name>
  <files>app/components/spirits/innate-powers.tsx</files>
  <action>
Create an accordion component that displays innate powers with their element thresholds.

```typescript
import type { Doc } from "convex/_generated/dataModel";
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from "@/components/ui/accordion";
import { Badge } from "@/components/ui/badge";
import { Heading, Text } from "@/components/ui/typography";
import { elementBadgeColors } from "@/lib/spirit-colors";
import { cn } from "@/lib/utils";

type Innate = NonNullable<Doc<"spirits">["innates"]>[number];

interface InnatePowersProps {
  innates: NonNullable<Doc<"spirits">["innates"]>;
}

// Element display order
const ELEMENT_ORDER = ["Sun", "Moon", "Fire", "Air", "Water", "Earth", "Plant", "Animal"];

function ElementThreshold({ elements }: { elements: Innate["thresholds"][number]["elements"] }) {
  // Convert elements object to array of {element, count}
  const elementCounts = ELEMENT_ORDER
    .filter((el) => elements[el as keyof typeof elements])
    .map((el) => ({
      element: el,
      count: elements[el as keyof typeof elements] || 0,
    }));

  return (
    <div className="flex flex-wrap gap-1">
      {elementCounts.map(({ element, count }) => (
        <Badge
          key={element}
          variant="outline"
          className={cn(
            "text-xs px-1.5 py-0",
            elementBadgeColors[element] || "",
          )}
        >
          {count} {element}
        </Badge>
      ))}
    </div>
  );
}

export function InnatePowers({ innates }: InnatePowersProps) {
  if (!innates || innates.length === 0) {
    return (
      <section className="space-y-3">
        <Heading variant="h3" as="h2">Innate Powers</Heading>
        <Text variant="muted">No innate power data available.</Text>
      </section>
    );
  }

  return (
    <section className="space-y-3">
      <Heading variant="h3" as="h2">Innate Powers</Heading>
      <Accordion type="multiple" className="w-full space-y-2">
        {innates.map((innate, idx) => (
          <AccordionItem
            key={innate.name}
            value={`innate-${idx}`}
            className="border border-border rounded-lg bg-muted/20 px-4"
          >
            <AccordionTrigger className="hover:no-underline py-3">
              <div className="flex items-center gap-2 text-left">
                <span className="font-medium">{innate.name}</span>
                <Badge
                  variant="outline"
                  className={cn(
                    "text-xs",
                    innate.speed === "Fast" ? "border-amber-500/50 text-amber-400" : "border-blue-500/50 text-blue-400"
                  )}
                >
                  {innate.speed}
                </Badge>
              </div>
            </AccordionTrigger>
            <AccordionContent className="pb-4 space-y-3">
              {innate.range && (
                <Text variant="small" className="text-muted-foreground">
                  Range: {innate.range}
                </Text>
              )}
              {innate.target && (
                <Text variant="small" className="text-muted-foreground">
                  Target: {innate.target}
                </Text>
              )}
              <div className="space-y-3">
                {innate.thresholds.map((threshold, tIdx) => (
                  <div
                    key={tIdx}
                    className="p-3 bg-background/50 rounded-md space-y-2"
                  >
                    <ElementThreshold elements={threshold.elements} />
                    <Text variant="small">{threshold.effect}</Text>
                  </div>
                ))}
              </div>
            </AccordionContent>
          </AccordionItem>
        ))}
      </Accordion>
    </section>
  );
}
```

Key implementation details:
- Accordion type="multiple" (can expand multiple innates)
- Collapsed by default (no defaultValue)
- Fast powers get amber badge, Slow get blue
- Thresholds show element requirements as badges
- Effect text below each threshold
  </action>
  <verify>Run `pnpm typecheck` - no errors</verify>
  <done>InnatePowers component displays innates in accordion</done>
</task>

<task type="auto">
  <name>Task 2: Create SpecialRules and CardHand components</name>
  <files>app/components/spirits/special-rules.tsx, app/components/spirits/card-hand.tsx</files>
  <action>
Create SpecialRules component using Collapsible:

```typescript
// special-rules.tsx
import type { Doc } from "convex/_generated/dataModel";
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from "@/components/ui/collapsible";
import { Heading, Text } from "@/components/ui/typography";
import { ChevronDown } from "lucide-react";
import { useState } from "react";
import { cn } from "@/lib/utils";

interface SpecialRulesProps {
  rules: NonNullable<Doc<"spirits">["specialRules"]>;
}

export function SpecialRules({ rules }: SpecialRulesProps) {
  const [isOpen, setIsOpen] = useState(false);

  if (!rules || rules.length === 0) {
    return null; // Don't show section if no special rules
  }

  return (
    <section className="space-y-3">
      <Collapsible open={isOpen} onOpenChange={setIsOpen}>
        <CollapsibleTrigger className="flex items-center gap-2 w-full text-left group">
          <Heading variant="h3" as="h2" className="group-hover:text-primary transition-colors">
            Special Rules
          </Heading>
          <ChevronDown
            className={cn(
              "h-5 w-5 text-muted-foreground transition-transform",
              isOpen && "rotate-180"
            )}
          />
        </CollapsibleTrigger>
        <CollapsibleContent className="pt-3 space-y-3">
          {rules.map((rule, idx) => (
            <div
              key={idx}
              className="p-3 bg-muted/30 rounded-lg border border-border"
            >
              <Text className="font-medium text-primary mb-1">
                {rule.name}
              </Text>
              <Text variant="small" className="text-muted-foreground">
                {rule.description}
              </Text>
            </div>
          ))}
        </CollapsibleContent>
      </Collapsible>
    </section>
  );
}
```

Create CardHand component:

```typescript
// card-hand.tsx
import type { Doc } from "convex/_generated/dataModel";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Heading, Text } from "@/components/ui/typography";
import { elementBadgeColors } from "@/lib/spirit-colors";
import { cn } from "@/lib/utils";

type UniquePower = NonNullable<Doc<"spirits">["uniquePowers"]>[number];

interface CardHandProps {
  uniquePowers: NonNullable<Doc<"spirits">["uniquePowers"]>;
}

function PowerCard({ power }: { power: UniquePower }) {
  return (
    <Card className="min-w-[160px] max-w-[200px] shrink-0 bg-muted/30">
      <CardHeader className="pb-2 pt-3 px-3">
        <div className="flex items-start justify-between gap-2">
          <CardTitle className="text-sm font-medium leading-tight">
            {power.name}
          </CardTitle>
          <Badge
            variant="outline"
            className="shrink-0 text-xs px-1.5 py-0 text-amber-400 border-amber-500/50"
          >
            {power.cost}
          </Badge>
        </div>
      </CardHeader>
      <CardContent className="pb-3 px-3 space-y-2">
        <Badge
          variant="outline"
          className={cn(
            "text-xs",
            power.speed === "Fast"
              ? "border-amber-500/50 text-amber-400"
              : "border-blue-500/50 text-blue-400"
          )}
        >
          {power.speed}
        </Badge>
        <div className="flex flex-wrap gap-1">
          {power.elements.map((el) => (
            <Badge
              key={el}
              variant="outline"
              className={cn("text-xs px-1.5 py-0", elementBadgeColors[el] || "")}
            >
              {el}
            </Badge>
          ))}
        </div>
      </CardContent>
    </Card>
  );
}

export function CardHand({ uniquePowers }: CardHandProps) {
  if (!uniquePowers || uniquePowers.length === 0) {
    return (
      <section className="space-y-3">
        <Heading variant="h3" as="h2">Starting Cards</Heading>
        <Text variant="muted">Card data coming soon.</Text>
      </section>
    );
  }

  return (
    <section className="space-y-3">
      <Heading variant="h3" as="h2">Starting Cards</Heading>
      <div className="flex gap-3 overflow-x-auto pb-2 -mx-4 px-4">
        {uniquePowers.map((power) => (
          <PowerCard key={power.name} power={power} />
        ))}
      </div>
    </section>
  );
}
```

Key implementation details:
- SpecialRules: Collapsible, hidden if no rules, controlled state
- CardHand: Horizontal scroll, cards show name/cost/speed/elements
- No card images in v1 (text-only mini preview per CONTEXT.md)
- Fast/Slow badges match innate power colors
  </action>
  <verify>Run `pnpm typecheck` - no errors</verify>
  <done>SpecialRules and CardHand components created</done>
</task>

<task type="auto">
  <name>Task 3: Integrate remaining sections into spirit detail</name>
  <files>app/routes/spirits.$slug.tsx, app/routes/spirits.$slug.$aspect.tsx</files>
  <action>
Add SpecialRules, InnatePowers, and CardHand to the spirit detail pages.

Import all new components and add them in the correct order per CONTEXT.md:

```tsx
// After OverviewSection
{spirit.specialRules && spirit.specialRules.length > 0 && (
  <SpecialRules rules={spirit.specialRules} />
)}

// After GrowthPanel
{spirit.presenceTracks && (
  <PresenceTrack presenceTracks={spirit.presenceTracks} />
)}

// After PresenceTrack
{spirit.innates && (
  <InnatePowers innates={spirit.innates} />
)}

// After InnatePowers
{spirit.uniquePowers && (
  <CardHand uniquePowers={spirit.uniquePowers} />
)}
```

The final page structure:
```
Header
VariantTabs
Image + Name + Summary + Description
OverviewSection (complexity, elements, radar, strengths/weaknesses)
SpecialRules (collapsible - only if spirit has rules)
GrowthPanel
PresenceTrack
InnatePowers (accordion, collapsed by default)
CardHand (horizontal scroll)
```

Ensure proper spacing between sections (add space-y-8 or similar to the main content wrapper).
  </action>
  <verify>Run `pnpm dev` and scroll through /spirits/river-surges-in-sunlight - see all board sections</verify>
  <done>All board sections visible on spirit detail page</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. Navigate to /spirits/river-surges-in-sunlight
3. No "Special Rules" section (River has none)
4. See "Innate Powers" section - click to expand
5. Innate shows thresholds with element badges
6. See "Starting Cards" section with 4 cards
7. Cards show name, cost, speed, elements
8. Cards scroll horizontally on mobile
9. Navigate to Lightning - similar structure
</verification>

<success_criteria>
- SpecialRules shows only if spirit has special rules
- SpecialRules is collapsible with chevron indicator
- InnatePowers shows all innates in accordion
- Innate thresholds show element requirements as badges
- CardHand shows all unique powers as mini cards
- Cards show name, energy cost, speed, and elements
- Horizontal scroll for cards on mobile
- All sections have proper headings and spacing
</success_criteria>

<output>
After completion, create `.planning/phases/03-spirit-detail-board/03-05-SUMMARY.md`
</output>
