---
phase: 03-spirit-detail-board
plan: 04
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - app/components/spirits/growth-panel.tsx
  - app/components/spirits/presence-track.tsx
  - app/components/spirits/presence-slot.tsx
  - app/routes/spirits.$slug.tsx
  - app/routes/spirits.$slug.$aspect.tsx
autonomous: true

must_haves:
  truths:
    - "Growth panel displays all growth options as cards"
    - "Each growth option shows its actions"
    - "Presence tracks display as grid of circular slots"
    - "Energy track shows values (1-6)"
    - "Card plays track shows values (1-4) and Reclaim indicator"
    - "Slots have tooltips explaining their reward"
  artifacts:
    - path: "app/components/spirits/growth-panel.tsx"
      provides: "Growth options display"
      min_lines: 40
    - path: "app/components/spirits/presence-track.tsx"
      provides: "Presence track grid layout"
      min_lines: 40
    - path: "app/components/spirits/presence-slot.tsx"
      provides: "Individual slot with tooltip"
      min_lines: 30
  key_links:
    - from: "app/components/spirits/presence-track.tsx"
      to: "app/components/spirits/presence-slot.tsx"
      via: "component composition"
      pattern: "import.*PresenceSlot"
    - from: "app/routes/spirits.$slug.tsx"
      to: "app/components/spirits/growth-panel.tsx"
      via: "component import"
      pattern: "import.*GrowthPanel"
---

<objective>
Build the Growth panel and Presence tracks - core board visualization components.

Purpose: These are the key board components that show how the spirit plays (BOARD-01, BOARD-02, BOARD-03).
Output: Growth options displayed as cards, presence tracks as interactive slot grids with tooltips.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-spirit-detail-board/03-CONTEXT.md
@.planning/phases/03-spirit-detail-board/03-RESEARCH.md
@.planning/phases/03-spirit-detail-board/03-02-SUMMARY.md
@app/routes/spirits.$slug.tsx
@app/components/ui/tooltip.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GrowthPanel component</name>
  <files>app/components/spirits/growth-panel.tsx</files>
  <action>
Create a component that displays growth options as cards.

```typescript
import type { Doc } from "convex/_generated/dataModel";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Heading, Text } from "@/components/ui/typography";

interface GrowthPanelProps {
  growth: NonNullable<Doc<"spirits">["growth"]>;
}

export function GrowthPanel({ growth }: GrowthPanelProps) {
  if (!growth || growth.length === 0) {
    return (
      <section className="space-y-3">
        <Heading variant="h3" as="h2">Growth</Heading>
        <Text variant="muted">Growth data coming soon.</Text>
      </section>
    );
  }

  return (
    <section className="space-y-3">
      <Heading variant="h3" as="h2">Growth</Heading>
      <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
        {growth.map((growthOption, idx) => (
          <Card key={idx} className="bg-muted/30">
            <CardHeader className="pb-2">
              <CardTitle className="text-sm font-medium text-primary">
                {growthOption.title || `Option ${idx + 1}`}
              </CardTitle>
            </CardHeader>
            <CardContent className="pt-0">
              <ul className="space-y-1">
                {growthOption.options.map((option, optIdx) => (
                  <li key={optIdx} className="text-sm text-muted-foreground">
                    {option.actions.join(" + ")}
                  </li>
                ))}
              </ul>
            </CardContent>
          </Card>
        ))}
      </div>
    </section>
  );
}
```

Key implementation details:
- Grid layout (2 columns on sm+)
- Each growth option is a Card
- Actions joined with " + " for readability
- Graceful fallback when no data
- Uses existing Card components from shadcn/ui
  </action>
  <verify>Run `pnpm typecheck` - no errors</verify>
  <done>GrowthPanel component displays growth options as cards</done>
</task>

<task type="auto">
  <name>Task 2: Create PresenceSlot component</name>
  <files>app/components/spirits/presence-slot.tsx</files>
  <action>
Create an individual presence slot component with tooltip.

```typescript
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip";
import { cn } from "@/lib/utils";
import { elementBadgeColors } from "@/lib/spirit-colors";

interface PresenceSlotProps {
  value: number | string;
  elements?: string[];
  reclaim?: boolean;
  type: "energy" | "cardPlays";
  index: number;
}

export function PresenceSlot({
  value,
  elements,
  reclaim,
  type,
  index,
}: PresenceSlotProps) {
  // Build tooltip content
  const tooltipLines: string[] = [];

  if (type === "energy") {
    tooltipLines.push(`Gain ${value} Energy per turn`);
  } else {
    tooltipLines.push(`Play ${value} Card${value !== 1 ? "s" : ""} per turn`);
  }

  if (reclaim) {
    tooltipLines.push("Reclaim One");
  }

  if (elements && elements.length > 0) {
    tooltipLines.push(`+${elements.join(", ")}`);
  }

  // Determine display value
  const displayValue = reclaim ? "R" : value;

  // Get element color for border if slot grants an element
  const elementColor = elements?.[0] ? elementBadgeColors[elements[0]] : "";

  return (
    <TooltipProvider delayDuration={100}>
      <Tooltip>
        <TooltipTrigger asChild>
          <button
            type="button"
            className={cn(
              "w-10 h-10 min-w-[40px] min-h-[40px] rounded-full border-2 flex items-center justify-center text-sm font-medium transition-colors cursor-default",
              "bg-muted/50 border-border text-foreground",
              "hover:bg-muted hover:border-primary/50",
              reclaim && "border-amber-500/50 bg-amber-500/10",
              elements && elements.length > 0 && !reclaim && "border-primary/50",
            )}
            aria-label={tooltipLines.join(". ")}
          >
            {displayValue}
          </button>
        </TooltipTrigger>
        <TooltipContent side="top" className="max-w-[200px]">
          <div className="space-y-1">
            {tooltipLines.map((line, i) => (
              <p key={i} className="text-xs">{line}</p>
            ))}
            <p className="text-xs text-muted-foreground">Slot {index + 1}</p>
          </div>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
}
```

Key implementation details:
- 40px touch targets (meets 44px guideline when including spacing)
- Tooltip shows what the slot grants
- Special styling for Reclaim slots (amber)
- Special styling for element-granting slots
- aria-label for accessibility
- delayDuration: 100 for quick tooltips
  </action>
  <verify>Run `pnpm typecheck` - no errors</verify>
  <done>PresenceSlot component with tooltip</done>
</task>

<task type="auto">
  <name>Task 3: Create PresenceTrack component and integrate board sections</name>
  <files>app/components/spirits/presence-track.tsx, app/routes/spirits.$slug.tsx, app/routes/spirits.$slug.$aspect.tsx</files>
  <action>
Create the PresenceTrack component that renders a row of slots:

```typescript
import type { Doc } from "convex/_generated/dataModel";
import { Heading, Text } from "@/components/ui/typography";
import { PresenceSlot } from "./presence-slot";

type EnergySlot = NonNullable<Doc<"spirits">["presenceTracks"]>["energy"][number];
type CardPlaysSlot = NonNullable<Doc<"spirits">["presenceTracks"]>["cardPlays"][number];

interface PresenceTrackProps {
  presenceTracks: NonNullable<Doc<"spirits">["presenceTracks"]>;
}

export function PresenceTrack({ presenceTracks }: PresenceTrackProps) {
  const { energy, cardPlays } = presenceTracks;

  return (
    <section className="space-y-4">
      <Heading variant="h3" as="h2">Presence Tracks</Heading>

      {/* Energy Track */}
      <div className="space-y-2">
        <Text variant="small" className="font-medium text-amber-400">
          Energy per Turn
        </Text>
        <div className="flex flex-wrap gap-2 p-3 bg-muted/30 rounded-lg">
          {energy.map((slot, idx) => (
            <PresenceSlot
              key={idx}
              value={slot.value}
              elements={slot.elements}
              type="energy"
              index={idx}
            />
          ))}
        </div>
      </div>

      {/* Card Plays Track */}
      <div className="space-y-2">
        <Text variant="small" className="font-medium text-blue-400">
          Card Plays per Turn
        </Text>
        <div className="flex flex-wrap gap-2 p-3 bg-muted/30 rounded-lg">
          {cardPlays.map((slot, idx) => (
            <PresenceSlot
              key={idx}
              value={slot.value}
              elements={slot.elements}
              reclaim={slot.reclaim}
              type="cardPlays"
              index={idx}
            />
          ))}
        </div>
      </div>
    </section>
  );
}
```

Then integrate both GrowthPanel and PresenceTrack into the spirit detail routes.

In spirits.$slug.tsx and spirits.$slug.$aspect.tsx, add after OverviewSection:
```tsx
{spirit.growth && <GrowthPanel growth={spirit.growth} />}
{spirit.presenceTracks && <PresenceTrack presenceTracks={spirit.presenceTracks} />}
```

The page structure after this change:
```
Header
VariantTabs
Image + Name + Summary + Description
OverviewSection
GrowthPanel (NEW)
PresenceTrack (NEW)
```
  </action>
  <verify>Run `pnpm dev` and navigate to /spirits/river-surges-in-sunlight - see growth options and presence tracks</verify>
  <done>Growth panel and presence tracks visible on spirit detail page</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. Navigate to /spirits/river-surges-in-sunlight
3. See "Growth" section with growth option cards
4. See "Presence Tracks" section with Energy and Card Plays rows
5. Hover/tap on a presence slot - tooltip shows what it grants
6. Slots with Reclaim show "R" and amber styling
7. On mobile, tracks wrap nicely
</verification>

<success_criteria>
- Growth panel shows all growth options as cards
- Each growth option lists its actions
- Energy track shows 7 circular slots with values
- Card plays track shows slots with values and Reclaim indicator
- Tooltips explain what each slot grants
- 44px touch targets on slots
- Responsive layout (wraps on mobile)
</success_criteria>

<output>
After completion, create `.planning/phases/03-spirit-detail-board/03-04-SUMMARY.md`
</output>
