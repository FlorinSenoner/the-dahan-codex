---
phase: 08-spirit-aspect-data-scraping
plan: 06
type: execute
wave: 4
depends_on: ["08-03", "08-04", "08-05"]
files_modified:
  - convex/seed.ts
  - scripts/data/spirits.json
  - scripts/data/aspects.json
autonomous: false

must_haves:
  truths:
    - "reseedSpirits runs successfully with all 37 spirits and 31 aspects"
    - "All spirit images load correctly in the app"
    - "Power spider chart renders accurate data for all spirits"
  artifacts:
    - path: "scripts/data/spirits.json"
      provides: "Reviewed and corrected spirit data"
    - path: "scripts/data/aspects.json"
      provides: "Reviewed and corrected aspect data"
  key_links:
    - from: "app/routes/_authenticated/spirits.$slug.tsx"
      to: "convex/spirits.ts"
      via: "useQuery getSpiritBySlug"
      pattern: "getSpiritBySlug"
---

<objective>
Run the full reseed process and verify all data is correct in the running application.

Purpose: Deploy complete spirit data and verify it works end-to-end.
Output: Fully populated spirit library with all 37 spirits and 31 aspects working in the app.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-spirit-aspect-data-scraping/08-RESEARCH.md
@convex/seed.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Review and correct scraped data</name>
  <files>scripts/data/spirits.json, scripts/data/aspects.json</files>
  <action>
Review the scraped JSON data for accuracy:

1. Open scripts/data/spirits.json and check:
   - All 37 spirits present
   - Complexity values are valid: "Low", "Moderate", "High", "Very High"
   - Elements are valid: Sun, Moon, Fire, Air, Water, Earth, Plant, Animal
   - Power ratings are 0-5 range
   - No null/undefined values for required fields

2. Open scripts/data/aspects.json and check:
   - All 31 aspects present
   - baseSpiritSlug matches actual spirit slugs
   - complexityModifier is "easier", "same", or "harder"
   - Expansion slugs are valid

3. Fix any issues found:
   - Manual corrections where scraping missed data
   - Fill in missing strengths/weaknesses (can be empty array)
   - Adjust power ratings if obviously wrong

4. Common issues to watch for:
   - Apostrophes in names (Lightning's -> lightnings-swift-strike)
   - Missing descriptions (OK to leave empty)
   - Power ratings of 0 when wiki showed some value

5. Re-run conversion to seed-data/spirits.ts if JSON was edited
  </action>
  <verify>
Check: jq '.[] | select(.complexity == null)' scripts/data/spirits.json returns empty
Check: jq '.[] | select(.elements | length == 0)' scripts/data/spirits.json returns empty
  </verify>
  <done>Scraped data reviewed and corrected for accuracy</done>
</task>

<task type="auto">
  <name>Task 2: Run reseed and verify database</name>
  <files>convex/seed.ts</files>
  <action>
Execute the reseed and verify database state:

1. Ensure Convex dev server is running:
   ```bash
   npx convex dev
   ```

2. Run reseedSpirits mutation:
   ```bash
   npx convex run seed:reseedSpirits
   ```

3. Check the return message for success

4. Verify in Convex dashboard (http://localhost:5555):
   - expansions table: 7 rows
   - spirits table: 37 base + 31 aspects = 68 rows
   - openings table: >= 1 row (River standard opening preserved)

5. Spot-check a few spirits in dashboard:
   - River: has all fields, correct expansion
   - Lightning: has powerRatings
   - A complex spirit (Fractured Days): has correct complexity "Very High"

6. Check aspects are linked correctly:
   - Query aspects for Lightning (baseSpirit not null)
   - Verify 4 aspects: Pandemonium, Wind, Immense, Sparking
  </action>
  <verify>
Run: npx convex run seed:reseedSpirits
Output shows: "reseeded" status with spirit/aspect counts
Dashboard: 68 spirits, 7 expansions, 1+ openings
  </verify>
  <done>Database reseeded with all 37 spirits and 31 aspects</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete spirit library with all 37 spirits and 31 aspects seeded to database</what-built>
  <how-to-verify>
1. Start the dev server: `pnpm dev` (in one terminal) + `npx convex dev` (in another)

2. Open http://localhost:3000/spirits

3. Verify spirit list:
   - Should show all spirits (scroll through list)
   - Filter by complexity works (Low, Moderate, High, Very High)
   - Filter by element works (Sun, Water, Fire, etc.)
   - Search works ("Lightning", "Serpent", etc.)

4. Check a few spirit detail pages:
   - River: http://localhost:3000/spirits/river-surges-in-sunlight
     - Image loads
     - Power spider chart shows data
     - Aspects tab shows 3 aspects (Sunshine, Travel, Haven)
     - Click an aspect, verify data loads

   - Lightning: http://localhost:3000/spirits/lightnings-swift-strike
     - 4 aspects (Pandemonium, Wind, Sparking, Immense)
     - Spider chart shows high Offense (5)

   - A new spirit (pick any not previously seeded):
     - Image loads (if downloaded)
     - Complexity badge correct
     - Element badges correct
     - Spider chart renders (even if values need adjustment)

5. Check an aspect detail:
   - Complexity modifier shown (arrow up/down/equal)
   - Image loads (or falls back to base spirit)

6. Report any issues:
   - Missing images
   - Wrong data
   - UI problems
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. reseedSpirits completes without errors
2. Database contains 7 expansions, 68 spirits (37 base + 31 aspects)
3. Spirit list page loads all spirits
4. Spirit detail pages display correct data
5. Spider charts render power ratings
6. Aspect switching works correctly
7. Images load for base spirits and aspects with unique art
</verification>

<success_criteria>
- All 37 spirits visible and browsable in app
- All 31 aspects accessible from base spirit pages
- Power spider charts show accurate data
- Images display correctly
- User verifies data quality is acceptable
</success_criteria>

<output>
After completion, create `.planning/phases/08-spirit-aspect-data-scraping/08-06-SUMMARY.md`
</output>
