---
phase: 08-spirit-aspect-data-scraping
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/scrape-spirits.ts
  - scripts/data/spirits.json
autonomous: true

must_haves:
  truths:
    - "Scraper fetches data for all 37 spirits from wiki"
    - "Power ratings extracted and mapped to 0-5 numeric scale"
    - "Spirit data saved to JSON file for review before seeding"
  artifacts:
    - path: "scripts/scrape-spirits.ts"
      provides: "Extended scraper for all spirits"
      contains: "SPIRITS.*base-game.*branch-and-claw.*jagged-earth"
    - path: "scripts/data/spirits.json"
      provides: "Scraped spirit data cache"
      min_lines: 100
  key_links:
    - from: "scripts/scrape-spirits.ts"
      to: "spiritislandwiki.com"
      via: "https.get + cheerio parsing"
      pattern: "WIKI_BASE.*spiritislandwiki"
---

<objective>
Extend the existing spirit scraper to fetch complete data for all 37 spirits from the Spirit Island wiki.

Purpose: Populate the complete spirit library with accurate data from authoritative source (wiki).
Output: scripts/data/spirits.json containing all spirit metadata ready for review before seeding.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-spirit-aspect-data-scraping/08-RESEARCH.md
@scripts/scrape-spirits.ts
@convex/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend SPIRITS config with all 37 spirits</name>
  <files>scripts/scrape-spirits.ts</files>
  <action>
Update the SPIRITS constant in scripts/scrape-spirits.ts to include all 37 spirits organized by expansion:

**Base Game (8):**
- river-surges-in-sunlight (existing)
- lightnings-swift-strike (existing)
- shadows-flicker-like-flame
- vital-strength-of-the-earth
- a-spread-of-rampant-green
- thunderspeaker
- bringer-of-dreams-and-nightmares
- oceans-hungry-grasp

**Branch & Claw (2):**
- keeper-of-the-forbidden-wilds
- sharp-fangs-behind-the-leaves

**Jagged Earth (10):**
- fractured-days-split-the-sky (existing in seed)
- starlight-seeks-its-form (existing in seed)
- finder-of-paths-unseen (existing in seed)
- serpent-slumbering-beneath-the-island (existing in seed)
- grinning-trickster-stirs-up-trouble
- lure-of-the-deep-wilderness
- many-minds-move-as-one
- shifting-memory-of-ages
- stones-unyielding-defiance
- volcano-looming-high
- shroud-of-silent-mist
- vengeance-as-a-burning-plague

**Feather and Flame (2):**
- heart-of-the-wildfire
- downpour-drenches-the-world

**Horizons (5):**
- devouring-teeth-lurk-underfoot
- eyes-watch-from-the-trees
- fathomless-mud-of-the-swamp
- rising-heat-of-stone-and-sand
- sun-bright-whirlwind

**Nature Incarnate (8):**
- ember-eyed-behemoth
- hearth-vigil
- towering-roots-of-the-jungle
- breath-of-darkness-down-your-spine
- relentless-gaze-of-the-sun
- wandering-voice-keens-delirium
- wounded-waters-bleeding
- dances-up-earthquakes

Add type for ScrapedSpirit interface that includes:
- name, slug, wikiTitle, imagePattern
- complexity: "Low" | "Moderate" | "High" | "Very High"
- elements: string[]
- summary, description
- strengths: string[], weaknesses: string[]
- powerRatings: { offense, defense, control, fear, utility } (0-5 scale)
- expansion: string (slug form)
- wikiUrl: string

Wiki title patterns:
- Replace spaces with underscores
- Apostrophes encoded as %27
- Example: "Lightning's Swift Strike" -> "Lightning%27s_Swift_Strike"
  </action>
  <verify>TypeScript compiles without errors: npx tsc --noEmit scripts/scrape-spirits.ts</verify>
  <done>SPIRITS constant contains all 37 spirit configurations with wiki title patterns</done>
</task>

<task type="auto">
  <name>Task 2: Add scraping logic for spirit metadata</name>
  <files>scripts/scrape-spirits.ts</files>
  <action>
Update scrapeSpirit function to extract full spirit metadata from wiki pages:

1. **Complexity** - Find in infobox: look for row with "Complexity" label, get text from adjacent cell
   - Map text to literal: "Low", "Moderate", "High", "Very High"

2. **Elements** - Find in infobox: look for element icons or text
   - Parse element names: Sun, Moon, Fire, Air, Water, Earth, Plant, Animal
   - Primary elements are typically 2-3 per spirit

3. **Power Ratings** - Find "Power Summary" template/section
   - Wiki uses bar widths or text: "Low", "Medium-Low", "Medium", "Medium-High", "High"
   - Map to 0-5 scale: Low=1, Medium-Low=2, Medium=3, Medium-High=4, High=5
   - Categories: Offense, Control, Fear, Defense, Utility

4. **Strengths/Weaknesses** - Find "Strategy" section
   - Look for bullet lists under headings containing "strength" or "weakness"
   - If not structured, leave empty arrays (manual fill later)

5. **Summary** - Use spirit's tagline from wiki or generate from first paragraph
   - Keep under 150 characters

6. **Description** - First 2-3 paragraphs from spirit page body
   - Clean HTML to plain text
   - Keep under 500 characters

Add rate limiting: 1 second delay between requests to avoid overloading wiki.

Add error handling: catch and log errors per spirit, continue with others.
  </action>
  <verify>Run scraper on a single spirit to test: npx tsx scripts/scrape-spirits.ts --test-one</verify>
  <done>scrapeSpirit function extracts complexity, elements, power ratings, summary, description from wiki</done>
</task>

<task type="auto">
  <name>Task 3: Output to JSON file and verify</name>
  <files>scripts/scrape-spirits.ts, scripts/data/spirits.json</files>
  <action>
1. Create scripts/data/ directory if not exists

2. Update main() function to:
   - Run scrapeSpirit for all 37 spirits
   - Collect results into array
   - Write to scripts/data/spirits.json with pretty formatting (2-space indent)
   - Log progress and any errors

3. Add command-line flags:
   - No flags: scrape all spirits
   - --test-one: scrape only River for quick testing
   - --dry-run: log what would be scraped without hitting wiki

4. Run full scrape and save to JSON:
   ```bash
   npx tsx scripts/scrape-spirits.ts
   ```

5. Verify output:
   - JSON file exists with 37 spirit objects
   - Each spirit has required fields
   - No null/undefined values for required fields
  </action>
  <verify>
Run: npx tsx scripts/scrape-spirits.ts
Check: cat scripts/data/spirits.json | jq length should output 37
Check: Each spirit has complexity, elements, powerRatings fields
  </verify>
  <done>scripts/data/spirits.json contains complete data for all 37 spirits</done>
</task>

</tasks>

<verification>
1. scripts/scrape-spirits.ts compiles without TypeScript errors
2. scripts/data/spirits.json exists with 37 spirit objects
3. All spirits have: name, slug, complexity, elements, powerRatings, summary, wikiUrl
4. Power ratings are numeric 0-5 values
5. No duplicate spirits (unique slugs)
</verification>

<success_criteria>
- All 37 spirits scraped from wiki
- Data saved to JSON for human review before database seeding
- Scraper is repeatable (can re-run to update data)
</success_criteria>

<output>
After completion, create `.planning/phases/08-spirit-aspect-data-scraping/08-01-SUMMARY.md`
</output>
