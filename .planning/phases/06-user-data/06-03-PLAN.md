---
phase: 06-user-data
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - app/routes/_authenticated/games.tsx
  - app/routes/_authenticated/games.index.tsx
  - app/components/games/game-row.tsx
  - app/components/layout/bottom-nav.tsx
autonomous: true

must_haves:
  truths:
    - "User can see a list of their recorded games"
    - "Games page shows empty state with prompt when no games exist"
    - "Games tab is accessible from bottom navigation"
    - "Game rows show date, spirits, adversary, and outcome"
  artifacts:
    - path: "app/routes/_authenticated/games.tsx"
      provides: "Games layout route"
      contains: "createFileRoute"
    - path: "app/routes/_authenticated/games.index.tsx"
      provides: "Game list page"
      contains: "listGames"
    - path: "app/components/games/game-row.tsx"
      provides: "Compact game row component"
      exports: ["GameRow"]
  key_links:
    - from: "app/routes/_authenticated/games.index.tsx"
      to: "convex/games.ts"
      via: "useSuspenseQuery for listGames"
      pattern: "api.games.listGames"
    - from: "app/components/layout/bottom-nav.tsx"
      to: "app/routes/_authenticated/games.tsx"
      via: "Link to /games"
      pattern: '"/games"'
---

<objective>
Create game list page with compact row display and bottom navigation integration.

Purpose: Users can view all their recorded games in a clean list format, and access the games section from the bottom navigation.
Output: Games routes with list view, GameRow component, and updated bottom navigation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-user-data/06-CONTEXT.md
@.planning/phases/06-user-data/06-RESEARCH.md
@app/routes/_authenticated/profile.tsx
@app/components/layout/bottom-nav.tsx
@app/components/spirits/spirit-row.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create games layout route</name>
  <files>app/routes/_authenticated/games.tsx</files>
  <action>
Create `app/routes/_authenticated/games.tsx` as a layout route:

```typescript
import { createFileRoute, Outlet } from "@tanstack/react-router";
import { PageHeader } from "@/components/ui/page-header";

export const Route = createFileRoute("/_authenticated/games")({
  component: GamesLayout,
});

function GamesLayout() {
  return (
    <div className="flex flex-col min-h-screen">
      <PageHeader title="Games" />
      <main className="flex-1 pb-20">
        <Outlet />
      </main>
    </div>
  );
}
```

This provides a consistent header for all games routes (list, new, detail).
  </action>
  <verify>Run `pnpm dev` - route should be accessible at /games (will show empty Outlet for now).</verify>
  <done>Games layout route exists with PageHeader and Outlet.</done>
</task>

<task type="auto">
  <name>Task 2: Create GameRow component and games index route</name>
  <files>app/components/games/game-row.tsx, app/routes/_authenticated/games.index.tsx</files>
  <action>
1. Create `app/components/games/game-row.tsx`:

```typescript
import { Link } from "@tanstack/react-router";
import type { Doc } from "convex/_generated/dataModel";
import { Badge } from "@/components/ui/badge";
import { format } from "date-fns";

interface GameRowProps {
  game: Doc<"games">;
}

export function GameRow({ game }: GameRowProps) {
  // Format date as "Jan 31, 2026"
  const dateStr = format(new Date(game.date), "MMM d, yyyy");

  // Get first spirit name (with variant if applicable)
  const spiritDisplay = game.spirits.length > 0
    ? game.spirits[0].variant
      ? `${game.spirits[0].name} (${game.spirits[0].variant})`
      : game.spirits[0].name
    : "Unknown Spirit";

  // Show "+N more" if multiple spirits
  const moreSpirits = game.spirits.length > 1
    ? ` +${game.spirits.length - 1} more`
    : "";

  // Adversary display
  const adversaryDisplay = game.adversary
    ? `${game.adversary.name} L${game.adversary.level}`
    : null;

  return (
    <Link
      to="/games/$id"
      params={{ id: game._id }}
      className="flex items-center gap-3 p-3 hover:bg-muted/50 transition-colors border-b border-border last:border-b-0"
    >
      {/* Date column */}
      <div className="w-24 shrink-0 text-sm text-muted-foreground">
        {dateStr}
      </div>

      {/* Spirit info - grows to fill */}
      <div className="flex-1 min-w-0">
        <div className="truncate font-medium">
          {spiritDisplay}
          {moreSpirits && (
            <span className="text-muted-foreground font-normal">{moreSpirits}</span>
          )}
        </div>
        {adversaryDisplay && (
          <div className="text-sm text-muted-foreground truncate">
            vs {adversaryDisplay}
          </div>
        )}
      </div>

      {/* Result badge */}
      <Badge variant={game.result === "win" ? "default" : "secondary"}>
        {game.result === "win" ? "Win" : "Loss"}
      </Badge>
    </Link>
  );
}
```

2. Create `app/routes/_authenticated/games.index.tsx`:

```typescript
import { createFileRoute, Link } from "@tanstack/react-router";
import { useSuspenseQuery } from "@tanstack/react-query";
import { convexQuery } from "@convex-dev/react-query";
import { api } from "convex/_generated/api";
import { Button } from "@/components/ui/button";
import { GameRow } from "@/components/games/game-row";
import { Plus, Gamepad2 } from "lucide-react";

export const Route = createFileRoute("/_authenticated/games/")({
  component: GamesIndex,
});

function GamesIndex() {
  const { data: games } = useSuspenseQuery(
    convexQuery(api.games.listGames, {})
  );

  if (games.length === 0) {
    return (
      <div className="flex flex-col items-center justify-center py-16 px-4 text-center">
        <Gamepad2 className="h-16 w-16 text-muted-foreground mb-4" />
        <h2 className="text-xl font-semibold mb-2">No games recorded yet</h2>
        <p className="text-muted-foreground mb-6 max-w-sm">
          Start tracking your Spirit Island games to see your history and stats.
        </p>
        <Button asChild>
          <Link to="/games/new">
            <Plus className="h-4 w-4 mr-2" />
            Log Your First Game
          </Link>
        </Button>
      </div>
    );
  }

  return (
    <div className="flex flex-col">
      {/* Action bar */}
      <div className="flex justify-end p-3 border-b border-border">
        <Button asChild size="sm">
          <Link to="/games/new">
            <Plus className="h-4 w-4 mr-2" />
            New Game
          </Link>
        </Button>
      </div>

      {/* Game list */}
      <div className="divide-y divide-border">
        {games.map((game) => (
          <GameRow key={game._id} game={game} />
        ))}
      </div>
    </div>
  );
}
```

Note: You may need to install date-fns if not already installed: `pnpm add date-fns`
  </action>
  <verify>Run `pnpm typecheck` and `pnpm dev`. Navigate to /games and verify empty state or list renders.</verify>
  <done>GameRow component displays game info compactly. Games index route shows list or empty state with CTA.</done>
</task>

<task type="auto">
  <name>Task 3: Enable Games tab in bottom navigation</name>
  <files>app/components/layout/bottom-nav.tsx</files>
  <action>
Update `app/components/layout/bottom-nav.tsx` to enable the Games tab:

1. Find the navItems array or equivalent
2. Update the Games item to be enabled and link to "/games"
3. Use an appropriate icon (Gamepad2 from lucide-react works well)

The Games tab should:
- Link to "/games"
- Show as active when on any /games/* route
- Use the same styling as other enabled tabs (Spirits, Settings)

Update the enabled routes type to include "/games" alongside "/spirits" and "/settings".
  </action>
  <verify>Run `pnpm dev`, navigate to /spirits, verify Games tab is visible and clickable. Click Games tab and verify it navigates to /games.</verify>
  <done>Games tab enabled in bottom navigation, links to /games, shows active state on games routes.</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. /games route accessible and shows empty state or game list
3. GameRow displays date, spirits, adversary, and result badge
4. Games tab visible and enabled in bottom navigation
5. Empty state shows friendly illustration and "Log Your First Game" button
</verification>

<success_criteria>
- Games layout route provides consistent header
- Games index route queries listGames and renders list or empty state
- GameRow component shows compact game info with link to detail
- Bottom navigation Games tab is enabled and working
- Build and typecheck pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-user-data/06-03-SUMMARY.md`
</output>
