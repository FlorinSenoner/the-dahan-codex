---
phase: 06-user-data
plan: 09
type: execute
wave: 5
depends_on: ["06-07", "06-08"]
files_modified:
  - e2e/games.spec.ts
  - e2e/fixtures.ts
autonomous: false

must_haves:
  truths:
    - "E2E tests verify game creation flow"
    - "E2E tests verify game list display"
    - "E2E tests verify game edit and delete"
    - "All existing E2E tests still pass"
  artifacts:
    - path: "e2e/games.spec.ts"
      provides: "Game tracker E2E tests"
      contains: "test.describe"
  key_links:
    - from: "e2e/games.spec.ts"
      to: "app/routes/_authenticated/games.tsx"
      via: "page.goto('/games')"
      pattern: "/games"
---

<objective>
Create E2E tests for game tracker functionality and verify complete phase.

Purpose: Validate all game tracking features work end-to-end and catch regressions.
Output: Comprehensive E2E tests for games feature, passing CI.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@e2e/spirits.spec.ts
@e2e/fixtures.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create game tracker E2E tests</name>
  <files>e2e/games.spec.ts</files>
  <action>
Create `e2e/games.spec.ts` with tests for the game tracker:

```typescript
import { test, expect } from "@playwright/test";

test.describe("Game Tracker", () => {
  // Note: These tests require authentication
  // They will be skipped if not authenticated

  test.describe("unauthenticated", () => {
    test("redirects to sign-in when accessing /games", async ({ page }) => {
      await page.goto("/games");
      // Should redirect to Clerk sign-in
      await expect(page).toHaveURL(/sign-in/);
    });
  });

  test.describe("authenticated", () => {
    // Skip these tests in CI unless we have test auth setup
    // For local testing, run with authenticated session
    test.skip(({ browserName }) => process.env.CI === "true", "Requires auth in CI");

    test.beforeEach(async ({ page }) => {
      // This assumes test user is already signed in via browser state
      // In a real setup, you'd use Clerk test mode or fixture
      await page.goto("/games");
    });

    test("shows empty state when no games", async ({ page }) => {
      // This test assumes clean state
      const emptyState = page.locator("text=No games recorded yet");
      // May or may not show depending on existing data
      // Just verify the page loads
      await expect(page.locator("h1, [role=heading]").first()).toBeVisible();
    });

    test("games page is accessible", async ({ page }) => {
      await expect(page).toHaveURL(/\/games/);
      // Should see either games list or empty state
      const content = page.locator("main");
      await expect(content).toBeVisible();
    });
  });
});

test.describe("Game Tracker Navigation", () => {
  test("games tab visible in bottom navigation", async ({ page }) => {
    await page.goto("/spirits");
    const gamesTab = page.locator('[aria-label="Games"]').or(page.locator('a[href="/games"]'));
    await expect(gamesTab).toBeVisible();
  });

  test("can navigate to games from spirits page", async ({ page }) => {
    await page.goto("/spirits");
    const gamesLink = page.locator('a[href="/games"]').first();
    await gamesLink.click();
    await expect(page).toHaveURL(/\/games/);
  });
});
```

Note: Full CRUD E2E tests for authenticated flows are challenging without test user setup. The tests above verify:
1. Unauthenticated redirect works
2. Games tab is visible in navigation
3. Navigation between tabs works

For comprehensive authenticated testing, consider adding test user fixtures in a future iteration.
  </action>
  <verify>Run `pnpm test:e2e` - new tests should pass (auth tests may skip in CI).</verify>
  <done>E2E tests exist for game tracker navigation and basic flows.</done>
</task>

<task type="auto">
  <name>Task 2: Verify all existing E2E tests pass</name>
  <files></files>
  <action>
Run the full E2E test suite to ensure no regressions:

```bash
pnpm build && pnpm test:e2e
```

Fix any failing tests. Common issues to check:
- Bottom navigation changes might affect other tests
- New routes might conflict with existing patterns
- Import/export might need specific selectors
  </action>
  <verify>All E2E tests pass with `pnpm test:e2e`.</verify>
  <done>Full E2E test suite passes including new game tracker tests.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete game tracker with:
- Game list page with empty state
- New game creation form with spirit picker
- Game detail page with inline edit
- Delete with undo toast
- CSV export with all fields
- CSV import with preview and ID-based sync
- Games tab in bottom navigation
- E2E tests for navigation and basic flows
  </what-built>
  <how-to-verify>
1. Open http://localhost:3000/games (must be signed in)
2. Verify empty state shows "No games recorded yet" with CTA
3. Click "Log Your First Game" or "New Game"
4. Fill out form:
   - Select at least one spirit using searchable dropdown
   - Set date and result
   - Optionally add adversary with level
   - Add notes
5. Click "Log Game" - verify toast and redirect to list
6. Verify game appears in list with correct info
7. Click on game to view details
8. Click Edit, change something, Save
9. Click Delete - verify undo toast appears
10. Click Undo within 5 seconds - verify game restored
11. Delete again without undo - verify game removed
12. Create a few more games
13. Click "Export CSV" - verify file downloads
14. Open CSV in Excel - verify columns and data
15. Go to /games/import, upload the CSV
16. Verify preview shows games as "Update" (matching IDs)
17. Import and verify no duplicates created
  </how-to-verify>
  <resume-signal>Type "approved" if all verification steps pass, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
1. `pnpm test:e2e` passes all tests
2. `pnpm ci` passes (lint, typecheck, build, test)
3. Manual verification of complete game tracker flow
4. CSV round-trip (export then import) works correctly
</verification>

<success_criteria>
- E2E tests cover game tracker navigation
- All existing E2E tests still pass
- Manual verification confirms complete feature works
- CSV export/import round-trip preserves data
- Build and CI pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-user-data/06-09-SUMMARY.md`
</output>
