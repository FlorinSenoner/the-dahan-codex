---
phase: 06-user-data
plan: 10
type: execute
wave: 1
depends_on: []
files_modified:
  - app/routes/_authenticated/games/$id.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Clicking Delete immediately soft-deletes the game"
    - "Toast shows 'Game deleted' with 'Undo' action button"
    - "Clicking 'Undo' restores the game via restoreGame mutation"
    - "User navigates to /games after delete"
  artifacts:
    - path: "app/routes/_authenticated/games/$id.tsx"
      provides: "Delete with undo toast pattern"
      contains: "restoreGame"
  key_links:
    - from: "app/routes/_authenticated/games/$id.tsx"
      to: "api.games.restoreGame"
      via: "useConvexMutation"
      pattern: "restoreGame"
---

<objective>
Replace AlertDialog delete confirmation with immediate soft-delete + undo toast pattern.

Purpose: Match the UX decision from CONTEXT.md: "Undo toast (not confirmation dialog)" and "Swipe-to-delete with undo is the mobile pattern (like iOS Mail)".

Output: Delete button triggers immediate soft-delete, shows toast with Undo action that calls restoreGame mutation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-user-data/06-CONTEXT.md (see lines 44, 74 for UX decision)
@.planning/phases/06-user-data/06-VERIFICATION.md (gap details)
@convex/games.ts (restoreGame mutation lines 180-194)
@app/routes/_authenticated/games/$id.tsx (current implementation with AlertDialog)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace AlertDialog with undo toast pattern</name>
  <files>app/routes/_authenticated/games/$id.tsx</files>
  <action>
Replace the current AlertDialog delete confirmation with immediate soft-delete + undo toast:

1. **Remove AlertDialog imports** (lines 11-20):
   - Remove AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle imports

2. **Remove showDeleteConfirm state** (line 96):
   - Delete: `const [showDeleteConfirm, setShowDeleteConfirm] = React.useState(false);`

3. **Add restoreGame mutation** after deleteGameMutation (around line 114):
   ```typescript
   const restoreGameMutation = useMutation({
     mutationFn: useConvexMutation(api.games.restoreGame),
   });
   ```

4. **Rewrite handleDelete function** (lines 130-134):
   ```typescript
   const handleDelete = async () => {
     const gameId = game._id;
     await deleteGameMutation.mutateAsync({ id: gameId });
     navigate({ to: "/games" });
     toast("Game deleted", {
       action: {
         label: "Undo",
         onClick: () => restoreGameMutation.mutate({ id: gameId }),
       },
     });
   };
   ```
   Note: Navigate first, then show toast (toast persists across navigation with sonner).

5. **Update Delete button onClick** (line 377):
   - Change `onClick={() => setShowDeleteConfirm(true)}` to `onClick={handleDelete}`

6. **Remove AlertDialog JSX** (lines 385-405):
   - Delete the entire AlertDialog component and its contents

7. **Clean up unused imports**:
   - Ensure no unused imports remain (AlertDialog components)

The result: Clicking Delete immediately soft-deletes the game, navigates to /games, and shows a toast with "Undo" button that calls restoreGame.
  </action>
  <verify>
1. Run `pnpm typecheck` - no TypeScript errors
2. Manual test flow:
   - Go to /games, create a test game
   - Open game detail page
   - Click Delete button
   - Verify: immediate navigation to /games, toast appears with "Game deleted" and "Undo" button
   - Click "Undo" before toast dismisses
   - Verify: game reappears in list
  </verify>
  <done>
Delete uses immediate soft-delete + undo toast pattern. AlertDialog removed. restoreGame mutation wired to Undo button. No TypeScript errors.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes with no errors
2. No AlertDialog imports remain in $id.tsx
3. restoreGame mutation is imported and used
4. Delete button click triggers immediate delete + navigate + toast
5. Undo button in toast calls restoreGame mutation
</verification>

<success_criteria>
- Delete confirmation dialog is removed
- Clicking Delete immediately soft-deletes the game
- User sees toast with "Game deleted" message and "Undo" action
- Clicking "Undo" restores the game via restoreGame mutation
- User is on /games page after delete
- All TypeScript types pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-user-data/06-10-SUMMARY.md`
</output>
