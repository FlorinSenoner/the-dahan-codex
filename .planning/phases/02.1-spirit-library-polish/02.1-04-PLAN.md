---
phase: 02.1-spirit-library-polish
plan: 04
type: execute
wave: 2
depends_on: ["02.1-01"]
files_modified:
  - app/components/spirits/spirit-row.tsx
  - app/components/spirits/filter-sheet.tsx
autonomous: true

must_haves:
  truths:
    - "Aspects show complexity modifier icons (up/down arrows)"
    - "Modifier icons are color-coded (harder=fire, easier=plant)"
    - "Complexity badges use distinct colors per level"
    - "Filter options show element colors when selected"
  artifacts:
    - path: "app/components/spirits/spirit-row.tsx"
      provides: "Aspect modifier display"
      contains: "ArrowUp"
    - path: "app/components/spirits/filter-sheet.tsx"
      provides: "Color-coded filter options"
      contains: "element-fire"
  key_links:
    - from: "app/components/spirits/spirit-row.tsx"
      to: "convex/schema.ts"
      via: "complexityModifier field"
      pattern: "complexityModifier"
---

<objective>
Add color coding for complexity badges, aspect complexity modifiers, and element colors in filter options.

Purpose: UAT identified missing visual distinction: aspects need up/down arrow modifiers, complexity badges need color coding, and filter elements should show their element colors when selected.

Output: Color-coded complexity display, modifier icons for aspects, and vibrant element colors in filter sheet.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02.1-spirit-library-polish/02.1-RESEARCH.md

@app/components/spirits/spirit-row.tsx
@app/components/spirits/filter-sheet.tsx
@app/styles/globals.css (for element color variables)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add complexity modifier display to aspect rows</name>
  <files>app/components/spirits/spirit-row.tsx</files>
  <action>
Update spirit-row.tsx to display complexity modifiers for aspects:

1. **Import icons:**
   ```tsx
   import { ArrowUp, ArrowDown, Equal } from "lucide-react";
   ```

2. **Add modifier config:**
   ```tsx
   const modifierConfig: Record<string, { icon: typeof ArrowUp; color: string; label: string }> = {
     easier: { icon: ArrowDown, color: "text-element-plant", label: "Easier" },
     same: { icon: Equal, color: "text-muted-foreground", label: "Same complexity" },
     harder: { icon: ArrowUp, color: "text-element-fire", label: "Harder" },
   };
   ```

3. **Update SpiritRowProps interface:**
   ```tsx
   interface SpiritRowProps {
     spirit: Doc<"spirits"> & { isAspect: boolean };
     isAspect: boolean;
   }
   ```
   Note: The spirit type from Convex should already include complexityModifier.

4. **Add modifier display for aspects** (replace the empty space where complexity badge would be):
   ```tsx
   {/* Complexity badge for base spirits, modifier for aspects */}
   {isAspect && spirit.complexityModifier ? (
     <div className="mt-2 flex items-center gap-1" title={modifierConfig[spirit.complexityModifier].label}>
       {(() => {
         const config = modifierConfig[spirit.complexityModifier];
         const Icon = config.icon;
         return (
           <span className={cn("flex items-center gap-1 text-xs", config.color)}>
             <Icon className="h-4 w-4" />
             <span className="sr-only">{config.label}</span>
           </span>
         );
       })()}
     </div>
   ) : !isAspect ? (
     <Badge
       variant="outline"
       className={cn("mt-2 text-xs", complexityColors[spirit.complexity] || "")}
     >
       {spirit.complexity}
     </Badge>
   ) : null}
   ```
  </action>
  <verify>Run `pnpm dev`, navigate to /spirits. Verify aspects show colored arrows (red up arrow for "harder").</verify>
  <done>Aspect rows display complexity modifier icons with appropriate colors.</done>
</task>

<task type="auto">
  <name>Task 2: Add element colors to filter sheet options</name>
  <files>app/components/spirits/filter-sheet.tsx</files>
  <action>
Update filter-sheet.tsx to show element colors when filter options are selected:

1. **Add element color mapping:**
   ```tsx
   const elementColors: Record<string, { selected: string; unselected: string }> = {
     Sun: {
       selected: "bg-element-sun/30 text-element-sun border-element-sun/50",
       unselected: "bg-muted/30 text-foreground border-border hover:bg-muted/50",
     },
     Moon: {
       selected: "bg-element-moon/30 text-element-moon border-element-moon/50",
       unselected: "bg-muted/30 text-foreground border-border hover:bg-muted/50",
     },
     Fire: {
       selected: "bg-element-fire/30 text-element-fire border-element-fire/50",
       unselected: "bg-muted/30 text-foreground border-border hover:bg-muted/50",
     },
     Air: {
       selected: "bg-element-air/30 text-element-air border-element-air/50",
       unselected: "bg-muted/30 text-foreground border-border hover:bg-muted/50",
     },
     Water: {
       selected: "bg-element-water/30 text-element-water border-element-water/50",
       unselected: "bg-muted/30 text-foreground border-border hover:bg-muted/50",
     },
     Earth: {
       selected: "bg-element-earth/30 text-element-earth border-element-earth/50",
       unselected: "bg-muted/30 text-foreground border-border hover:bg-muted/50",
     },
     Plant: {
       selected: "bg-element-plant/30 text-element-plant border-element-plant/50",
       unselected: "bg-muted/30 text-foreground border-border hover:bg-muted/50",
     },
     Animal: {
       selected: "bg-element-animal/30 text-element-animal border-element-animal/50",
       unselected: "bg-muted/30 text-foreground border-border hover:bg-muted/50",
     },
   };
   ```

2. **Add complexity color mapping:**
   ```tsx
   const complexityColors: Record<string, { selected: string; unselected: string }> = {
     Low: {
       selected: "bg-element-plant/30 text-element-plant border-element-plant/50",
       unselected: "bg-muted/30 text-foreground border-border hover:bg-muted/50",
     },
     Moderate: {
       selected: "bg-element-sun/30 text-element-sun border-element-sun/50",
       unselected: "bg-muted/30 text-foreground border-border hover:bg-muted/50",
     },
     High: {
       selected: "bg-element-fire/30 text-element-fire border-element-fire/50",
       unselected: "bg-muted/30 text-foreground border-border hover:bg-muted/50",
     },
     "Very High": {
       selected: "bg-destructive/30 text-destructive border-destructive/50",
       unselected: "bg-muted/30 text-foreground border-border hover:bg-muted/50",
     },
   };
   ```

3. **Update FilterPill to accept color classes:**
   ```tsx
   function FilterPill({
     label,
     selected,
     onClick,
     selectedClass,
     unselectedClass,
   }: {
     label: string;
     selected: boolean;
     onClick: () => void;
     selectedClass?: string;
     unselectedClass?: string;
   }) {
     return (
       <button
         type="button"
         onClick={onClick}
         className={cn(
           "min-h-[44px] px-4 py-2 rounded-full text-sm font-medium transition-colors cursor-pointer border",
           selected
             ? (selectedClass || "bg-primary text-primary-foreground border-primary")
             : (unselectedClass || "bg-muted/30 text-foreground border-border hover:bg-muted/50"),
         )}
       >
         {label}
       </button>
     );
   }
   ```

4. **Update filter option rendering:**
   ```tsx
   {/* Complexity filter */}
   {COMPLEXITY_OPTIONS.map((option) => (
     <FilterPill
       key={option}
       label={option}
       selected={pendingComplexity.includes(option)}
       onClick={() => toggleComplexity(option)}
       selectedClass={complexityColors[option].selected}
       unselectedClass={complexityColors[option].unselected}
     />
   ))}

   {/* Elements filter */}
   {ELEMENT_OPTIONS.map((option) => (
     <FilterPill
       key={option}
       label={option}
       selected={pendingElements.includes(option)}
       onClick={() => toggleElement(option)}
       selectedClass={elementColors[option].selected}
       unselectedClass={elementColors[option].unselected}
     />
   ))}
   ```
  </action>
  <verify>Run `pnpm dev`, open filter sheet. Select different elements - verify each shows its corresponding color (Fire=red, Water=blue, etc). Select complexity levels - verify distinct colors per level.</verify>
  <done>Filter options show element and complexity colors when selected.</done>
</task>

</tasks>

<verification>
- Aspects show up/down arrow icons for complexity modifier
- Harder aspects show red up arrow (element-fire color)
- Easier aspects would show green down arrow (element-plant color)
- Same complexity would show neutral equal sign
- Filter sheet: selected elements show their element color
- Filter sheet: selected complexity levels show distinct colors (Low=green, Moderate=yellow, High=orange, Very High=red)
</verification>

<success_criteria>
- Aspect complexity modifiers are visually distinct with icons and colors
- Element filter options are vibrant and color-coded when selected
- Complexity filter options have distinct colors matching spirit row badges
- All color choices align with the existing theme variables in globals.css
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-spirit-library-polish/02.1-04-SUMMARY.md`
</output>
