---
phase: 02.1-spirit-library-polish
plan: 06
type: execute
wave: 2
depends_on: ["02.1-01"]
files_modified:
  - app/routes/spirits.$slug.tsx
autonomous: true

must_haves:
  truths:
    - "Aspect detail page shows just aspect name as title"
    - "Subtitle shows 'Aspect of [Base Spirit]'"
    - "Description field displays on detail page"
    - "No SSR console errors"
  artifacts:
    - path: "app/routes/spirits.$slug.tsx"
      provides: "Polished spirit detail page"
      contains: "description"
  key_links:
    - from: "app/routes/spirits.$slug.tsx"
      to: "convex/spirits.ts"
      via: "useQuery for spirit data"
      pattern: "description"
---

<objective>
Fix aspect title display to show just the aspect name (not "Spirit (Aspect)"), add description field display, and verify SSR error resolution.

Purpose: UAT reported that aspect titles show "Lightning's Swift Strike (Pandemonium)" when they should just show "Pandemonium" since the subtitle already indicates it's an aspect. Also need to display the new description field for detailed playstyle information.

Output: Clean aspect titles, displayed description text, no SSR console errors.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02.1-spirit-library-polish/02.1-RESEARCH.md

@app/routes/spirits.$slug.tsx
@convex/spirits.ts (for query return type)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix aspect title display</name>
  <files>app/routes/spirits.$slug.tsx</files>
  <action>
Update the displayName logic to show just the aspect name for aspects:

**Current (wrong):**
```tsx
const displayName = isAspect
  ? `${spirit.name} (${spirit.aspectName})`
  : spirit.name;
```

**New (correct):**
```tsx
// For aspects, show just the aspect name as the main title
// The subtitle will show "Aspect of [Base Spirit Name]"
const displayName = isAspect
  ? spirit.aspectName
  : spirit.name;
```

Also fix the subtitle - currently it incorrectly tries to remove "(AspectName)" from the name:

**Current (wrong):**
```tsx
{isAspect && (
  <p className="text-center text-muted-foreground text-sm mb-4">
    Aspect of {spirit.name.replace(` (${spirit.aspectName})`, "")}
  </p>
)}
```

**New (correct):**
```tsx
{isAspect && (
  <p className="text-center text-muted-foreground text-sm mb-4">
    Aspect of {spirit.name}
  </p>
)}
```

The `spirit.name` field stores the base spirit name (e.g., "Lightning's Swift Strike"), not the combined name.
  </action>
  <verify>Navigate to an aspect like /spirits/lightnings-swift-strike?aspect=pandemonium. Title should show "Pandemonium". Subtitle should show "Aspect of Lightning's Swift Strike".</verify>
  <done>Aspect pages show clean titles: aspect name as heading, "Aspect of [Base]" as subtitle.</done>
</task>

<task type="auto">
  <name>Task 2: Add description field display</name>
  <files>app/routes/spirits.$slug.tsx</files>
  <action>
Add display for the new description field (longer playstyle text) on the detail page:

After the summary paragraph, add:

```tsx
{/* Summary */}
<p className="text-muted-foreground text-center max-w-md mx-auto mb-4">
  {spirit.summary}
</p>

{/* Detailed description (if available) */}
{spirit.description && (
  <p className="text-foreground/80 text-center max-w-lg mx-auto mb-6 text-sm leading-relaxed">
    {spirit.description}
  </p>
)}
```

The description provides more detailed playstyle and theme information, so it should be styled slightly differently from the summary - perhaps a bit smaller text with more breathing room.

**Note:** The description field may not exist on all spirits (optional). Base spirits will have it, aspects typically won't (they inherit the base spirit's description conceptually).
  </action>
  <verify>Navigate to a base spirit like /spirits/river-surges-in-sunlight. Should see both the short summary and the longer description text (if seeded in Plan 01).</verify>
  <done>Detail page displays description field for spirits that have it.</done>
</task>

<task type="auto">
  <name>Task 3: Verify SSR error resolution</name>
  <files>app/routes/spirits.$slug.tsx</files>
  <action>
The SSR errors ("Could not find Convex client! useQuery must be used under ConvexProvider") should already be fixed by the existing `isClient` pattern with `useQuery(..., "skip")`.

Verify:
1. The `isClient` state starts as `false`
2. The `useQuery` uses `"skip"` when `!isClient`
3. The loading skeleton renders the same on server and client (no hydration mismatch)

**Check the current implementation:**
```tsx
const [isClient, setIsClient] = useState(false);
useEffect(() => {
  setIsClient(true);
}, []);

const spirit = useQuery(
  api.spirits.getSpiritBySlug,
  isClient ? { slug, aspect } : "skip",
);
```

This is correct. The error should not occur if this pattern is consistently applied.

**Additional check:** Verify the loading skeleton matches what would render during SSR:
- During SSR: `isClient = false`, query skipped, `spirit = undefined`, renders loading skeleton
- During hydration: `isClient = false` initially, same skeleton renders, no mismatch
- After effect: `isClient = true`, query executes, data loads

If SSR errors persist, check:
1. Other components on the page that might use Convex without the skip pattern
2. The ConvexProvider placement in the component tree
3. Any eager evaluation of Convex queries outside components

**To verify:** Run `pnpm build && pnpm preview`, then check browser console for SSR-related errors.
  </action>
  <verify>Run `pnpm build && pnpm preview`. Navigate to /spirits and spirit detail pages. Check browser console - should see no "Could not find Convex client" errors. Check server terminal - should see no SSR errors.</verify>
  <done>No SSR console errors. Query skip pattern working correctly.</done>
</task>

</tasks>

<verification>
- Aspect detail: title shows "Pandemonium" (not "Lightning's Swift Strike (Pandemonium)")
- Aspect detail: subtitle shows "Aspect of Lightning's Swift Strike"
- Base spirit detail: shows summary and description (if available)
- No SSR errors in browser console
- No hydration mismatch warnings
- Loading skeleton appears briefly before content loads
</verification>

<success_criteria>
- Aspect titles are clean and don't duplicate information
- Description field displays for base spirits
- SSR errors are resolved
- Pages load without console errors
- User experience is smooth with no flicker or errors
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-spirit-library-polish/02.1-06-SUMMARY.md`
</output>
