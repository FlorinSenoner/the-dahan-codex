---
phase: 02.1-spirit-library-polish
plan: 02
subsystem: ui
tags: [cheerio, web-scraping, images, wiki]

# Dependency graph
requires:
  - phase: 02.1-01
    provides: Schema and seed data with imageUrl paths
provides:
  - Spirit image scraping script
  - Local spirit panel images (River, Lightning)
  - Updated seed.ts with correct image paths
affects: [02.1-03, 02.1-04, 02.1-05]

# Tech tracking
tech-stack:
  added: [cheerio]
  patterns: []

key-files:
  created:
    - scripts/scrape-spirits.ts
    - public/spirits/river-surges-in-sunlight.png
    - public/spirits/lightnings-swift-strike.png
  modified:
    - convex/seed.ts
    - package.json

key-decisions:
  - "Downloaded images as PNG (wiki format) instead of converting to WebP"
  - "Updated seed.ts imageUrl paths from .webp to .png to match downloaded format"

patterns-established: []

# Metrics
duration: 16min
completed: 2026-01-25
---

# Phase 2.1 Plan 02: Spirit Images Summary

**Wiki scraper downloads spirit panel images locally with cheerio HTML parsing**

## Performance

- **Duration:** 16 min
- **Started:** 2026-01-25T21:22:24Z
- **Completed:** 2026-01-25T21:38:35Z
- **Tasks:** 3
- **Files modified:** 5

## Accomplishments

- Created reusable TypeScript script to scrape spirit images from Spirit Island wiki
- Downloaded River Surges in Sunlight panel image (576KB)
- Downloaded Lightning's Swift Strike panel image (471KB)
- Images now served locally from public/spirits/ instead of external URLs

## Task Commits

Each task was committed atomically:

1. **Task 1 + 2: Add cheerio and create scraper** - `bf6d8ee` (feat)
2. **Task 3: Download images and update seed** - `a28fc12` (feat)

## Files Created/Modified

- `scripts/scrape-spirits.ts` - Wiki image scraping script (211 lines)
- `public/spirits/river-surges-in-sunlight.png` - River spirit panel image
- `public/spirits/lightnings-swift-strike.png` - Lightning spirit panel image
- `convex/seed.ts` - Updated imageUrl paths from .webp to .png
- `package.json` - Added cheerio dev dependency

## Decisions Made

1. **PNG instead of WebP:** Wiki images are PNG format. Rather than adding image conversion tooling (sharp, imagemin), kept as PNG which works fine for web. WebP conversion can be added later if bundle size becomes a concern.

2. **Merged Tasks 1+2:** Committed cheerio dependency together with the script that uses it to avoid knip warnings about unused dependencies.

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Updated seed.ts imageUrl paths**

- **Found during:** Task 3 (Run scraper and verify)
- **Issue:** Seed data expected .webp files but wiki images are .png
- **Fix:** Changed all imageUrl paths in seed.ts from .webp to .png
- **Files modified:** convex/seed.ts
- **Verification:** File extensions now match actual downloaded images
- **Committed in:** a28fc12 (Task 3 commit)

**2. [Rule 1 - Bug] Fixed scraper image detection logic**

- **Found during:** Task 2 (Initial script run)
- **Issue:** Original script found wrong images (Presence.svg icons) and built invalid URLs
- **Fix:** Rewrote image detection to use alt text matching and srcset extraction
- **Files modified:** scripts/scrape-spirits.ts
- **Verification:** Script now correctly downloads spirit panel images
- **Committed in:** bf6d8ee (Task 1+2 commit)

---

**Total deviations:** 2 auto-fixed (1 bug, 1 blocking)
**Impact on plan:** Both fixes necessary for images to work. No scope creep.

## Issues Encountered

- Initial scraper found SVG icons instead of panel images - fixed by improving image detection logic to match spirit name in alt text
- URLs were constructed incorrectly for relative paths - fixed by handling different URL formats (http://, //, /, relative)

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Spirit images now load locally
- Database needs reseeding to pick up new imageUrl paths: `npx convex run seed:reseedSpirits`
- Ready for aspect detail UI (02.1-03)

---

*Phase: 02.1-spirit-library-polish*
*Completed: 2026-01-25*
