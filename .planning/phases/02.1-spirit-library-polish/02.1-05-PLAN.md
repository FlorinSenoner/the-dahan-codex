---
phase: 02.1-spirit-library-polish
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - app/styles/globals.css
autonomous: true

must_haves:
  truths:
    - "View transitions animate between list and detail pages"
    - "Spirit images morph smoothly from list thumbnail to detail hero"
    - "Spirit names animate position from list to detail"
  artifacts:
    - path: "app/styles/globals.css"
      provides: "Working view transition CSS"
      contains: "::view-transition-group"
  key_links:
    - from: "app/styles/globals.css"
      to: "app/components/spirits/spirit-row.tsx"
      via: "view-transition-name inline styles"
      pattern: "view-transition"
---

<objective>
Fix view transition CSS pseudo-element syntax so transitions actually animate.

Purpose: UAT reported view transitions not working. The current CSS uses invalid attribute selectors for pseudo-elements. The correct syntax uses the transition name as a pseudo-element argument: `::view-transition-old(name)` not `[style*="name"]::view-transition-old`.

Output: Working view transitions between spirit list and detail pages with smooth image and title animations.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02.1-spirit-library-polish/02.1-RESEARCH.md

@app/styles/globals.css
@app/components/spirits/spirit-row.tsx (view-transition-name usage)
@app/routes/spirits.$slug.tsx (view-transition-name usage)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix view transition CSS pseudo-element syntax</name>
  <files>app/styles/globals.css</files>
  <action>
Replace the invalid view transition CSS with the correct syntax:

**Current (broken):**
```css
[style*="view-transition-name: spirit-image-"]::view-transition-old,
[style*="view-transition-name: spirit-image-"]::view-transition-new {
  animation-duration: 500ms;
}
```

**New (correct):**
```css
/* View Transitions */
/* Root transition for page changes */
::view-transition-group(root) {
  animation-duration: 300ms;
  animation-timing-function: ease-out;
}

/* Apply to ALL view-transition-name elements with wildcard */
::view-transition-group(*) {
  animation-duration: 400ms;
  animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* Image transitions - crossfade with slight scale */
::view-transition-image-pair(*) {
  isolation: isolate;
}

::view-transition-old(*) {
  animation: fade-out 250ms ease-out;
}

::view-transition-new(*) {
  animation: fade-in 250ms ease-in 150ms;
}

/* Custom morph animation for smooth element transitions */
@keyframes fade-out {
  from { opacity: 1; }
  to { opacity: 0; }
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* For spirit images specifically - can use dynamic names */
/* These target any view-transition-name that starts with spirit-image- */
/* Since CSS can't match partial names in pseudo-elements, we use * */

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  ::view-transition-group(*),
  ::view-transition-old(*),
  ::view-transition-new(*) {
    animation-duration: 0.01ms !important;
    animation-delay: 0ms !important;
  }
}
```

**Key insight:** The `*` wildcard matches all named view transitions, applying the same animation to all elements with `view-transition-name` set. This is the correct approach for dynamic names like `spirit-image-{slug}`.

Remove the old invalid selectors:
- `[style*="view-transition-name: spirit-image-"]::view-transition-old`
- `[style*="view-transition-name: spirit-image-"]::view-transition-new`
- `[style*="view-transition-name: spirit-name-"]::view-transition-old`
- `[style*="view-transition-name: spirit-name-"]::view-transition-new`
- `[style*="view-transition-name: spirit-aspect-"]::view-transition-old`
- `[style*="view-transition-name: spirit-aspect-"]::view-transition-new`
  </action>
  <verify>Run `pnpm dev`, navigate to /spirits, click on a spirit. Verify the image and name animate smoothly from list position to detail position. Check browser devtools - no CSS warnings about invalid selectors.</verify>
  <done>View transition CSS uses correct pseudo-element syntax with wildcard matching.</done>
</task>

<task type="auto">
  <name>Task 2: Verify view-transition-name values match between pages</name>
  <files>app/components/spirits/spirit-row.tsx, app/routes/spirits.$slug.tsx</files>
  <action>
Verify that the view-transition-name values are identical between list and detail:

1. **In spirit-row.tsx (list):**
   - Image: `viewTransitionName: spirit-image-${spirit.slug}` (or `spirit-aspect-${aspectName}`)
   - Name: `viewTransitionName: spirit-name-${spirit.slug}`

2. **In spirits.$slug.tsx (detail):**
   - Image: `viewTransitionName: spirit-image-${slug}` (or `spirit-aspect-${aspectName}`)
   - Name: `viewTransitionName: spirit-name-${slug}`

The names must match EXACTLY for the browser to recognize them as the same element and animate between states.

**Check for issues:**
- Ensure `spirit.slug` in list matches `slug` from route params in detail
- For aspects, ensure both use the same format (lowercase aspectName)
- No trailing/leading spaces in the names
- Names don't contain special characters that might break CSS

**If mismatches found**, fix them to ensure consistency.
  </action>
  <verify>Add console.log to both components to output the view-transition-name values. Click a spirit - names should match exactly. Remove console.logs after verification.</verify>
  <done>View-transition-name values match exactly between list and detail pages.</done>
</task>

</tasks>

<verification>
- Click spirit in list: image animates (morphs/fades) to detail hero position
- Click spirit in list: name animates to detail page heading
- Click back button: animations reverse smoothly
- No CSS warnings in browser console
- Works in Chrome 111+ (primary browser for View Transitions)
- Gracefully degrades in browsers without View Transitions support (no errors)
</verification>

<success_criteria>
- View transitions animate smoothly between list and detail
- Spirit image appears to "fly" from list thumbnail to detail hero
- Spirit name smoothly transitions position
- prefers-reduced-motion is respected
- No CSS parsing errors or warnings
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-spirit-library-polish/02.1-05-SUMMARY.md`
</output>
