---
phase: 01-foundation-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-lock.yaml
  - mise.toml
  - biome.json
  - lefthook.yml
  - tsconfig.json
  - app.config.ts
  - vite.config.ts
  - app/router.tsx
  - app/routes/__root.tsx
  - app/routes/index.tsx
  - app/client.tsx
  - app/ssr.tsx
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "pnpm dev starts development server without errors"
    - "Home page renders in browser at localhost:3000"
    - "pnpm biome check runs without errors on codebase"
    - "Git pre-commit hooks run biome on staged files"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies and scripts"
      contains: "@tanstack/react-start"
    - path: "mise.toml"
      provides: "Node.js version management"
      contains: 'node = "22"'
    - path: "biome.json"
      provides: "Linting and formatting configuration"
      contains: "recommended"
    - path: "lefthook.yml"
      provides: "Git hooks configuration"
      contains: "biome"
    - path: "app/routes/__root.tsx"
      provides: "Root layout component"
      exports: ["Route"]
    - path: "app/routes/index.tsx"
      provides: "Home page"
      exports: ["Route"]
  key_links:
    - from: "vite.config.ts"
      to: "tanstackStart()"
      via: "plugin import"
      pattern: "tanstackStart"
    - from: "app/router.tsx"
      to: "routeTree"
      via: "import"
      pattern: "routeTree\\.gen"
---

<objective>
Set up the foundational TanStack Start project with development toolchain

Purpose: Establish the core application scaffold with proper tooling for
consistent development workflow Output: Working TanStack Start app with biome
linting, lefthook pre-commit hooks, and mise toolchain management </objective>

<execution_context> @./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md </execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize TanStack Start project with dependencies</name>
  <files>package.json, pnpm-lock.yaml, tsconfig.json</files>
  <action>
Initialize a new TanStack Start project:

1. Update package.json with all required dependencies (pinned versions from
   RESEARCH.md):
   - @tanstack/react-start@1.140.5 (MUST pin - Cloudflare bug in later versions)
   - @tanstack/react-router@1.140.5 (MUST pin - must match start version)
   - @tanstack/react-query@^5
   - react@^19, react-dom@^19
   - typescript@^5.7
   - @types/react, @types/react-dom
   - @biomejs/biome@^1.9 (dev)
   - lefthook (dev)
   - vite (dev)

2. Add scripts to package.json:
   - "dev": "vinxi dev"
   - "build": "vinxi build"
   - "start": "vinxi start"
   - "typecheck": "tsc --noEmit"
   - "lint": "biome check ."
   - "lint:fix": "biome check --write ."
   - "format": "biome format --write ."

3. Create tsconfig.json with:
   - Strict mode enabled
   - Module resolution for bundler
   - JSX support for react-jsx
   - Path aliases (@/ for app/)
   - Include app/\*_/_

Run: pnpm install </action> <verify> Run: pnpm install && pnpm tsc --version
Output should show TypeScript version installed without errors </verify>
<done>Dependencies installed, TypeScript compiles, package.json has all required
scripts</done> </task>

<task type="auto">
  <name>Task 2: Configure development toolchain (mise, biome, lefthook)</name>
  <files>mise.toml, biome.json, lefthook.yml, .gitignore</files>
  <action>
1. Create mise.toml:
```toml
[tools]
node = "22"

[env] \_.path = ["{{config_root}}/node_modules/.bin"]

[settings] experimental = true

````

2. Create biome.json:
```json
{
  "$schema": "https://biomejs.dev/schemas/1.9.4/schema.json",
  "organizeImports": { "enabled": true },
  "linter": {
    "enabled": true,
    "rules": { "recommended": true }
  },
  "formatter": {
    "enabled": true,
    "indentStyle": "space",
    "indentWidth": 2
  },
  "files": {
    "ignore": ["node_modules", "dist", ".vinxi", ".output", "convex/_generated"]
  }
}
````

3. Create lefthook.yml:

```yaml
pre-commit:
  commands:
    biome:
      glob: "*.{js,ts,jsx,tsx,json,jsonc}"
      run:
        pnpm biome check --write --no-errors-on-unmatched
        --files-ignore-unknown=true {staged_files}
      stage_fixed: true
    typecheck:
      glob: "*.{ts,tsx}"
      run: pnpm tsc --noEmit
```

4. Update .gitignore to include:
   - node_modules/
   - dist/
   - .vinxi/
   - .output/
   - \*.local
   - .env
   - .env.local

5. Run: pnpm lefthook install </action> <verify> Run: pnpm biome check . && echo
   "biome passed" Run: ls lefthook.yml mise.toml biome.json All three files
   should exist and biome should pass </verify> <done>Toolchain configured -
   mise manages Node.js version, biome handles lint/format, lefthook runs
   pre-commit hooks</done> </task>

<task type="auto">
  <name>Task 3: Create TanStack Start application scaffold</name>
  <files>app.config.ts, vite.config.ts, app/router.tsx, app/routes/__root.tsx, app/routes/index.tsx, app/client.tsx, app/ssr.tsx</files>
  <action>
1. Create app.config.ts (TanStack Start config):
```typescript
import { defineConfig } from '@tanstack/react-start/config';
import tsConfigPaths from 'vite-tsconfig-paths';

export default defineConfig({ vite: { plugins: [tsConfigPaths()], }, });

````

2. Create vite.config.ts:
```typescript
import { defineConfig } from 'vite';

export default defineConfig({});
````

3. Create app/router.tsx:

```typescript
import { createRouter as createTanStackRouter } from "@tanstack/react-router";
import { routeTree } from "./routeTree.gen";

export function createRouter() {
  const router = createTanStackRouter({
    routeTree,
  });

  return router;
}

declare module "@tanstack/react-router" {
  interface Register {
    router: ReturnType<typeof createRouter>;
  }
}
```

4. Create app/routes/\_\_root.tsx:

```typescript
import { createRootRoute, Outlet } from '@tanstack/react-router';

export const Route = createRootRoute({
  component: RootLayout,
});

function RootLayout() {
  return (
    <html lang="en">
      <head>
        <meta charSet="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>The Dahan Codex</title>
      </head>
      <body>
        <Outlet />
      </body>
    </html>
  );
}
```

5. Create app/routes/index.tsx:

```typescript
import { createFileRoute } from '@tanstack/react-router';

export const Route = createFileRoute('/')({
  component: HomePage,
});

function HomePage() {
  return (
    <main>
      <h1>The Dahan Codex</h1>
      <p>Spirit Island companion app</p>
    </main>
  );
}
```

Note: This is a minimal home page. Convex integration will be added in Plan 03
when the backend is set up.

````

6. Create app/client.tsx:
```typescript
import { hydrateRoot } from 'react-dom/client';
import { StartClient } from '@tanstack/react-start/client';
import { createRouter } from './router';

const router = createRouter();

hydrateRoot(document, <StartClient router={router} />);
````

7. Create app/ssr.tsx:

```typescript
import {
  createStartHandler,
  defaultStreamHandler,
} from "@tanstack/react-start/server";
import { getRouterManifest } from "@tanstack/react-start/router-manifest";
import { createRouter } from "./router";

export default createStartHandler({
  createRouter,
  getRouterManifest,
})(defaultStreamHandler);
```

8. Add vite-tsconfig-paths to dev dependencies: pnpm add -D vite-tsconfig-paths
   </action> <verify> Run: pnpm dev Server should start and display "The Dahan
   Codex" at http://localhost:3000 Press Ctrl+C to stop after verification
   </verify> <done>TanStack Start app runs locally with home page displaying
   correctly</done> </task>

</tasks>

<verification>
After all tasks complete:

1. Run `pnpm dev` - should start without errors
2. Visit http://localhost:3000 - should see "The Dahan Codex" heading
3. Run `pnpm biome check .` - should pass with no errors
4. Run `pnpm typecheck` - should pass with no errors
5. Create a test file change and attempt commit - lefthook should run biome
   </verification>

<success_criteria>

- TanStack Start dev server runs without errors
- Home page renders with "The Dahan Codex" title
- Biome linting passes on all files
- TypeScript compilation succeeds
- Pre-commit hooks execute on git commit
- mise.toml specifies Node.js 22 </success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-01-SUMMARY.md`
</output>
