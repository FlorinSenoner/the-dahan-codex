---
phase: 04-pwa-offline
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - app/components/pwa/offline-indicator.tsx
  - app/components/pwa/update-banner.tsx
  - app/components/pwa/install-prompt.tsx
autonomous: true

must_haves:
  truths:
    - "OfflineIndicator only renders when navigator.onLine is false"
    - "OfflineIndicator has accessible role='status' and aria-live"
    - "UpdateBanner appears when new service worker is waiting"
    - "UpdateBanner has Reload button that triggers SW update"
    - "InstallPrompt shows custom UI on Chromium browsers"
    - "InstallPrompt shows manual instructions for iOS"
  artifacts:
    - path: "app/components/pwa/offline-indicator.tsx"
      provides: "Offline status indicator for header"
      exports: ["OfflineIndicator"]
    - path: "app/components/pwa/update-banner.tsx"
      provides: "Non-dismissible update banner with reload button"
      exports: ["UpdateBanner"]
    - path: "app/components/pwa/install-prompt.tsx"
      provides: "Install prompt with iOS fallback instructions"
      exports: ["InstallPrompt"]
  key_links:
    - from: "app/components/pwa/offline-indicator.tsx"
      to: "app/hooks/use-online-status.ts"
      via: "useOnlineStatus hook"
      pattern: "useOnlineStatus"
    - from: "app/components/pwa/update-banner.tsx"
      to: "app/hooks/use-service-worker.ts"
      via: "triggerUpdate callback"
      pattern: "triggerUpdate"
    - from: "app/components/pwa/install-prompt.tsx"
      to: "app/hooks/use-install-prompt.ts"
      via: "promptInstall and isIOS"
      pattern: "useInstallPrompt"
---

<objective>
Create PWA UI components for offline indicator, update banner, and install prompt.

Purpose: Provide user-facing UI for PWA states - showing offline status, prompting for updates, and enabling app installation. These components consume the hooks created in Plan 01.

Output:
- OfflineIndicator component (shows only when offline)
- UpdateBanner component (non-dismissible with Reload button)
- InstallPrompt component (bottom banner with iOS instructions)
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-pwa-offline/04-CONTEXT.md
@.planning/phases/04-pwa-offline/04-01-SUMMARY.md
@app/hooks/use-online-status.ts
@app/hooks/use-service-worker.ts
@app/hooks/use-install-prompt.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OfflineIndicator component</name>
  <files>app/components/pwa/offline-indicator.tsx</files>
  <action>
    Create app/components/pwa/offline-indicator.tsx:

    1. Import useOnlineStatus hook
    2. Return null when online (component invisible)
    3. When offline, render fixed top banner:
       - Position: fixed top-0 left-0 right-0, z-50
       - Background: amber-600 (warning color)
       - Text: white, centered, small (text-sm)
       - Content: WifiOff icon from lucide-react + "You're offline"
       - Accessibility: role="status", aria-live="polite"
       - Animation: animate-in fade-in (Tailwind)
       - Padding: py-2 for comfortable touch
  </action>
  <verify>
    Component renders correctly in Storybook or dev with simulated offline state
  </verify>
  <done>
    OfflineIndicator only visible when offline, has accessible attributes
  </done>
</task>

<task type="auto">
  <name>Task 2: Create UpdateBanner component</name>
  <files>app/components/pwa/update-banner.tsx</files>
  <action>
    Create app/components/pwa/update-banner.tsx:

    1. Accept onReload prop (callback function)
    2. Non-dismissible design (no close button)
    3. Position: fixed top-0 left-0 right-0, z-50
    4. Background: primary color (subtle accent, not alarming)
    5. Content layout:
       - Message: "A new version is ready"
       - Button: "Reload" with contrasting background
       - Horizontal flex with gap
    6. Styling:
       - Text: primary-foreground
       - Button: bg-background text-foreground px-4 py-1 rounded
       - Padding: p-3 for banner
    7. Note: This component receives onReload from parent that calls triggerUpdate
  </action>
  <verify>
    Component renders with correct styling and button triggers onReload callback
  </verify>
  <done>
    UpdateBanner is non-dismissible, shows message and Reload button
  </done>
</task>

<task type="auto">
  <name>Task 3: Create InstallPrompt component</name>
  <files>app/components/pwa/install-prompt.tsx</files>
  <action>
    Create app/components/pwa/install-prompt.tsx:

    1. Import useInstallPrompt hook
    2. Track dismissed state locally (useState)
    3. Return null if:
       - isStandalone is true (already installed)
       - dismissed is true (user dismissed this session)
       - Not installable AND not iOS (nothing to show)

    4. For Chromium (isInstallable true):
       - Bottom banner position: fixed bottom-20 (above nav) left-4 right-4
       - Background: bg-card with border
       - Content: "Install for offline access" + Install button
       - Close button (X) to dismiss
       - onClick Install calls promptInstall()

    5. For iOS (isIOS true, not installable):
       - Same position as Chromium
       - Content: "Install this app"
       - Instructions: "Tap Share (box with arrow), then 'Add to Home Screen'"
       - Close button to dismiss

    6. Styling:
       - Rounded corners, shadow-lg
       - Padding p-4
       - z-40 (below offline indicator at z-50)
       - animate-in slide-in-from-bottom

    7. localStorage check: Don't show if dismissed within 7 days
       - Key: "pwa-install-dismissed"
       - Value: timestamp
  </action>
  <verify>
    Component shows on non-installed Chrome/iOS, respects 7-day dismissal
  </verify>
  <done>
    InstallPrompt shows platform-appropriate content, handles dismissal with localStorage
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. OfflineIndicator renders when offline, hidden when online
3. UpdateBanner displays message and functional Reload button
4. InstallPrompt shows correct UI for Chromium vs iOS
5. All components use proper z-index layering (offline > update > install)
</verification>

<success_criteria>
- OfflineIndicator only visible offline with amber background and WifiOff icon
- UpdateBanner non-dismissible with "A new version is ready" + Reload button
- InstallPrompt handles Chromium install prompt and iOS manual instructions
- Components use consistent positioning and z-index layering
</success_criteria>

<output>
After completion, create `.planning/phases/04-pwa-offline/04-02-SUMMARY.md`
</output>
