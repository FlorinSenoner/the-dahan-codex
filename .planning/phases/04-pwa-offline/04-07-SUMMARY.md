---
phase: 04-pwa-offline
plan: 07
subsystem: ui
tags: [pwa, settings, offline, idb-keyval, cache-management]

# Dependency graph
requires:
  - phase: 04-03
    provides: Original settings page with cache management UI
  - phase: 04-08
    provides: IndexedDB persistence via idb-keyval
provides:
  - Simplified settings page with single Cache Management section
  - Sync Data button that fetches all spirits including aspects
  - Clear Cache that removes both SW caches AND IndexedDB query cache
affects: [phase-5, any-settings-related]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Single cache management section pattern
    - idb-keyval del() for IndexedDB cleanup
    - getSpiritWithAspects for complete aspect data fetching

key-files:
  created: []
  modified:
    - app/routes/settings.tsx
    - e2e/settings.spec.ts

key-decisions:
  - "Consolidated Download + Refresh into single Sync Data button"
  - "Clear Cache must clear IndexedDB in addition to SW caches"
  - "Outline variant for both buttons (subtle, not alarming)"
  - "getSpiritWithAspects query for fetching all aspects with base spirit"

patterns-established:
  - "Settings cache management: Sync Data + Clear Cache pattern"
  - "Complete cache clear: del('tanstack-query-cache') + caches.delete + SW unregister"

# Metrics
duration: 2min
completed: 2026-01-28
---

# Phase 04 Plan 07: Simplify Settings Page Summary

**Simplified settings page with Sync Data button fetching all spirit data including aspects, and Clear Cache removing both SW caches and IndexedDB query cache**

## Performance

- **Duration:** 2 min
- **Started:** 2026-01-28T17:44:39Z
- **Completed:** 2026-01-28T17:46:23Z
- **Tasks:** 3 (combined into single commit)
- **Files modified:** 3

## Accomplishments

- Consolidated "Offline Access" and "Cache Management" sections into single section
- Sync Data button fetches all spirits including aspects via getSpiritWithAspects query
- Clear Cache now deletes IndexedDB "tanstack-query-cache" in addition to SW caches
- Subtle outline variant styling for both buttons (less alarming than destructive)
- Side-by-side button layout on desktop (flex-col on mobile, flex-row on sm+)
- Updated E2E tests to match new simplified UI

## Task Commits

All three tasks were implemented and committed atomically as they were interdependent:

1. **Task 1-3: Simplify settings page** - `9159bf7` (feat)
   - Consolidate sections and simplify button structure
   - Implement syncData function with getSpiritWithAspects
   - Add idb-keyval del() to clearCache function

## Files Created/Modified

- `app/routes/settings.tsx` - Simplified to single section with Sync Data and Clear Cache buttons
- `e2e/settings.spec.ts` - Updated tests for new UI (merged two tests into one)
- `app/routeTree.gen.ts` - Auto-regenerated by TanStack Router

## Decisions Made

- Combined all three plan tasks into single commit since they all modify the same file for the same goal
- Used `spirits.find(s => s._id === spirit.baseSpirit)` to resolve aspect base spirit slugs
- Status message auto-clears after 3 seconds on success via setTimeout
- Removed green/red status colors in favor of text-muted-foreground for all states

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Settings page cache management is now simplified and complete
- Ready for plan 04-08 (already complete - IndexedDB persistence)
- Ready for plan 04-09 (any remaining gap closure)

---
*Phase: 04-pwa-offline*
*Completed: 2026-01-28*
