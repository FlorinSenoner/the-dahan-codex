---
phase: 04-pwa-offline
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - app/routes/settings.tsx
autonomous: true

must_haves:
  truths:
    - "Settings page renders at /settings route"
    - "Settings page has Refresh Data button that clears API cache"
    - "Settings page has Clear Cache button that clears all caches"
    - "Cache management buttons show feedback when clicked"
  artifacts:
    - path: "app/routes/settings.tsx"
      provides: "Settings page with cache management"
      exports: ["Route"]
  key_links:
    - from: "app/routes/settings.tsx"
      to: "caches API"
      via: "caches.delete calls"
      pattern: "caches\\.delete"
---

<objective>
Create settings page with cache management functionality.

Purpose: Enable users to manually refresh data or clear all cached content when troubleshooting offline issues. The settings page also serves as the home for future app configuration.

Output:
- Settings route at /settings with cache management buttons
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-pwa-offline/04-CONTEXT.md
@.planning/phases/04-pwa-offline/04-RESEARCH.md
@app/routes/__root.tsx
@app/routes/credits.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create settings route</name>
  <files>app/routes/settings.tsx</files>
  <action>
    Create app/routes/settings.tsx:

    1. Create route using createFileRoute("/settings"):
       ```typescript
       import { createFileRoute } from "@tanstack/react-router";
       export const Route = createFileRoute("/settings")({
         component: SettingsPage,
       });
       ```

    2. SettingsPage component structure:
       - Container: max-w-lg mx-auto p-4 pb-24 (room for bottom nav)
       - Title: "Settings" (h1, text-2xl font-bold)
       - Section: "Cache Management" (h2, text-lg font-semibold, mt-6)
       - Description: Explain what cache management does

    3. State management:
       - isRefreshing: boolean for Refresh Data button loading state
       - isClearing: boolean for Clear Cache button loading state

    4. Refresh Data function:
       ```typescript
       async function refreshData() {
         setIsRefreshing(true);
         try {
           await caches.delete("convex-api-cache");
           window.location.reload();
         } catch (error) {
           console.error("Failed to refresh data:", error);
           setIsRefreshing(false);
         }
       }
       ```

    5. Clear Cache function:
       ```typescript
       async function clearCache() {
         setIsClearing(true);
         try {
           const cacheNames = await caches.keys();
           await Promise.all(cacheNames.map(name => caches.delete(name)));
           // Unregister service worker to force full refresh
           const registration = await navigator.serviceWorker.getRegistration();
           if (registration) {
             await registration.unregister();
           }
           window.location.reload();
         } catch (error) {
           console.error("Failed to clear cache:", error);
           setIsClearing(false);
         }
       }
       ```

    6. Button styling:
       - Use existing Button component from @/components/ui/button if available, otherwise use styled button
       - Refresh Data: variant outline, shows "Refreshing..." when loading
       - Clear Cache: variant destructive/red, shows "Clearing..." when loading
       - Both buttons: w-full, disabled when loading

    7. Add description text between buttons explaining:
       - Refresh Data: "Fetch fresh data while keeping app files cached"
       - Clear Cache: "Remove all cached data and app files. Useful if something seems broken."
  </action>
  <verify>
    Route exists and renders at /settings, buttons trigger cache operations
  </verify>
  <done>
    Settings page with working Refresh Data and Clear Cache buttons
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. Navigate to /settings in dev mode - page renders
3. Buttons show loading state when clicked
4. Clear Cache triggers SW unregister and reload
</verification>

<success_criteria>
- /settings route renders settings page
- Refresh Data button clears convex-api-cache and reloads
- Clear Cache button clears all caches, unregisters SW, and reloads
- Loading states prevent double-clicks
</success_criteria>

<output>
After completion, create `.planning/phases/04-pwa-offline/04-03-SUMMARY.md`
</output>
