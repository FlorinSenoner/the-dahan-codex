---
phase: 02-spirit-library
plan: 06
type: execute
wave: 3
depends_on: ["02-03", "02-05"]
files_modified:
  - app/components/layout/bottom-nav.tsx
  - app/routes/__root.tsx
  - app/routes/credits.tsx
  - e2e/spirits.spec.ts
autonomous: true

must_haves:
  truths:
    - "Bottom navigation tabs are visible on all pages"
    - "Spirits tab is active when on /spirits routes"
    - "Credits page shows attribution and legal disclaimer"
    - "E2E test verifies spirit list renders"
  artifacts:
    - path: "app/components/layout/bottom-nav.tsx"
      provides: "Bottom navigation component"
      exports: ["BottomNav"]
    - path: "app/routes/credits.tsx"
      provides: "Credits/attribution page"
      contains: "createFileRoute"
    - path: "e2e/spirits.spec.ts"
      provides: "Playwright tests for spirit library"
      contains: "test.describe"
  key_links:
    - from: "app/routes/__root.tsx"
      to: "app/components/layout/bottom-nav.tsx"
      via: "component render"
      pattern: "<BottomNav"
---

<objective>
Add bottom navigation tabs, credits/attribution page, and Playwright E2E tests for the spirit library.

Purpose: Complete the Phase 2 user experience with navigation and legal compliance, plus automated testing.
Output: Working bottom nav, credits page with disclaimer, passing E2E tests.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-spirit-library/02-CONTEXT.md
@app/routes/__root.tsx
@e2e/app.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create bottom navigation component</name>
  <files>
    app/components/layout/bottom-nav.tsx
    app/routes/__root.tsx
  </files>
  <action>
**Step 1: Create BottomNav component**

Create `app/components/layout/bottom-nav.tsx`:

```typescript
import { Link, useRouterState } from "@tanstack/react-router";
import { Ghost, BookOpen, Gamepad2, FileText, Settings } from "lucide-react";
import { cn } from "@/lib/utils";

// Tab definitions - expand as features are built
const tabs = [
  {
    name: "Spirits",
    href: "/spirits",
    icon: Ghost,
    matchPattern: /^\/spirits/,
  },
  {
    name: "Games",
    href: "/games",
    icon: Gamepad2,
    matchPattern: /^\/games/,
    disabled: true, // Phase 6
  },
  {
    name: "Notes",
    href: "/notes",
    icon: FileText,
    matchPattern: /^\/notes/,
    disabled: true, // Phase 6
  },
  {
    name: "Settings",
    href: "/settings",
    icon: Settings,
    matchPattern: /^\/settings/,
    disabled: true, // Future
  },
] as const;

export function BottomNav() {
  const routerState = useRouterState();
  const currentPath = routerState.location.pathname;

  return (
    <nav className="fixed bottom-0 left-0 right-0 z-50 bg-background border-t border-border">
      <div className="flex items-center justify-around h-16 max-w-lg mx-auto">
        {tabs.map((tab) => {
          const isActive = tab.matchPattern.test(currentPath);
          const Icon = tab.icon;

          if (tab.disabled) {
            return (
              <div
                key={tab.name}
                className="flex flex-col items-center justify-center flex-1 h-full opacity-40"
              >
                <Icon className="h-5 w-5 text-muted-foreground" />
                <span className="text-xs text-muted-foreground mt-1">
                  {tab.name}
                </span>
              </div>
            );
          }

          return (
            <Link
              key={tab.name}
              to={tab.href}
              className={cn(
                "flex flex-col items-center justify-center flex-1 h-full",
                "transition-colors",
                isActive
                  ? "text-primary"
                  : "text-muted-foreground hover:text-foreground"
              )}
            >
              <Icon
                className={cn(
                  "h-5 w-5",
                  isActive && "text-primary"
                )}
              />
              <span
                className={cn(
                  "text-xs mt-1",
                  isActive ? "font-medium" : ""
                )}
              >
                {tab.name}
              </span>
            </Link>
          );
        })}
      </div>
      {/* Safe area inset for iOS */}
      <div className="h-safe-area-inset-bottom bg-background" />
    </nav>
  );
}
```

**Step 2: Add safe area CSS to globals.css**

Add to `app/styles/globals.css`:

```css
/* Safe area for iOS bottom nav */
.h-safe-area-inset-bottom {
  height: env(safe-area-inset-bottom, 0px);
}
```

**Step 3: Update __root.tsx to include BottomNav**

Update `app/routes/__root.tsx` to render BottomNav below the Outlet:

```typescript
import { ClerkProvider, useAuth } from "@clerk/clerk-react";
import {
  createRootRoute,
  HeadContent,
  Outlet,
  Scripts,
} from "@tanstack/react-router";
import { ConvexProviderWithClerk } from "convex/react-clerk";
import type { ReactNode } from "react";
import { useEffect, useState } from "react";
import { convex } from "../lib/convex";
import { registerSW } from "../lib/sw-register";
import { BottomNav } from "../components/layout/bottom-nav";
import "../styles/globals.css";

export const Route = createRootRoute({
  head: () => ({
    meta: [
      { charSet: "UTF-8" },
      { name: "viewport", content: "width=device-width, initial-scale=1.0" },
      { name: "theme-color", content: "#1a1a1a" },
    ],
    links: [
      { rel: "manifest", href: "/manifest.json" },
      { rel: "icon", href: "/icons/icon-192.png" },
      { rel: "apple-touch-icon", href: "/icons/icon-192.png" },
    ],
  }),
  component: RootLayout,
  shellComponent: RootDocument,
});

function RootDocument({ children }: { children: ReactNode }) {
  return (
    <html lang="en" className="dark">
      <head>
        <HeadContent />
      </head>
      <body className="font-body antialiased bg-background text-foreground">
        {children}
        <Scripts />
      </body>
    </html>
  );
}

function RootLayout() {
  const [isMounted, setIsMounted] = useState(false);

  useEffect(() => {
    setIsMounted(true);
    registerSW();
  }, []);

  if (!isMounted) {
    return <Outlet />;
  }

  return (
    <ClerkProvider
      publishableKey={import.meta.env.VITE_CLERK_PUBLISHABLE_KEY}
      afterSignOutUrl="/"
      signInUrl="/sign-in"
      signUpUrl="/sign-in"
      signInFallbackRedirectUrl="/"
      signUpFallbackRedirectUrl="/"
    >
      <ConvexProviderWithClerk client={convex} useAuth={useAuth}>
        <Outlet />
        <BottomNav />
      </ConvexProviderWithClerk>
    </ClerkProvider>
  );
}
```
  </action>
  <verify>
Run `pnpm typecheck` - should pass.
Visit any page - bottom nav should be visible.
Spirits tab should be active on /spirits and /spirits/{slug}.
Disabled tabs should appear grayed out.
  </verify>
  <done>
- BottomNav component with Spirits, Games, Notes, Settings tabs
- Spirits tab active on spirit routes
- Disabled tabs for future features
- Safe area handling for iOS
  </done>
</task>

<task type="auto">
  <name>Task 2: Create credits/attribution page</name>
  <files>app/routes/credits.tsx</files>
  <action>
Create `app/routes/credits.tsx`:

```typescript
import { createFileRoute, Link } from "@tanstack/react-router";
import { ArrowLeft, ExternalLink } from "lucide-react";
import { Button } from "@/components/ui/button";

export const Route = createFileRoute("/credits")({
  component: CreditsPage,
});

function CreditsPage() {
  return (
    <div className="min-h-screen bg-background pb-20">
      {/* Header */}
      <header className="sticky top-0 z-10 bg-background/95 backdrop-blur border-b border-border px-4 py-3">
        <div className="flex items-center gap-3">
          <Link to="/spirits">
            <Button variant="ghost" size="icon">
              <ArrowLeft className="h-5 w-5" />
            </Button>
          </Link>
          <h1 className="font-serif text-xl font-semibold">Credits</h1>
        </div>
      </header>

      <main className="p-4 max-w-2xl mx-auto space-y-8">
        {/* Legal Disclaimer */}
        <section className="bg-card border border-border rounded-lg p-4">
          <h2 className="font-serif text-lg font-semibold text-foreground mb-3">
            Legal Disclaimer
          </h2>
          <p className="text-sm text-muted-foreground leading-relaxed">
            The Dahan Codex is an unofficial fan project and is not affiliated
            with Greater Than Games, LLC. Spirit Island and all related
            materials, names, and images are the property of Greater Than Games,
            LLC.
          </p>
        </section>

        {/* Data Sources */}
        <section>
          <h2 className="font-serif text-lg font-semibold text-foreground mb-4">
            Data Sources
          </h2>
          <div className="space-y-3">
            <SourceLink
              name="Spirit Island Wiki"
              url="https://spiritislandwiki.com"
              description="Spirit details, strategies, and rulings"
            />
            <SourceLink
              name="Spirit Island Card Catalog"
              url="https://sick.oberien.de"
              description="Card images and search"
            />
            <SourceLink
              name="Spirit Island FAQ"
              url="https://querki.net/u/darker/spirit-island-faq"
              description="Official rulings and clarifications"
            />
          </div>
        </section>

        {/* Community */}
        <section>
          <h2 className="font-serif text-lg font-semibold text-foreground mb-4">
            Community
          </h2>
          <div className="space-y-3">
            <SourceLink
              name="r/spiritisland"
              url="https://reddit.com/r/spiritisland"
              description="Spirit Island subreddit"
            />
            <SourceLink
              name="BoardGameGeek"
              url="https://boardgamegeek.com/boardgame/162886/spirit-island"
              description="Spirit Island on BGG"
            />
          </div>
        </section>

        {/* Acknowledgments */}
        <section>
          <h2 className="font-serif text-lg font-semibold text-foreground mb-4">
            Acknowledgments
          </h2>
          <p className="text-sm text-muted-foreground leading-relaxed">
            Thank you to Eric Reuss for creating Spirit Island, the wiki editors
            for maintaining comprehensive documentation, and the Spirit Island
            community for sharing strategies and openings.
          </p>
        </section>

        {/* App Info */}
        <section className="text-center pt-4 border-t border-border">
          <p className="text-xs text-muted-foreground">
            The Dahan Codex v1.0.0
          </p>
          <p className="text-xs text-muted-foreground mt-1">
            Made with care for the Spirit Island community
          </p>
        </section>
      </main>
    </div>
  );
}

function SourceLink({
  name,
  url,
  description,
}: {
  name: string;
  url: string;
  description: string;
}) {
  return (
    <a
      href={url}
      target="_blank"
      rel="noopener noreferrer"
      className="flex items-start gap-3 p-3 rounded-lg bg-card border border-border hover:bg-muted/50 transition-colors"
    >
      <div className="flex-1">
        <div className="flex items-center gap-2">
          <span className="font-medium text-foreground">{name}</span>
          <ExternalLink className="h-3 w-3 text-muted-foreground" />
        </div>
        <p className="text-sm text-muted-foreground mt-0.5">{description}</p>
      </div>
    </a>
  );
}
```
  </action>
  <verify>
Run `pnpm typecheck` - should pass.
Visit /credits - should show attribution page.
Legal disclaimer should be visible.
External links should open in new tab.
  </verify>
  <done>
- Credits route at /credits
- Legal disclaimer about Greater Than Games
- Links to Spirit Island Wiki, Card Catalog, FAQ
- Community links (Reddit, BGG)
- Acknowledgments section
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Playwright E2E tests for spirit library</name>
  <files>e2e/spirits.spec.ts</files>
  <action>
Create `e2e/spirits.spec.ts`:

```typescript
import { expect, test } from "@playwright/test";

test.describe("Spirit Library", () => {
  test("spirit list renders with spirits", async ({ page }) => {
    await page.goto("/spirits");

    // Wait for page to load
    await expect(
      page.getByRole("heading", { name: /spirits/i })
    ).toBeVisible();

    // Wait for spirits to load from Convex (may take a moment)
    await expect(
      page.getByRole("link", { name: /river surges in sunlight/i })
    ).toBeVisible({ timeout: 15000 });

    // Verify Lightning is also present
    await expect(
      page.getByRole("link", { name: /lightning's swift strike/i })
    ).toBeVisible();
  });

  test("filter button opens bottom sheet", async ({ page }) => {
    await page.goto("/spirits");

    // Wait for page to load
    await expect(
      page.getByRole("heading", { name: /spirits/i })
    ).toBeVisible();

    // Click filter button
    await page.getByRole("button", { name: /filter/i }).click();

    // Verify drawer opens with filter options
    await expect(
      page.getByRole("heading", { name: /filter spirits/i })
    ).toBeVisible();

    // Verify complexity options are present
    await expect(page.getByText("Low")).toBeVisible();
    await expect(page.getByText("Moderate")).toBeVisible();
  });

  test("clicking spirit navigates to detail page", async ({ page }) => {
    await page.goto("/spirits");

    // Wait for spirits to load
    await expect(
      page.getByRole("link", { name: /river surges in sunlight/i })
    ).toBeVisible({ timeout: 15000 });

    // Click on River
    await page.getByRole("link", { name: /river surges in sunlight/i }).first().click();

    // Verify URL changed
    await expect(page).toHaveURL(/\/spirits\/river-surges-in-sunlight/);

    // Verify detail page content
    await expect(
      page.getByRole("heading", { name: /river surges in sunlight/i })
    ).toBeVisible();
  });

  test("bottom navigation is visible", async ({ page }) => {
    await page.goto("/spirits");

    // Wait for page to load
    await expect(
      page.getByRole("heading", { name: /spirits/i })
    ).toBeVisible();

    // Verify bottom nav is present
    await expect(page.getByRole("navigation")).toBeVisible();

    // Verify Spirits tab is present and active
    await expect(page.getByRole("link", { name: /spirits/i })).toBeVisible();
  });

  test("credits page shows disclaimer", async ({ page }) => {
    await page.goto("/credits");

    // Verify page loads
    await expect(
      page.getByRole("heading", { name: /credits/i })
    ).toBeVisible();

    // Verify legal disclaimer is present
    await expect(
      page.getByText(/not affiliated with greater than games/i)
    ).toBeVisible();

    // Verify external links are present
    await expect(
      page.getByRole("link", { name: /spirit island wiki/i })
    ).toBeVisible();
  });
});
```

**Note:** Tests depend on seed data being present in Convex. The seed mutation should be run before E2E tests (either in CI setup or as part of test fixtures).
  </action>
  <verify>
Run `pnpm build` then `pnpm test:e2e` - tests should pass.
All 5 tests should complete successfully.
  </verify>
  <done>
- E2E test: spirit list renders
- E2E test: filter button opens sheet
- E2E test: clicking spirit navigates to detail
- E2E test: bottom nav is visible
- E2E test: credits page shows disclaimer
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `pnpm typecheck` passes
2. `pnpm lint` passes
3. Bottom nav visible on all pages
4. Spirits tab highlighted on /spirits routes
5. /credits page shows legal disclaimer and links
6. `pnpm test:e2e` passes all 5 spirit tests
</verification>

<success_criteria>
- Bottom navigation with 4 tabs (1 active, 3 disabled)
- Credits page with legal disclaimer (DATA-05)
- Attribution links to external sources (DATA-04)
- E2E tests verify spirit list renders (TEST-01)
- All tests pass in CI
</success_criteria>

<output>
After completion, create `.planning/phases/02-spirit-library/02-06-SUMMARY.md`
</output>
