---
phase: 05-text-opening-management
plan: 14
type: execute
wave: 4
depends_on: ["05-09", "05-10", "05-11"]
files_modified:
  - app/components/spirits/opening-section.tsx
  - app/components/ui/tabs.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All openings for a spirit are visible via tabs UI"
    - "Admin can create additional openings"
    - "User can switch between openings using tabs"
    - "Each opening tab shows the opening name"
  artifacts:
    - path: "app/components/spirits/opening-section.tsx"
      provides: "Multi-opening tabs UI"
      contains: "Tabs"
    - path: "app/components/ui/tabs.tsx"
      provides: "Tabs component"
  key_links:
    - from: "app/components/spirits/opening-section.tsx"
      to: "convex/openings.ts"
      via: "listBySpirit query"
      pattern: "listBySpirit"
    - from: "app/routes/spirits.$slug.tsx"
      to: "URL search params"
      via: "useSearch and navigate"
      pattern: "opening:\\s*\\w+"
---

<objective>
Add support for multiple openings per spirit with tabs UI. Currently only first opening is shown.

Purpose: Allow spirits to have multiple opening strategies (e.g., "Aggressive", "Defensive", "Standard")
Output: Tabs interface for viewing and managing multiple openings
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-text-opening-management/05-VERIFICATION.md
@.planning/phases/05-text-opening-management/05-09-SUMMARY.md
@.planning/phases/05-text-opening-management/05-10-SUMMARY.md

GAP-09 from VERIFICATION.md:
Current implementation only shows `openings[0]`, ignoring additional openings.
Need tabs UI for multiple openings, allow creating additional openings.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Tabs component if not exists</name>
  <files>app/components/ui/tabs.tsx</files>
  <action>
  Check if Tabs component exists. If not, add from shadcn:

  Run: `npx shadcn@latest add tabs`

  This provides:
  - Tabs (root)
  - TabsList
  - TabsTrigger
  - TabsContent

  Skip if component already exists.
  </action>
  <verify>
  File exists: app/components/ui/tabs.tsx
  Run `pnpm typecheck` - compiles
  </verify>
  <done>Tabs component available</done>
</task>

<task type="auto">
  <name>Task 2: Implement multi-opening tabs UI</name>
  <files>app/components/spirits/opening-section.tsx</files>
  <action>
  Refactor OpeningSection to support multiple openings:

  1. Sync selected tab to URL query parameter (like edit mode uses ?edit=true):
     ```tsx
     // Read from URL search params
     const searchParams = useSearch({ from: '/spirits/$slug' });
     const openingParam = searchParams.opening;

     // Find opening index from URL or default to first
     const selectedIndex = openings?.findIndex(o => o._id === openingParam) ?? 0;

     // Update URL when tab changes
     const navigate = useNavigate();
     const handleTabChange = (openingId: string) => {
       navigate({
         search: (prev) => ({ ...prev, opening: openingId }),
         replace: true
       });
     };
     ```

  2. Replace single opening logic with tabs:
     - Query returns array of openings
     - Show TabsList with one TabsTrigger per opening
     - Show "+ Add Opening" button in edit mode

  3. UI Structure in read mode (when openings exist):
     ```tsx
     <Tabs value={selectedOpening?._id} onValueChange={handleTabChange}>
       <TabsList>
         {openings.map((opening) => (
           <TabsTrigger key={opening._id} value={opening._id}>
             {opening.name}
           </TabsTrigger>
         ))}
       </TabsList>
       {openings.map((opening) => (
         <TabsContent key={opening._id} value={opening._id}>
           <div className="bg-card border ...">
             {/* Opening display */}
           </div>
         </TabsContent>
       ))}
     </Tabs>
     ```

  4. UI Structure in edit mode:
     - Same tabs but with editable content
     - Add "+ New Opening" button after last tab
     - When creating new, show form inline

  5. State management updates:
     - formData state should track which opening is being edited
     - When creating new opening, add a "new" tab
     - After save, new opening appears in tabs

  Key changes:
  - Replace `const opening = openings?.[0] ?? null` with selected opening logic
  - Update formData initialization to work with selected opening
  - Update save handler to work with selected opening
  - Keep the current form data structure, just track which opening

  6. Update route search params schema in spirits.$slug.tsx:
     ```tsx
     export const Route = createFileRoute('/spirits/$slug')({
       validateSearch: (search) => ({
         edit: search.edit === 'true',
         opening: typeof search.opening === 'string' ? search.opening : undefined
       }),
     });
     ```
  </action>
  <verify>
  Run `pnpm typecheck` - compiles
  Run `pnpm build` - builds successfully
  </verify>
  <done>Multiple openings displayed in tabs UI</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. `pnpm build` succeeds
3. Manual test: Spirit with multiple openings shows tabs
4. Manual test: Clicking tabs switches displayed opening
5. Manual test: In edit mode, can create additional opening
6. Manual test: Each opening can be edited independently
7. Manual test: Selected tab persists in URL (?opening=<id>)
8. Manual test: Refreshing page with ?opening param shows correct tab
</verification>

<success_criteria>
- Tabs component available in UI library
- Spirits with multiple openings show all via tabs
- Tab names are opening names
- Can switch between openings by clicking tabs
- Selected tab syncs to URL query parameter (?opening=<id>)
- Refreshing page preserves selected tab via URL
- In edit mode, can add new opening
- Each opening editable independently
</success_criteria>

<output>
After completion, create `.planning/phases/05-text-opening-management/05-14-SUMMARY.md`
</output>
