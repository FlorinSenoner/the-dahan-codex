---
phase: 05-text-opening-management
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - app/hooks/use-admin.ts
  - convex/lib/auth.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Admin check uses role field for future flexibility"
    - "Existing admin users continue to work if they have role set"
  artifacts:
    - path: "app/hooks/use-admin.ts"
      provides: "Client-side admin role check"
      contains: "role.*admin"
    - path: "convex/lib/auth.ts"
      provides: "Server-side admin role check"
      contains: "role.*admin"
  key_links:
    - from: "app/hooks/use-admin.ts"
      to: "Clerk publicMetadata"
      via: "useUser hook"
      pattern: "publicMetadata.*role"
---

<objective>
Update admin role system from boolean `isAdmin` to string `role: "admin"` for future flexibility (moderator, contributor roles).

Purpose: Enable role-based access control expansion in the future without another migration
Output: Both client and server admin checks use `role === "admin"` pattern
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-text-opening-management/05-VERIFICATION.md

GAP-01 from VERIFICATION.md:
Current implementation uses `isAdmin: true` in Clerk publicMetadata.
Should use `role: "admin"` for future flexibility (moderator, contributor, etc.)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update client-side admin hook</name>
  <files>app/hooks/use-admin.ts</files>
  <action>
  Update useAdmin hook to check `user.publicMetadata?.role === "admin"` instead of `user.publicMetadata?.isAdmin === true`.

  Update JSDoc comment to reflect the new pattern:
  - Change "isAdmin === true" to "role === 'admin'"
  - Mention that role can be "admin", "moderator", "contributor" etc. for future expansion
  </action>
  <verify>TypeScript compiles: `pnpm typecheck`</verify>
  <done>Hook returns true when `publicMetadata.role === "admin"`</done>
</task>

<task type="auto">
  <name>Task 2: Update server-side admin check</name>
  <files>convex/lib/auth.ts</files>
  <action>
  Update isAdmin function to check for `role` claim instead of `isAdmin` claim:
  - Change `(identity as any).isAdmin === true` to `(identity as any).role === "admin"`
  - Update JSDoc comment to mention role-based check
  - Update biome-ignore comment to explain we're checking custom role claim
  </action>
  <verify>
  TypeScript compiles: `pnpm typecheck`
  Convex functions still type-check
  </verify>
  <done>Server-side admin check uses role field</done>
</task>

</tasks>

<verification>
1. Run `pnpm typecheck` - no errors
2. Run `pnpm build` - builds successfully
3. Manual test: Set `role: "admin"` in Clerk user metadata, confirm admin features work
</verification>

<success_criteria>
- Both files updated to use `role === "admin"` pattern
- TypeScript and build pass
- No references to `isAdmin` remain in either file
</success_criteria>

<output>
After completion, create `.planning/phases/05-text-opening-management/05-07-SUMMARY.md`
</output>
