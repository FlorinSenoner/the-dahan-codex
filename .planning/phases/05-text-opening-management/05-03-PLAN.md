---
phase: 05-text-opening-management
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/admin/edit-fab.tsx
  - app/hooks/use-edit-mode.ts
  - app/hooks/index.ts
autonomous: true

must_haves:
  truths:
    - "Edit FAB only visible for admin users"
    - "Edit mode state persists in URL as ?edit=true"
    - "Non-admins cannot activate edit mode even with ?edit=true in URL"
  artifacts:
    - path: "app/components/admin/edit-fab.tsx"
      provides: "Floating edit toggle button"
      exports: ["EditFab"]
    - path: "app/hooks/use-edit-mode.ts"
      provides: "Edit mode hook with URL state"
      exports: ["useEditMode"]
  key_links:
    - from: "app/hooks/use-edit-mode.ts"
      to: "@tanstack/react-router"
      via: "useSearch and useNavigate"
      pattern: "useSearch.*useNavigate"
    - from: "app/components/admin/edit-fab.tsx"
      to: "app/hooks/use-edit-mode.ts"
      via: "useEditMode hook"
      pattern: "useEditMode"
---

<objective>
Create edit mode infrastructure: URL-based edit state and floating action button for admins.

Purpose: Establish the edit mode toggle that transforms spirit detail pages into editable interfaces for admins only.
Output: useEditMode hook with URL state, EditFab component with save/edit buttons.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/05-text-opening-management/05-CONTEXT.md
@.planning/phases/05-text-opening-management/05-RESEARCH.md
@app/hooks/index.ts
@app/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useEditMode hook</name>
  <files>app/hooks/use-edit-mode.ts, app/hooks/index.ts</files>
  <action>
Create app/hooks/use-edit-mode.ts:

1. Hook takes route path as generic type parameter for type safety
2. Uses useSearch to read edit param from URL
3. Uses useNavigate to toggle edit state
4. Combines with useAdmin to ensure only admins can edit
5. Returns { isEditing, toggleEdit, setEditing }

```typescript
import { useNavigate, useSearch } from '@tanstack/react-router';
import { useCallback } from 'react';
import { useAdmin } from './use-admin';

interface EditModeState {
  isEditing: boolean;
  toggleEdit: () => void;
  setEditing: (editing: boolean) => void;
}

export function useEditMode(): EditModeState {
  // Get edit param from URL - use generic search to work on any route
  const search = useSearch({ strict: false }) as { edit?: boolean };
  const navigate = useNavigate();
  const isAdmin = useAdmin();

  // Only activate edit mode if user is admin AND URL has edit=true
  const isEditing = isAdmin && search.edit === true;

  const setEditing = useCallback((editing: boolean) => {
    navigate({
      search: (prev: Record<string, unknown>) => ({
        ...prev,
        edit: editing || undefined, // Remove from URL when false
      }),
      replace: true,
    });
  }, [navigate]);

  const toggleEdit = useCallback(() => {
    setEditing(!isEditing);
  }, [isEditing, setEditing]);

  return { isEditing, toggleEdit, setEditing };
}
```

Add export to app/hooks/index.ts barrel file.
  </action>
  <verify>pnpm typecheck passes, hook exported from index.ts</verify>
  <done>useEditMode hook created with URL state management</done>
</task>

<task type="auto">
  <name>Task 2: Create EditFab component</name>
  <files>app/components/admin/edit-fab.tsx</files>
  <action>
Create app/components/admin directory and edit-fab.tsx:

1. Floating action button positioned bottom-right (above bottom nav: bottom-20)
2. Shows edit (Pencil) icon when not editing, check (Check) icon when editing
3. Shows save button when editing AND hasChanges is true
4. Uses existing Button component with size="icon" and rounded-full
5. Uses z-50 for proper stacking above content but below modals

```typescript
import { Check, Pencil, X } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { useAdmin } from '@/hooks';
import { useEditMode } from '@/hooks/use-edit-mode';

interface EditFabProps {
  onSave?: () => void;
  hasChanges?: boolean;
  isSaving?: boolean;
}

export function EditFab({ onSave, hasChanges, isSaving }: EditFabProps) {
  const isAdmin = useAdmin();
  const { isEditing, toggleEdit } = useEditMode();

  // Don't render for non-admins
  if (!isAdmin) {
    return null;
  }

  return (
    <div className="fixed bottom-20 right-4 z-50 flex gap-2">
      {isEditing && hasChanges && onSave && (
        <Button
          onClick={onSave}
          disabled={isSaving}
          size="icon"
          className="h-14 w-14 rounded-full shadow-lg"
          aria-label="Save changes"
        >
          <Check className="h-6 w-6" />
        </Button>
      )}
      <Button
        onClick={toggleEdit}
        variant={isEditing ? "secondary" : "default"}
        size="icon"
        className="h-14 w-14 rounded-full shadow-lg"
        aria-label={isEditing ? "Exit edit mode" : "Enter edit mode"}
      >
        {isEditing ? <X className="h-6 w-6" /> : <Pencil className="h-6 w-6" />}
      </Button>
    </div>
  );
}
```

Note: Using X icon when editing (to indicate "exit edit mode") per common pattern.
  </action>
  <verify>pnpm typecheck passes</verify>
  <done>EditFab component created with admin-only visibility and save button</done>
</task>

</tasks>

<verification>
1. pnpm typecheck passes
2. EditFab only renders when useAdmin() returns true
3. useEditMode respects admin status (isEditing false for non-admins even with ?edit=true in URL)
4. URL updates with ?edit=true when toggling
5. Save button appears only when hasChanges is true
6. Non-admin visiting URL with ?edit=true sees no edit UI (isEditing returns false)
</verification>

<success_criteria>
- EditFab hidden for non-admin users
- Edit mode toggles via URL state (?edit=true)
- Non-admins cannot activate edit mode even with URL param (defense in depth)
- Save button conditionally visible based on hasChanges prop
</success_criteria>

<output>
After completion, create `.planning/phases/05-text-opening-management/05-03-SUMMARY.md`
</output>
