---
phase: 05-text-opening-management
plan: 15
type: execute
wave: 1
depends_on: []
files_modified:
  - app/routes/spirits.index.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Search finds spirits by aspect name (e.g., 'Immense' finds Lightning's Swift Strike Immense aspect)"
    - "Search continues to find spirits by name, summary, and description"
  artifacts:
    - path: "app/routes/spirits.index.tsx"
      provides: "Spirit search filtering with aspectName"
      contains: "aspectName"
  key_links:
    - from: "filter function"
      to: "s.aspectName"
      via: "toLowerCase().includes()"
      pattern: "aspectName.*toLowerCase.*includes"
---

<objective>
Fix spirit search to include aspect names in filter results.

Purpose: Users searching for "Immense" or "Sunshine" should find spirits with those aspect names, not just base spirit names.
Output: Updated filter logic in spirits.index.tsx that checks aspectName field.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@app/routes/spirits.index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add aspectName to search filter</name>
  <files>app/routes/spirits.index.tsx</files>
  <action>
Update the filteredSpirits useMemo filter function (lines 61-66) to also check aspectName:

```typescript
return spirits.filter(
  (s) =>
    s.name.toLowerCase().includes(lower) ||
    s.aspectName?.toLowerCase().includes(lower) ||
    s.summary?.toLowerCase().includes(lower) ||
    s.description?.toLowerCase().includes(lower),
);
```

The aspectName field is optional (only aspects have it), so use optional chaining.
  </action>
  <verify>
1. Run `pnpm typecheck` - passes
2. Run `pnpm dev` and navigate to /spirits
3. Type "Immense" in search - should show "Lightning's Swift Strike (Immense)" aspect
4. Type "Sunshine" - should show "River Surges in Sunlight (Sunshine)" aspect
5. Type "River" - should still show base spirit and all aspects
  </verify>
  <done>Search filter includes aspectName field, aspects are discoverable by their aspect name</done>
</task>

</tasks>

<verification>
- `pnpm typecheck` passes
- Search for "Immense" finds Lightning aspect
- Search for "Travel" finds Travel River aspect
- Base spirit searches still work
</verification>

<success_criteria>
- Aspect names are searchable alongside spirit names
- No TypeScript errors introduced
- Existing search functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/05-text-opening-management/05-15-SUMMARY.md`
</output>
