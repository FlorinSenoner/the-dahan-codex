---
phase: 03.4-presence-track-graph-dsl
plan: 06
type: execute
wave: 4
depends_on: ["03.4-01", "03.4-04"]
files_modified:
  - convex/seed.ts
autonomous: true

must_haves:
  truths:
    - "Starlight's 6 tracks render as multi-row grid with unlocksGrowth flags"
    - "Finder's branching structure shows cross-track connections"
    - "Serpent's 3 tracks include Deep Slumber with presenceCap values"
  artifacts:
    - path: "convex/seed.ts"
      provides: "Complex spirit seed data with graph structures"
      contains: "unlocksGrowth"
  key_links:
    - from: "convex/seed.ts"
      to: "app/components/spirits/graph-presence-track.tsx"
      via: "presenceTracks data rendering"
      pattern: "presenceTracks"
---

<objective>
Convert complex spirits (Starlight, Finder, Serpent) to the Node-Edge Graph format with their unique track structures.

Purpose: These spirits have non-standard presence track layouts that require the graph model's full expressiveness - multiple tracks, cross-track connections, and special metadata.

Output: Updated convex/seed.ts with Starlight, Finder, and Serpent using Node-Edge Graph format
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-RESEARCH.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-01-SUMMARY.md
@convex/seed.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert Starlight Seeks Its Form to Node-Edge format</name>
  <files>convex/seed.ts</files>
  <action>
Update Starlight's presenceTracks to Node-Edge Graph format.

Starlight has 6 tracks arranged as:
- Row 0: Energy (4 nodes, unlocksGrowth) + Card Plays (4 nodes, unlocksGrowth)
- Row 1: Fire/Air elements (3 nodes, unlocksGrowth) + Water/Earth elements (3 nodes, unlocksGrowth)
- Row 2: Moon/Plant elements (3 nodes) + Sun/Animal elements (3 nodes)

Grid layout: 3 rows x 7 cols (two tracks per row, separated)

```typescript
presenceTracks: {
  rows: 3,
  cols: 7,
  bidirectional: false,
  nodes: [
    // Row 0: Energy track (left) + Card Plays track (right)
    { id: "en1", row: 0, col: 0, value: 1, trackType: "energy", unlocksGrowth: true },
    { id: "en2", row: 0, col: 1, value: 2, trackType: "energy", unlocksGrowth: true },
    { id: "en3", row: 0, col: 2, value: 3, trackType: "energy", unlocksGrowth: true },
    { id: "en4", row: 0, col: 3, value: 4, trackType: "energy", unlocksGrowth: true },
    { id: "cp1", row: 0, col: 4, value: 1, trackType: "cardPlays", unlocksGrowth: true },
    { id: "cp2", row: 0, col: 5, value: 2, trackType: "cardPlays", unlocksGrowth: true },
    { id: "cp3", row: 0, col: 6, value: 3, trackType: "cardPlays", unlocksGrowth: true },

    // Row 1: Fire/Air (left) + Water/Earth (right)
    { id: "fa1", row: 1, col: 0, value: 0, trackType: "elements", elements: ["Fire"], unlocksGrowth: true },
    { id: "fa2", row: 1, col: 1, value: 0, trackType: "elements", elements: ["Air"], unlocksGrowth: true },
    { id: "fa3", row: 1, col: 2, value: 0, trackType: "elements", elements: ["Fire", "Air"], unlocksGrowth: true },
    { id: "we1", row: 1, col: 4, value: 0, trackType: "elements", elements: ["Water"], unlocksGrowth: true },
    { id: "we2", row: 1, col: 5, value: 0, trackType: "elements", elements: ["Earth"], unlocksGrowth: true },
    { id: "we3", row: 1, col: 6, value: 0, trackType: "elements", elements: ["Water", "Earth"], unlocksGrowth: true },

    // Row 2: Moon/Plant (left) + Sun/Animal (right)
    { id: "mp1", row: 2, col: 0, value: 0, trackType: "elements", elements: ["Moon"] },
    { id: "mp2", row: 2, col: 1, value: 0, trackType: "elements", elements: ["Plant"] },
    { id: "mp3", row: 2, col: 2, value: 0, trackType: "elements", elements: ["Moon", "Plant"] },
    { id: "sa1", row: 2, col: 4, value: 0, trackType: "elements", elements: ["Sun"] },
    { id: "sa2", row: 2, col: 5, value: 0, trackType: "elements", elements: ["Animal"] },
    { id: "sa3", row: 2, col: 6, value: 0, trackType: "elements", elements: ["Sun", "Animal"] },
  ],
  edges: [
    // Energy track
    { from: "en1", to: "en2" },
    { from: "en2", to: "en3" },
    { from: "en3", to: "en4" },
    // Card Plays track
    { from: "cp1", to: "cp2" },
    { from: "cp2", to: "cp3" },
    // Fire/Air track
    { from: "fa1", to: "fa2" },
    { from: "fa2", to: "fa3" },
    // Water/Earth track
    { from: "we1", to: "we2" },
    { from: "we2", to: "we3" },
    // Moon/Plant track
    { from: "mp1", to: "mp2" },
    { from: "mp2", to: "mp3" },
    // Sun/Animal track
    { from: "sa1", to: "sa2" },
    { from: "sa2", to: "sa3" },
  ],
},
```

Note: Card Plays has only 3 nodes (1,2,3) based on original data, not 4.

Apply to BOTH seedSpirits and reseedSpirits functions.
  </action>
  <verify>
Starlight has 6 logical tracks in grid layout
unlocksGrowth: true on 4 tracks (Energy, CardPlays, Fire/Air, Water/Earth)
`pnpm typecheck` passes
  </verify>
  <done>
Starlight Seeks Its Form converted with 6 tracks and unlocksGrowth flags.
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert Finder of Paths Unseen to Node-Edge format</name>
  <files>convex/seed.ts</files>
  <action>
Update Finder's presenceTracks to Node-Edge Graph format.

Finder has branching tracks with bidirectional traversal:
- Row 0: Energy track (6 nodes)
- Row 1: Card Plays track (6 nodes)
- Connection between tracks at certain points (the old connectsTo/connectionPoint)

Grid layout: 2 rows x 6 cols, with cross-row edges

```typescript
presenceTracks: {
  rows: 2,
  cols: 6,
  bidirectional: true,  // Finder can move presence backwards
  nodes: [
    // Energy track (row 0)
    { id: "e1", row: 0, col: 0, value: 0, trackType: "energy" },
    { id: "e2", row: 0, col: 1, value: 1, trackType: "energy" },
    { id: "e3", row: 0, col: 2, value: 1, trackType: "energy" },
    { id: "e4", row: 0, col: 3, value: 2, trackType: "energy" },
    { id: "e5", row: 0, col: 4, value: 2, trackType: "energy" },
    { id: "e6", row: 0, col: 5, value: 3, trackType: "energy" },
    // Card Plays track (row 1)
    { id: "c1", row: 1, col: 0, value: 1, trackType: "cardPlays" },
    { id: "c2", row: 1, col: 1, value: 2, trackType: "cardPlays" },
    { id: "c3", row: 1, col: 2, value: 2, trackType: "cardPlays" },
    { id: "c4", row: 1, col: 3, value: 2, trackType: "cardPlays", reclaim: true },
    { id: "c5", row: 1, col: 4, value: 3, trackType: "cardPlays" },
    { id: "c6", row: 1, col: 5, value: 4, trackType: "cardPlays" },
  ],
  edges: [
    // Energy track progression
    { from: "e1", to: "e2" },
    { from: "e2", to: "e3" },
    { from: "e3", to: "e4" },
    { from: "e4", to: "e5" },
    { from: "e5", to: "e6" },
    // Card Plays track progression
    { from: "c1", to: "c2" },
    { from: "c2", to: "c3" },
    { from: "c3", to: "c4" },
    { from: "c4", to: "c5" },
    { from: "c5", to: "c6" },
    // Cross-track connection (from old connectionPoint: 3, meaning col 3)
    // Energy slot at col 3 connects to Card Plays slot at col 3
    { from: "e4", to: "c4" },
  ],
},
```

The key difference from linear spirits is:
- `bidirectional: true` - presence can move backwards along edges
- Cross-track edge from e4 to c4 (the old connectsTo connection)

Apply to BOTH seedSpirits and reseedSpirits functions.
  </action>
  <verify>
Finder has bidirectional: true
Contains cross-row edge from "e4" to "c4"
EdgeOverlay should render this as a visible connection line
`pnpm typecheck` passes
  </verify>
  <done>
Finder of Paths Unseen converted with bidirectional edges and cross-track connection.
  </done>
</task>

<task type="auto">
  <name>Task 3: Convert Serpent Slumbering to Node-Edge format</name>
  <files>convex/seed.ts</files>
  <action>
Update Serpent's presenceTracks to Node-Edge Graph format.

Serpent has 3 parallel tracks:
- Row 0: Energy track (7 nodes: 1,2,3,4(Fire),5,6(Fire),7)
- Row 1: Absorbed Essence track (6 nodes with elements)
- Row 2: Deep Slumber track (9 nodes with presenceCap)

Grid layout: 3 rows x 9 cols

```typescript
presenceTracks: {
  rows: 3,
  cols: 9,
  bidirectional: false,
  nodes: [
    // Energy track (row 0)
    { id: "en1", row: 0, col: 0, value: 1, trackType: "energy" },
    { id: "en2", row: 0, col: 1, value: 2, trackType: "energy" },
    { id: "en3", row: 0, col: 2, value: 3, trackType: "energy" },
    { id: "en4", row: 0, col: 3, value: 4, trackType: "energy", elements: ["Fire"] },
    { id: "en5", row: 0, col: 4, value: 5, trackType: "energy" },
    { id: "en6", row: 0, col: 5, value: 6, trackType: "energy", elements: ["Fire"] },
    { id: "en7", row: 0, col: 6, value: 7, trackType: "energy" },

    // Absorbed Essence track (row 1)
    { id: "ab1", row: 1, col: 0, value: 0, trackType: "elements" },
    { id: "ab2", row: 1, col: 1, value: 0, trackType: "elements", elements: ["Moon"] },
    { id: "ab3", row: 1, col: 2, value: 0, trackType: "elements", elements: ["Earth"] },
    { id: "ab4", row: 1, col: 3, value: 0, trackType: "elements", elements: ["Moon", "Earth"] },
    { id: "ab5", row: 1, col: 4, value: 0, trackType: "elements", elements: ["Fire"] },
    { id: "ab6", row: 1, col: 5, value: 0, trackType: "elements", elements: ["Moon", "Earth", "Fire"] },

    // Deep Slumber track (row 2) - presence cap values
    { id: "ds1", row: 2, col: 0, value: 5, trackType: "special", presenceCap: 5 },
    { id: "ds2", row: 2, col: 1, value: 6, trackType: "special", presenceCap: 6 },
    { id: "ds3", row: 2, col: 2, value: 7, trackType: "special", presenceCap: 7 },
    { id: "ds4", row: 2, col: 3, value: 8, trackType: "special", presenceCap: 8 },
    { id: "ds5", row: 2, col: 4, value: 9, trackType: "special", presenceCap: 9 },
    { id: "ds6", row: 2, col: 5, value: 10, trackType: "special", presenceCap: 10 },
    { id: "ds7", row: 2, col: 6, value: 11, trackType: "special", presenceCap: 11 },
    { id: "ds8", row: 2, col: 7, value: 12, trackType: "special", presenceCap: 12 },
    { id: "ds9", row: 2, col: 8, value: 13, trackType: "special", presenceCap: 13 },
  ],
  edges: [
    // Energy track
    { from: "en1", to: "en2" },
    { from: "en2", to: "en3" },
    { from: "en3", to: "en4" },
    { from: "en4", to: "en5" },
    { from: "en5", to: "en6" },
    { from: "en6", to: "en7" },
    // Absorbed Essence track
    { from: "ab1", to: "ab2" },
    { from: "ab2", to: "ab3" },
    { from: "ab3", to: "ab4" },
    { from: "ab4", to: "ab5" },
    { from: "ab5", to: "ab6" },
    // Deep Slumber track
    { from: "ds1", to: "ds2" },
    { from: "ds2", to: "ds3" },
    { from: "ds3", to: "ds4" },
    { from: "ds4", to: "ds5" },
    { from: "ds5", to: "ds6" },
    { from: "ds6", to: "ds7" },
    { from: "ds7", to: "ds8" },
    { from: "ds8", to: "ds9" },
  ],
},
```

Apply to BOTH seedSpirits and reseedSpirits functions.
  </action>
  <verify>
Serpent has 3 rows (Energy, Absorbed, Deep Slumber)
Deep Slumber nodes have presenceCap values 5-13
`pnpm typecheck` passes
  </verify>
  <done>
Serpent Slumbering Beneath the Island converted with 3 tracks including Deep Slumber.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. All complex spirits (Starlight, Finder, Serpent) use nodes/edges structure
3. Special metadata preserved: unlocksGrowth, presenceCap, elements
4. Finder has cross-track edge and bidirectional: true
</verification>

<success_criteria>
- Starlight has 6 logical tracks with unlocksGrowth on 4 tracks
- Finder has bidirectional edges and cross-track connection
- Serpent has Deep Slumber track with presenceCap values
- Both seedSpirits and reseedSpirits functions updated
</success_criteria>

<output>
After completion, create `.planning/phases/03.4-presence-track-graph-dsl/03.4-06-SUMMARY.md`
</output>
