---
phase: 03.4-presence-track-graph-dsl
plan: 10
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/schema.ts
  - app/components/icons/elements/any.tsx
  - app/components/icons/elements/star.tsx
  - app/components/icons/elements/index.ts
  - app/components/spirits/presence-node.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Any element icon renders as multicolor/wildcard symbol"
    - "Star element icon renders as distinct from Any"
    - "Energy slots show energy icon, not just number"
    - "Tooltips explain Any and Star mechanics"
  artifacts:
    - path: "app/components/icons/elements/any.tsx"
      provides: "Any element wildcard icon"
      min_lines: 15
    - path: "app/components/icons/elements/star.tsx"
      provides: "Star element icon"
      min_lines: 15
    - path: "app/components/icons/elements/index.ts"
      provides: "Updated ElementIcon record with Any and Star"
      contains: "Any"
    - path: "app/components/spirits/presence-node.tsx"
      provides: "Element icon rendering in presence slots"
      contains: "ElementIcon"
  key_links:
    - from: "app/components/spirits/presence-node.tsx"
      to: "app/components/icons/elements/index.ts"
      via: "ElementIcon import"
      pattern: "ElementIcon"
---

<objective>
Add "Any" and "Star" element support for presence track slots, plus visual element icons in PresenceNode.

Purpose: Some spirits have "Any" (wildcard) or "Star" (special) elements on their presence tracks. Currently the schema only supports the 8 basic elements and PresenceNode shows elements as text in tooltips only.

Output: New element icons and visual rendering in presence slots
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@app/components/icons/elements/index.ts
@app/components/icons/elements/sun.tsx
@app/components/spirits/presence-node.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Any element icon</name>
  <files>app/components/icons/elements/any.tsx</files>
  <action>
Create an "Any" element icon representing a wildcard that can be any element.

Design: A circle with multiple colored segments (like a pie chart) representing all elements, or a question mark inside a circle.

```tsx
import type { ElementIconProps } from "./air";

/**
 * Any Element icon - wildcard that can be any element.
 * Design: Circle with multicolor gradient representing all elements.
 */
export function AnyIcon({ size = 20, className }: ElementIconProps) {
  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 100 100"
      className={className}
      aria-hidden="true"
    >
      {/* Multicolor gradient circle representing "any element" */}
      <defs>
        <linearGradient id="any-element-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stopColor="#f59e0b" />   {/* Sun/amber */}
          <stop offset="16%" stopColor="#8b5cf6" />  {/* Moon/violet */}
          <stop offset="33%" stopColor="#f97316" />  {/* Fire/orange */}
          <stop offset="50%" stopColor="#8b5cf6" />  {/* Air/violet */}
          <stop offset="66%" stopColor="#3b82f6" />  {/* Water/blue */}
          <stop offset="83%" stopColor="#78716c" />  {/* Earth/stone */}
          <stop offset="100%" stopColor="#22c55e" /> {/* Plant/green */}
        </linearGradient>
      </defs>

      {/* Outer circle with gradient */}
      <circle
        cx="50"
        cy="50"
        r="45"
        fill="none"
        stroke="url(#any-element-gradient)"
        strokeWidth="8"
      />

      {/* Question mark in center */}
      <text
        x="50"
        y="58"
        textAnchor="middle"
        dominantBaseline="middle"
        fontSize="40"
        fontWeight="bold"
        fill="currentColor"
      >
        ?
      </text>
    </svg>
  );
}
```
  </action>
  <verify>
File exists: `ls app/components/icons/elements/any.tsx`
`pnpm typecheck` passes
  </verify>
  <done>
Any element icon created.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Star element icon</name>
  <files>app/components/icons/elements/star.tsx</files>
  <action>
Create a "Star" element icon for special star elements that appear on some spirits.

Design: A 5-pointed star shape in gold/yellow.

```tsx
import type { ElementIconProps } from "./air";

/**
 * Star Element icon - special element that appears on some spirit tracks.
 * Design: 5-pointed star in gold.
 */
export function StarIcon({ size = 20, className }: ElementIconProps) {
  return (
    <svg
      width={size}
      height={size}
      viewBox="0 0 100 100"
      className={className}
      aria-hidden="true"
    >
      <defs>
        <linearGradient id="star-element-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stopColor="#fcd34d" />   {/* Light gold */}
          <stop offset="100%" stopColor="#f59e0b" /> {/* Amber */}
        </linearGradient>
      </defs>

      {/* 5-pointed star */}
      <polygon
        points="50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40"
        fill="url(#star-element-gradient)"
        stroke="#d97706"
        strokeWidth="2"
      />
    </svg>
  );
}
```
  </action>
  <verify>
File exists: `ls app/components/icons/elements/star.tsx`
`pnpm typecheck` passes
  </verify>
  <done>
Star element icon created.
  </done>
</task>

<task type="auto">
  <name>Task 3: Export new icons from index</name>
  <files>app/components/icons/elements/index.ts</files>
  <action>
Update the elements index to export Any and Star icons and add them to the ElementIcon record.

```tsx
import type { ComponentType } from "react";
import { AirIcon, type ElementIconProps } from "./air";
import { AnimalIcon } from "./animal";
import { AnyIcon } from "./any";       // ADD
import { EarthIcon } from "./earth";
import { FireIcon } from "./fire";
import { MoonIcon } from "./moon";
import { PlantIcon } from "./plant";
import { StarIcon } from "./star";     // ADD
import { SunIcon } from "./sun";
import { WaterIcon } from "./water";

export type { ElementIconProps } from "./air";
export { AirIcon } from "./air";
export { AnimalIcon } from "./animal";
export { AnyIcon } from "./any";       // ADD
export { EarthIcon } from "./earth";
export { FireIcon } from "./fire";
export { MoonIcon } from "./moon";
export { PlantIcon } from "./plant";
export { StarIcon } from "./star";     // ADD
export { SunIcon } from "./sun";
export { WaterIcon } from "./water";

/**
 * Mapping of element names to their icon components.
 * Enables dynamic rendering: ElementIcon["Sun"] returns SunIcon
 */
export const ElementIcon: Record<string, ComponentType<ElementIconProps>> = {
  Sun: SunIcon,
  Moon: MoonIcon,
  Fire: FireIcon,
  Air: AirIcon,
  Water: WaterIcon,
  Earth: EarthIcon,
  Plant: PlantIcon,
  Animal: AnimalIcon,
  Any: AnyIcon,     // ADD
  Star: StarIcon,   // ADD
};
```
  </action>
  <verify>
ElementIcon has Any and Star keys
`pnpm typecheck` passes
  </verify>
  <done>
Any and Star icons exported and registered.
  </done>
</task>

<task type="auto">
  <name>Task 4: Render element icons in PresenceNode</name>
  <files>app/components/spirits/presence-node.tsx</files>
  <action>
Update PresenceNode to visually render element icons, not just show them in tooltips.

Import ElementIcon:
```tsx
import { ElementIcon } from "@/components/icons/elements";
```

Update the component to render element icons below the main value. Modify the button content:

```tsx
<button
  type="button"
  className={cn(/* existing classes */)}
  style={style}
  aria-label={tooltipLines.join(". ")}
>
  <div className="flex flex-col items-center gap-0.5">
    {/* Main value */}
    <span>{displayValue}</span>

    {/* Element icons (if any) */}
    {elements && elements.length > 0 && (
      <div className="flex gap-0.5">
        {elements.map((element) => {
          const Icon = ElementIcon[element];
          return Icon ? (
            <Icon key={element} size={12} className="opacity-80" />
          ) : null;
        })}
      </div>
    )}
  </div>
</button>
```

Also update tooltip to explain Any and Star elements:
- Any: "Any Element (choose when revealed)"
- Star: "Star Element"

Update the tooltip section for elements:
```tsx
// Add elements
if (elements && elements.length > 0) {
  const elementDescriptions = elements.map((el) => {
    if (el === "Any") return "Any Element (choose when revealed)";
    if (el === "Star") return "Star Element";
    return el;
  });
  tooltipLines.push(`+${elementDescriptions.join(", ")}`);
}
```

Note: The button size might need adjustment. Current is w-11 h-11 (44px). With elements below, may need slightly taller. Consider changing to:
- `min-h-[44px]` instead of `h-11` to allow growth
- Or wrap elements in a conditional that shows only if no value (element-only slots)
  </action>
  <verify>
`pnpm typecheck` passes
ElementIcon imported in presence-node.tsx
Elements rendered visually in slots
  </verify>
  <done>
Element icons render in presence slots with explanatory tooltips.
  </done>
</task>

</tasks>

<verification>
1. Any and Star icon files exist
2. ElementIcon record has Any and Star
3. PresenceNode renders element icons visually
4. Tooltips explain Any and Star mechanics
5. `pnpm typecheck` passes
</verification>

<success_criteria>
- Any icon: multicolor gradient with question mark
- Star icon: 5-pointed gold star
- Both added to ElementIcon record
- PresenceNode shows element icons, not just text
- Any/Star tooltips explain mechanics
</success_criteria>

<output>
After completion, create `.planning/phases/03.4-presence-track-graph-dsl/03.4-10-SUMMARY.md`
</output>
