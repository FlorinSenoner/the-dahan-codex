---
status: diagnosed
phase: 03.4-presence-track-graph-dsl
source: 03.4-01-SUMMARY.md, 03.4-02-SUMMARY.md, 03.4-03-SUMMARY.md, 03.4-04-SUMMARY.md, 03.4-05-SUMMARY.md, 03.4-06-SUMMARY.md
started: 2026-01-27T13:05:00Z
updated: 2026-01-27T15:00:00Z
---

## Current Test
<!-- OVERWRITE each test - shows where we are -->

[testing complete]

## Tests

### 1. Simple Spirit Presence Track Display
expected: Navigate to River Surges in Sunlight spirit detail page. Presence track section shows two rows: Energy track (top) and Card Plays track (bottom). Energy track displays 7 slots with values: 1, 2, 2, 3, 4, 4, 5. Card Plays track displays 7 slots with one marked "R" (reclaim) at position 5.
result: pass

### 2. Simple Spirit CSS Grid Layout
expected: On Lightning's Swift Strike spirit page, presence track nodes are horizontally aligned in a grid. Nodes within each row are evenly spaced using CSS Grid (not flex). The two tracks (Energy and Card Plays) are visually distinct rows.
result: pass

### 3. Complex Spirit Multi-Track Display
expected: Navigate to Starlight Seeks Its Form spirit page. Presence track section shows 6 tracks (not just 2). Tracks include Energy, Card Plays, plus 4 additional element tracks. Each track has a label on the left indicating its type.
result: pass

### 4. Complex Spirit Cross-Track Edge
expected: Navigate to Finder of Paths Unseen spirit page. Presence track shows a visual connection (dashed line) from the 4th Energy slot to the 4th Card Plays slot, indicating the cross-track edge where presence can jump between tracks.
result: issue
reported: "as discussed previously this does absolutely not work - Finder has web/diamond shaped track with non-linear paths, not two parallel rows"
severity: blocker

### 5. Bidirectional Track Indication
expected: On Finder of Paths Unseen spirit page, the presence track system indicates bidirectional movement is possible (presence can move backwards along the track, not just forwards).
result: issue
reported: "does not work - Finder's entire track structure is wrong (web/diamond shape, not grid)"
severity: blocker

### 6. Presence Cap Display
expected: Navigate to Serpent Slumbering Beneath the Island spirit page. The Deep Slumber track (3rd row) shows presenceCap values. Slots display cap numbers (5, 6, 7, etc. up to 13) instead of regular energy/card play values.
result: issue
reported: "does not work - Serpent has 2 rows + separate circular Deep Slumber track, not 3 grid rows. Deep Slumber is a presence cap mechanic, not a presence track row."
severity: blocker

### 7. Track Type Tooltips
expected: On any spirit page, hover over a presence track slot. A tooltip appears showing relevant information about the slot (e.g., track type like "Energy", element if present, or special attributes like reclaim/presenceCap).
result: issue
reported: "Energy slots should render energy icon. Need to handle: multiple elements, 'Any' element (pick each turn), and Starlight's 'Star' element (pick once, stays same for game - see special rules)"
severity: major

### 8. Spirit-Specific Track Colors
expected: Presence tracks use spirit-specific color theming. River uses cyan/amber gradient, Lightning uses orange/blue, Serpent uses purple/emerald. The track row backgrounds have subtle gradient colors matching the spirit's element theme.
result: pass

## Summary

total: 8
passed: 4
issues: 4
pending: 0
skipped: 0

## Gaps

- truth: "Finder's presence track displays as web/diamond shape with non-linear paths"
  status: failed
  reason: "User reported: Finder has web/diamond shaped track with non-linear paths, not two parallel rows."
  severity: blocker
  test: 4
  root_cause: "Insufficient data verification - current Node-Edge Graph DSL CAN represent any structure, but seed data was based on speculation not actual game panel. Need physical card image to transcribe correct layout."
  artifacts:
    - path: "convex/seed.ts"
      issue: "Finder's presenceTracks based on unverified speculation"
    - path: ".planning/phases/03.4-presence-track-graph-dsl/03.4-RESEARCH.md"
      issue: "Research flagged layout as unverified (line 460)"
  missing:
    - "Actual Finder spirit panel image for data verification"
    - "Correct slot values, positions, and edge connections"
  debug_session: ".planning/debug/resolved/finder-web-presence-track.md"

- truth: "Serpent's Deep Slumber is a separate circular track for presence cap"
  status: failed
  reason: "User reported: Serpent has 2 rows + separate circular Deep Slumber track, not 3 grid rows."
  severity: blocker
  test: 6
  root_cause: "Wrong data modeling - Deep Slumber incorrectly modeled as 3rd presence track row. Should be separate field or rendered differently. Also: Energy/Card Plays row values are wrong, missing 'Requires Both Preceding Spaces' condition."
  artifacts:
    - path: "convex/seed.ts"
      issue: "Serpent has 3 rows when it should have 2 + separate Deep Slumber"
    - path: "convex/schema.ts"
      issue: "No separate field for Deep Slumber mechanic"
  missing:
    - "Separate deepSlumber schema field or different rendering"
    - "Correct Energy row: 1, Fire, Any, Reclaim, covered, 6, Any, 12"
    - "Correct Card Plays row: 1, Moon, 2, Water, Earth+special, 4, 5+Reclaim"
    - "requiresPrecedingSlots field for Earth slot special condition"
  debug_session: ".planning/debug/serpent-deep-slumber-track.md"

- truth: "Presence slots render appropriate icons for energy, elements, and special cases"
  status: failed
  reason: "User reported: Energy slots should render energy icon. Need to handle multiple elements, 'Any' element (pick each turn), and Starlight's 'Star' element (pick once, stays same for game)."
  severity: major
  test: 7
  root_cause: "Missing schema and UI support for special element types. Schema only supports specific element names, no 'Any' or 'Star' types. PresenceNode renders energy as raw number, no icon."
  artifacts:
    - path: "app/components/spirits/presence-node.tsx"
      issue: "Line 148 renders energy as raw value, no icon"
    - path: "convex/schema.ts"
      issue: "elements field is string array, no type differentiation"
  missing:
    - "Add 'Any' and 'Star' to valid element types in schema"
    - "Energy icon rendering in PresenceNode"
    - "Different visual treatment for Any vs Star vs fixed elements"
    - "Tooltips explaining Any (per-turn choice) vs Star (permanent choice)"
  debug_session: ".planning/debug/element-energy-icon-rendering.md"
