---
phase: 03.4-presence-track-graph-dsl
plan: 04
type: execute
wave: 3
depends_on: ["03.4-01", "03.4-02", "03.4-03"]
files_modified:
  - convex/seed.ts
autonomous: true

must_haves:
  truths:
    - "Finder of Paths Unseen uses grid format with actual web topology"
    - "Grid data matches real spirit board layout (3 rows, interconnected paths)"
    - "Connections array captures cross-path links"
    - "Existing simple spirits remain in legacy format"
  artifacts:
    - path: "convex/seed.ts"
      provides: "Grid data for Finder of Paths Unseen"
      contains: 'layout: "grid"'
  key_links:
    - from: "convex/seed.ts"
      to: "Convex database"
      via: "reseedSpirits mutation"
      pattern: "finder-of-paths-unseen.*grid"
---

<objective>
Update seed data for Finder of Paths Unseen to use the new grid format with accurate board topology.

Purpose: Demonstrate the grid DSL with a real complex spirit whose presence track is a web/graph structure with bidirectional traversal and convergent paths.

Output: Finder's presenceTracks using grid format with rows, connections, and bidirectional flag.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-01-SUMMARY.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-02-SUMMARY.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-03-SUMMARY.md
@.planning/debug/presence-track-graph-dsl.md

Reference current seed data:
@convex/seed.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Research Finder's actual board layout</name>
  <files>N/A - research only</files>
  <action>
Before updating seed data, verify Finder's presence track layout from the wiki:
- Visit https://spiritislandwiki.com/index.php?title=Finder_of_Paths_Unseen
- Note the exact structure of the presence tracks (energy path, card plays path, middle modifiers)
- Identify connection points between paths
- Note which slots have elements, reclaim, etc.

Key observations from research doc:
- Top row: Energy track (0 -> 1 -> 1 -> 2 -> 2 -> 3)
- Bottom row: Card Plays track (1 -> 2 -> 2[R] -> 3 -> 4)
- Middle row: Modifier slots (+Energy, +CardPlays, etc.)
- Paths converge at certain points allowing bidirectional traversal

Create accurate grid representation (3 rows x ~7 cols).
  </action>
  <verify>
Document the layout in comments within the seed data.
  </verify>
  <done>
Exact board topology is understood and can be represented in grid format.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Finder seed data with grid format</name>
  <files>convex/seed.ts</files>
  <action>
Update Finder of Paths Unseen's presenceTracks in BOTH seedSpirits and reseedSpirits mutations:

Replace the current linear track data:
```typescript
presenceTracks: {
  layout: "branching",
  tracks: [
    { type: "energy", ... },
    { type: "cardPlays", ... }
  ]
}
```

With new grid format based on actual board:
```typescript
presenceTracks: {
  layout: "grid",
  bidirectional: true,  // Finder can traverse either direction
  rows: [
    // Row 0: Top path (Energy focus)
    [
      { isStart: true, value: 0, trackType: "energy" },
      { value: 1, trackType: "energy" },
      { value: 1, trackType: "energy", elements: ["Moon"] },
      { value: 2, trackType: "energy" },
      { value: 2, trackType: "energy", elements: ["Air"] },
      { value: 3, trackType: "energy" },
    ],
    // Row 1: Middle path (Modifiers)
    [
      null,  // Empty - no cell at this position
      null,
      { value: "+1", modifier: "energy" },
      { value: "+1", modifier: "cardPlays" },
      { value: "+1", modifier: "energy", elements: ["Plant"] },
      null,
    ],
    // Row 2: Bottom path (Card Plays focus)
    [
      { isStart: true, value: 1, trackType: "cardPlays" },
      { value: 2, trackType: "cardPlays" },
      { value: 2, trackType: "cardPlays", reclaim: true },
      { value: 3, trackType: "cardPlays" },
      { value: 3, trackType: "cardPlays", elements: ["Earth"] },
      { value: 4, trackType: "cardPlays" },
    ],
  ],
  connections: [
    // Top path connects to middle path
    { from: [0, 2], to: [1, 2] },
    { from: [0, 4], to: [1, 4] },
    // Middle path connects to bottom path
    { from: [1, 3], to: [2, 3] },
    // Direct connections between rows at convergence points
    { from: [0, 3], to: [2, 3] },
  ],
}
```

NOTE: The exact grid layout should be verified against the actual Spirit Island wiki or board images. The above is an approximation based on the research document. Adjust row/column positions and connections as needed to match the real board.
  </action>
  <verify>
Run `npx convex run seed:reseedSpirits` to update the database.
Check Convex dashboard to verify Finder's data uses grid format.
  </verify>
  <done>
Finder of Paths Unseen uses grid format with accurate topology.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify Finder renders in the app</name>
  <files>N/A - verification only</files>
  <action>
1. Run `pnpm dev` to start the dev server
2. Navigate to /spirits/finder-of-paths-unseen
3. Scroll to Presence Tracks section
4. Verify:
   - Grid layout renders with 3 rows
   - Empty cells are transparent spacers
   - Start positions have gold ring indicators
   - Connection lines are visible between non-adjacent cells
   - Values, elements, reclaim indicators display correctly

If any issues, adjust the seed data or component code as needed.
  </action>
  <verify>
Visual inspection confirms grid renders correctly.
No console errors in browser dev tools.
  </verify>
  <done>
Finder's presence track grid renders accurately in the browser.
  </done>
</task>

</tasks>

<verification>
1. Run `npx convex run seed:reseedSpirits` - completes successfully
2. Run `pnpm dev` - dev server starts
3. Visit /spirits/finder-of-paths-unseen - grid presence track renders
4. Visit /spirits/river-surges-in-sunlight - legacy linear track still works
5. No console errors on either page
</verification>

<success_criteria>
- Finder uses grid format in database
- Grid renders with correct row/column structure
- Connection lines visible between paths
- Legacy spirits unaffected
</success_criteria>

<output>
After completion, create `.planning/phases/03.4-presence-track-graph-dsl/03.4-04-SUMMARY.md`
</output>
