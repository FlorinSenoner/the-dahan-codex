---
phase: 03.4-presence-track-graph-dsl
plan: 04
type: execute
wave: 3
depends_on: ["03.4-01", "03.4-02", "03.4-03"]
files_modified:
  - app/components/spirits/presence-track.tsx
autonomous: true

must_haves:
  truths:
    - "PresenceTrack component renders using GraphPresenceTrack"
    - "Old linear track rendering logic is removed"
    - "Spirit detail pages display presence tracks correctly"
  artifacts:
    - path: "app/components/spirits/presence-track.tsx"
      provides: "Entry point that delegates to GraphPresenceTrack"
      min_lines: 20
  key_links:
    - from: "app/components/spirits/presence-track.tsx"
      to: "app/components/spirits/graph-presence-track.tsx"
      via: "import and render delegation"
      pattern: "GraphPresenceTrack"
---

<objective>
Replace the existing PresenceTrack component to use the new GraphPresenceTrack renderer.

Purpose: Wire up the new graph-based renderer so spirit detail pages display presence tracks using the unified Node-Edge Graph model.

Output: Updated presence-track.tsx that delegates to GraphPresenceTrack
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-RESEARCH.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-02-SUMMARY.md
@app/components/spirits/presence-track.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace PresenceTrack with GraphPresenceTrack delegation</name>
  <files>app/components/spirits/presence-track.tsx</files>
  <action>
Completely replace the existing presence-track.tsx content.

The old component rendered linear tracks with slots. The new component simply delegates to GraphPresenceTrack:

```tsx
import type { Doc } from "convex/_generated/dataModel";
import { GraphPresenceTrack } from "./graph-presence-track";

interface PresenceTrackProps {
  presenceTracks: NonNullable<Doc<"spirits">["presenceTracks"]>;
  spiritSlug?: string;
}

/**
 * PresenceTrack component - entry point for presence track rendering.
 * Delegates to GraphPresenceTrack for the unified Node-Edge Graph model.
 */
export function PresenceTrack({ presenceTracks, spiritSlug }: PresenceTrackProps) {
  return (
    <GraphPresenceTrack
      presenceTracks={presenceTracks}
      spiritSlug={spiritSlug}
    />
  );
}
```

This maintains the public API (PresenceTrack component name, same props) while internally using the new graph renderer.

Key changes:
- REMOVED: All linear track rendering logic (tracks.map, slots.map)
- REMOVED: Track color logic (moved to GraphPresenceTrack)
- REMOVED: Track label rendering with GitBranch/Sprout indicators
- ADDED: Simple delegation to GraphPresenceTrack
  </action>
  <verify>
presence-track.tsx imports GraphPresenceTrack
presence-track.tsx exports PresenceTrack function
No reference to old track-based logic
`pnpm typecheck` passes
  </verify>
  <done>
PresenceTrack component delegates to GraphPresenceTrack.
Old linear track rendering code removed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Delete obsolete presence-slot.tsx</name>
  <files>app/components/spirits/presence-slot.tsx</files>
  <action>
Delete the old presence-slot.tsx file since it's replaced by presence-node.tsx.

Run: `rm app/components/spirits/presence-slot.tsx`

The PresenceNode component in presence-node.tsx provides the same functionality with the updated interface for graph nodes.
  </action>
  <verify>
presence-slot.tsx no longer exists: `ls app/components/spirits/presence-slot.tsx 2>/dev/null || echo "File deleted"`
No imports of PresenceSlot remain: `grep -r "PresenceSlot" app/ --include="*.tsx" --include="*.ts" || echo "No references found"`
`pnpm typecheck` passes (no missing import errors)
  </verify>
  <done>
Old presence-slot.tsx deleted. PresenceNode is the new component.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. presence-track.tsx imports and uses GraphPresenceTrack
3. presence-slot.tsx is deleted
4. No references to old PresenceSlot component remain
</verification>

<success_criteria>
- PresenceTrack component delegates to GraphPresenceTrack
- Old linear track code removed from presence-track.tsx
- presence-slot.tsx deleted (replaced by presence-node.tsx)
</success_criteria>

<output>
After completion, create `.planning/phases/03.4-presence-track-graph-dsl/03.4-04-SUMMARY.md`
</output>
