---
phase: 03.4-presence-track-graph-dsl
plan: 05
type: execute
wave: 3
depends_on: ["03.4-01"]
files_modified:
  - convex/seed.ts
autonomous: true

must_haves:
  truths:
    - "Starlight has 6 tracks represented in grid format"
    - "Serpent has 3 tracks with presenceCap displayed"
    - "Both complex spirits render correctly"
  artifacts:
    - path: "convex/seed.ts"
      provides: "Grid data for Starlight and Serpent"
      contains: "starlight-seeks-its-form"
  key_links:
    - from: "convex/seed.ts"
      to: "app/components/spirits/presence-track-grid.tsx"
      via: "Grid format detection and rendering"
      pattern: "layout.*grid"
---

<objective>
Update seed data for Starlight Seeks Its Form and Serpent Slumbering Beneath the Island to demonstrate grid format capabilities.

Purpose: Validate the grid DSL works for different complex spirit patterns (multiple parallel tracks, presenceCap tracks).

Output: Both spirits use grid format with accurate layouts.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-01-SUMMARY.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-04-SUMMARY.md

Reference current seed data:
@convex/seed.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Starlight seed data with grid format</name>
  <files>convex/seed.ts</files>
  <action>
Update Starlight Seeks Its Form's presenceTracks in BOTH seedSpirits and reseedSpirits mutations.

Starlight has 6 presence tracks arranged as parallel rows. Convert to grid format:

```typescript
presenceTracks: {
  layout: "grid",
  bidirectional: false,  // Normal linear progression
  rows: [
    // Row 0: Energy track (unlocks growth)
    [
      { value: 1, trackType: "energy" },
      { value: 2, trackType: "energy" },
      { value: 3, trackType: "energy" },
      { value: 4, trackType: "energy" },
    ],
    // Row 1: Card Plays track (unlocks growth)
    [
      { value: 1, trackType: "cardPlays" },
      { value: 2, trackType: "cardPlays" },
      { value: 3, trackType: "cardPlays" },
      { value: 4, trackType: "cardPlays" },
    ],
    // Row 2: Fire/Air elements (unlocks growth)
    [
      { value: 0, elements: ["Fire"] },
      { value: 0, elements: ["Air"] },
      { value: 0, elements: ["Fire", "Air"] },
      null,
    ],
    // Row 3: Water/Earth elements (unlocks growth)
    [
      { value: 0, elements: ["Water"] },
      { value: 0, elements: ["Earth"] },
      { value: 0, elements: ["Water", "Earth"] },
      null,
    ],
    // Row 4: Moon/Plant elements
    [
      { value: 0, elements: ["Moon"] },
      { value: 0, elements: ["Plant"] },
      { value: 0, elements: ["Moon", "Plant"] },
      null,
    ],
    // Row 5: Sun/Animal elements
    [
      { value: 0, elements: ["Sun"] },
      { value: 0, elements: ["Animal"] },
      { value: 0, elements: ["Sun", "Animal"] },
      null,
    ],
  ],
  connections: [],  // No cross-track connections for Starlight
}
```

Note: Starlight's tracks are mostly independent parallel rows. The grid format allows showing all 6 tracks in a unified visual structure.
  </action>
  <verify>
Run `npx convex run seed:reseedSpirits` to update the database.
  </verify>
  <done>
Starlight uses grid format showing all 6 tracks.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Serpent seed data with grid format</name>
  <files>convex/seed.ts</files>
  <action>
Update Serpent Slumbering Beneath the Island's presenceTracks in BOTH seedSpirits and reseedSpirits mutations.

Serpent has 3 tracks: Energy, Absorbed Essence, and Deep Slumber (presenceCap). Convert to grid:

```typescript
presenceTracks: {
  layout: "grid",
  bidirectional: false,
  rows: [
    // Row 0: Energy track
    [
      { value: 1, trackType: "energy" },
      { value: 2, trackType: "energy" },
      { value: 3, trackType: "energy" },
      { value: 4, trackType: "energy", elements: ["Fire"] },
      { value: 5, trackType: "energy" },
      { value: 6, trackType: "energy", elements: ["Fire"] },
      { value: 7, trackType: "energy" },
    ],
    // Row 1: Absorbed Essence track
    [
      { value: 0, trackType: "absorbed" },
      { value: 0, trackType: "absorbed", elements: ["Moon"] },
      { value: 0, trackType: "absorbed", elements: ["Earth"] },
      { value: 0, trackType: "absorbed", elements: ["Moon", "Earth"] },
      { value: 0, trackType: "absorbed", elements: ["Fire"] },
      { value: 0, trackType: "absorbed", elements: ["Moon", "Earth", "Fire"] },
      null,
    ],
    // Row 2: Deep Slumber (presenceCap) track
    [
      { value: 5, presenceCap: 5 },
      { value: 6, presenceCap: 6 },
      { value: 7, presenceCap: 7 },
      { value: 8, presenceCap: 8 },
      { value: 9, presenceCap: 9 },
      { value: 10, presenceCap: 10 },
      { value: 11, presenceCap: 11 },
      { value: 12, presenceCap: 12 },
      { value: 13, presenceCap: 13 },
    ],
  ],
  connections: [],  // No cross-track connections for Serpent
}
```

Note: Serpent's Deep Slumber track has more slots (9) than Energy (7), so the grid will have uneven row lengths. The renderer handles this gracefully with null/empty cells.
  </action>
  <verify>
Run `npx convex run seed:reseedSpirits` to update the database.
  </verify>
  <done>
Serpent uses grid format with presenceCap track visible.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify both spirits render correctly</name>
  <files>N/A - verification only</files>
  <action>
1. Run `pnpm dev` to start the dev server
2. Navigate to /spirits/starlight-seeks-its-form
   - Verify 6 rows of tracks are visible
   - Element icons display correctly
   - No console errors
3. Navigate to /spirits/serpent-slumbering-beneath-the-island
   - Verify 3 rows of tracks are visible
   - Deep Slumber track shows presenceCap values (5-13)
   - presenceCap slots have stone/gray styling
   - No console errors
  </action>
  <verify>
Visual inspection confirms both spirits render correctly.
No console errors in browser dev tools.
  </verify>
  <done>
Both Starlight and Serpent render with grid-based presence tracks.
  </done>
</task>

</tasks>

<verification>
1. Run `npx convex run seed:reseedSpirits` - completes successfully
2. Run `pnpm dev` - dev server starts
3. Visit /spirits/starlight-seeks-its-form - 6 track rows visible
4. Visit /spirits/serpent-slumbering-beneath-the-island - presenceCap track visible
5. Visit /spirits/river-surges-in-sunlight - legacy format still works
6. No console errors on any spirit page
</verification>

<success_criteria>
- Starlight shows all 6 tracks in grid layout
- Serpent shows presenceCap track with correct values
- Both use grid format in database
- Legacy spirits continue to work
</success_criteria>

<output>
After completion, create `.planning/phases/03.4-presence-track-graph-dsl/03.4-05-SUMMARY.md`
</output>
