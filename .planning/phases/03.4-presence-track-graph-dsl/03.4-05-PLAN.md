---
phase: 03.4-presence-track-graph-dsl
plan: 05
type: execute
wave: 4
depends_on: ["03.4-01", "03.4-04"]
files_modified:
  - convex/seed.ts
autonomous: true

must_haves:
  truths:
    - "All 6 base spirits have presenceTracks in Node-Edge Graph format"
    - "Simple spirits (River, Lightning) use single-row grids with no edges"
    - "Complex spirits (Finder, Serpent, Starlight, Fractured) use appropriate graph structures"
    - "reseedSpirits mutation successfully populates database"
  artifacts:
    - path: "convex/seed.ts"
      provides: "Spirit seed data with Node-Edge Graph presenceTracks"
      contains: "nodes:"
  key_links:
    - from: "convex/seed.ts"
      to: "convex/schema.ts"
      via: "presenceTracks structure validation"
      pattern: "presenceTracks"
---

<objective>
Convert all spirit seed data to use the new unified Node-Edge Graph format for presence tracks.

Purpose: Replace all existing presenceTracks data with the new nodes + edges structure. This enables both simple spirits (linear tracks) and complex spirits (branching graphs) to use the same schema.

Output: Updated convex/seed.ts with all spirits using Node-Edge Graph format
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-RESEARCH.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-01-SUMMARY.md
@convex/seed.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert River Surges in Sunlight to Node-Edge format</name>
  <files>convex/seed.ts</files>
  <action>
Update River's presenceTracks from linear format to Node-Edge Graph.

River is a simple 2-row linear spirit:
- Row 0: Energy track (7 nodes)
- Row 1: Card Plays track (7 nodes, slot 5 has reclaim)

Convert to:
```typescript
presenceTracks: {
  rows: 2,
  cols: 7,
  bidirectional: false,
  nodes: [
    // Energy track (row 0)
    { id: "e1", row: 0, col: 0, value: 1, trackType: "energy" },
    { id: "e2", row: 0, col: 1, value: 2, trackType: "energy" },
    { id: "e3", row: 0, col: 2, value: 2, trackType: "energy" },
    { id: "e4", row: 0, col: 3, value: 3, trackType: "energy" },
    { id: "e5", row: 0, col: 4, value: 4, trackType: "energy" },
    { id: "e6", row: 0, col: 5, value: 4, trackType: "energy" },
    { id: "e7", row: 0, col: 6, value: 5, trackType: "energy" },
    // Card Plays track (row 1)
    { id: "c1", row: 1, col: 0, value: 1, trackType: "cardPlays" },
    { id: "c2", row: 1, col: 1, value: 2, trackType: "cardPlays" },
    { id: "c3", row: 1, col: 2, value: 2, trackType: "cardPlays" },
    { id: "c4", row: 1, col: 3, value: 3, trackType: "cardPlays" },
    { id: "c5", row: 1, col: 4, value: 3, trackType: "cardPlays", reclaim: true },
    { id: "c6", row: 1, col: 5, value: 4, trackType: "cardPlays" },
    { id: "c7", row: 1, col: 6, value: 5, trackType: "cardPlays" },
  ],
  edges: [
    // Energy track progression (left to right)
    { from: "e1", to: "e2" },
    { from: "e2", to: "e3" },
    { from: "e3", to: "e4" },
    { from: "e4", to: "e5" },
    { from: "e5", to: "e6" },
    { from: "e6", to: "e7" },
    // Card Plays track progression
    { from: "c1", to: "c2" },
    { from: "c2", to: "c3" },
    { from: "c3", to: "c4" },
    { from: "c4", to: "c5" },
    { from: "c5", to: "c6" },
    { from: "c6", to: "c7" },
  ],
},
```

Apply to BOTH seedSpirits and reseedSpirits functions.
  </action>
  <verify>
River's presenceTracks uses nodes/edges arrays
Contains 14 nodes and 12 edges
`pnpm typecheck` passes
  </verify>
  <done>
River Surges in Sunlight converted to Node-Edge Graph format.
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert Lightning's Swift Strike to Node-Edge format</name>
  <files>convex/seed.ts</files>
  <action>
Update Lightning's presenceTracks from linear format to Node-Edge Graph.

Lightning is a simple 2-row linear spirit:
- Row 0: Energy track (7 nodes: 1,2,3,4,4,5,6)
- Row 1: Card Plays track (5 nodes: 1,2,2,3,4)

Convert to:
```typescript
presenceTracks: {
  rows: 2,
  cols: 7,  // Match River's width for consistent grid
  bidirectional: false,
  nodes: [
    // Energy track (row 0) - 7 nodes
    { id: "e1", row: 0, col: 0, value: 1, trackType: "energy" },
    { id: "e2", row: 0, col: 1, value: 2, trackType: "energy" },
    { id: "e3", row: 0, col: 2, value: 3, trackType: "energy" },
    { id: "e4", row: 0, col: 3, value: 4, trackType: "energy" },
    { id: "e5", row: 0, col: 4, value: 4, trackType: "energy" },
    { id: "e6", row: 0, col: 5, value: 5, trackType: "energy" },
    { id: "e7", row: 0, col: 6, value: 6, trackType: "energy" },
    // Card Plays track (row 1) - 5 nodes
    { id: "c1", row: 1, col: 0, value: 1, trackType: "cardPlays" },
    { id: "c2", row: 1, col: 1, value: 2, trackType: "cardPlays" },
    { id: "c3", row: 1, col: 2, value: 2, trackType: "cardPlays" },
    { id: "c4", row: 1, col: 3, value: 3, trackType: "cardPlays" },
    { id: "c5", row: 1, col: 4, value: 4, trackType: "cardPlays" },
  ],
  edges: [
    // Energy track
    { from: "e1", to: "e2" },
    { from: "e2", to: "e3" },
    { from: "e3", to: "e4" },
    { from: "e4", to: "e5" },
    { from: "e5", to: "e6" },
    { from: "e6", to: "e7" },
    // Card Plays track
    { from: "c1", to: "c2" },
    { from: "c2", to: "c3" },
    { from: "c3", to: "c4" },
    { from: "c4", to: "c5" },
  ],
},
```

Apply to BOTH seedSpirits and reseedSpirits functions.
  </action>
  <verify>
Lightning's presenceTracks uses nodes/edges arrays
Energy has 7 nodes, Card Plays has 5 nodes
`pnpm typecheck` passes
  </verify>
  <done>
Lightning's Swift Strike converted to Node-Edge Graph format.
  </done>
</task>

<task type="auto">
  <name>Task 3: Convert Fractured Days to Node-Edge format</name>
  <files>convex/seed.ts</files>
  <action>
Update Fractured Days' presenceTracks from linear format to Node-Edge Graph.

Fractured Days is a 2-row linear spirit (similar to base spirits):
- Row 0: Energy track (6 nodes: 1,2,2,3,4,5) - indigo color
- Row 1: Card Plays track (6 nodes: 1,2,2,3(R),4,5) - violet color

Convert to:
```typescript
presenceTracks: {
  rows: 2,
  cols: 6,
  bidirectional: false,
  nodes: [
    // Energy track (row 0)
    { id: "e1", row: 0, col: 0, value: 1, trackType: "energy" },
    { id: "e2", row: 0, col: 1, value: 2, trackType: "energy" },
    { id: "e3", row: 0, col: 2, value: 2, trackType: "energy" },
    { id: "e4", row: 0, col: 3, value: 3, trackType: "energy" },
    { id: "e5", row: 0, col: 4, value: 4, trackType: "energy" },
    { id: "e6", row: 0, col: 5, value: 5, trackType: "energy" },
    // Card Plays track (row 1)
    { id: "c1", row: 1, col: 0, value: 1, trackType: "cardPlays" },
    { id: "c2", row: 1, col: 1, value: 2, trackType: "cardPlays" },
    { id: "c3", row: 1, col: 2, value: 2, trackType: "cardPlays" },
    { id: "c4", row: 1, col: 3, value: 3, trackType: "cardPlays", reclaim: true },
    { id: "c5", row: 1, col: 4, value: 4, trackType: "cardPlays" },
    { id: "c6", row: 1, col: 5, value: 5, trackType: "cardPlays" },
  ],
  edges: [
    // Energy track
    { from: "e1", to: "e2" },
    { from: "e2", to: "e3" },
    { from: "e3", to: "e4" },
    { from: "e4", to: "e5" },
    { from: "e5", to: "e6" },
    // Card Plays track
    { from: "c1", to: "c2" },
    { from: "c2", to: "c3" },
    { from: "c3", to: "c4" },
    { from: "c4", to: "c5" },
    { from: "c5", to: "c6" },
  ],
},
```

Apply to BOTH seedSpirits and reseedSpirits functions.
  </action>
  <verify>
Fractured Days' presenceTracks uses nodes/edges arrays
Contains 12 nodes and 10 edges
`pnpm typecheck` passes
  </verify>
  <done>
Fractured Days Split the Sky converted to Node-Edge Graph format.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. All three spirits (River, Lightning, Fractured Days) use nodes/edges structure
3. No traces of old tracks/slots format remain for these spirits
</verification>

<success_criteria>
- River, Lightning, and Fractured Days use Node-Edge Graph format
- Both seedSpirits and reseedSpirits functions updated
- TypeScript compilation succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/03.4-presence-track-graph-dsl/03.4-05-SUMMARY.md`
</output>
