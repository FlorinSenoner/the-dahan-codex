---
phase: 03.4-presence-track-graph-dsl
plan: 07
type: execute
wave: 5
depends_on: ["03.4-04", "03.4-05", "03.4-06"]
files_modified:
  - app/lib/spirit-colors.ts
autonomous: false

must_haves:
  truths:
    - "All spirits render presence tracks in the app"
    - "Simple spirits show 2-row linear grids"
    - "Complex spirits show multi-row grids with connections"
    - "reseedSpirits mutation completes successfully"
  artifacts:
    - path: "app/lib/spirit-colors.ts"
      provides: "Updated spirit track colors (if needed)"
  key_links:
    - from: "convex/seed.ts"
      to: "Convex database"
      via: "reseedSpirits mutation"
      pattern: "presenceTracks"
---

<objective>
Verify the full integration works end-to-end by reseeding the database and visually confirming presence tracks render correctly for all spirits.

Purpose: This is the integration checkpoint - ensuring schema, components, and seed data all work together.

Output: Working presence tracks for all 6 spirits in the app
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-05-SUMMARY.md
@.planning/phases/03.4-presence-track-graph-dsl/03.4-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run reseedSpirits and verify no errors</name>
  <files></files>
  <action>
Run the reseed mutation to populate the database with the new Node-Edge Graph format:

```bash
npx convex run seed:reseedSpirits
```

Verify the mutation returns success status:
```json
{
  "status": "reseeded",
  "message": "Deleted all data and created 3 expansions, 6 base spirits, 7 aspects"
}
```

If there are validation errors, they will indicate which spirit has invalid presenceTracks data.
  </action>
  <verify>
Command completes without errors
Returns success status
  </verify>
  <done>
reseedSpirits mutation completes successfully with new graph format data.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update spirit-colors.ts if needed</name>
  <files>app/lib/spirit-colors.ts</files>
  <action>
Review getSpiritTrackColors function to ensure it handles all spirit slugs.

The function should return appropriate colors for:
- river-surges-in-sunlight: { energy: "cyan", cardPlays: "amber" }
- lightnings-swift-strike: { energy: "orange", cardPlays: "blue" }
- fractured-days-split-the-sky: { energy: "indigo", cardPlays: "violet" }
- starlight-seeks-its-form: { energy: "indigo", cardPlays: "amber" }
- finder-of-paths-unseen: { energy: "violet", cardPlays: "emerald" }
- serpent-slumbering-beneath-the-island: { energy: "orange", cardPlays: "stone" }

If any spirits are missing, add them to the mapping.

Note: The GraphPresenceTrack component also assigns colors based on trackType:
- "elements" -> "purple"
- "special" -> "stone"

These defaults may need adjustment based on visual review.
  </action>
  <verify>
All 6 base spirit slugs have color mappings
`pnpm typecheck` passes
  </verify>
  <done>
spirit-colors.ts has mappings for all spirits.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Node-Edge Graph DSL for presence tracks:
- New unified schema with nodes + edges
- GraphPresenceTrack component with CSS Grid layout
- EdgeOverlay for non-adjacent connections
- All 6 spirits converted to new format
  </what-built>
  <how-to-verify>
1. Start the dev server: `pnpm dev`
2. Navigate to http://localhost:3000/spirits/river-surges-in-sunlight
3. Verify River shows 2-row grid with Energy (top) and Card Plays (bottom)
4. Check slot 5 of Card Plays shows "R" (reclaim)

5. Navigate to http://localhost:3000/spirits/finder-of-paths-unseen
6. Verify Finder shows 2-row grid
7. Look for visual connection line between Energy and Card Plays tracks

8. Navigate to http://localhost:3000/spirits/serpent-slumbering-beneath-the-island
9. Verify Serpent shows 3-row grid
10. Check Deep Slumber row shows cap values (5-13)

11. Navigate to http://localhost:3000/spirits/starlight-seeks-its-form
12. Verify Starlight shows multiple element tracks
13. Check unlocksGrowth indicators appear on relevant tracks

Expected behavior:
- All spirits load without console errors
- Presence tracks render as CSS Grid
- Node tooltips show correct information
- Complex spirits show their unique layouts
  </how-to-verify>
  <resume-signal>Type "approved" if all spirits render correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. reseedSpirits completes without errors
2. All 6 spirits render presence tracks
3. CSS Grid layout positions nodes correctly
4. Tooltips show appropriate content
5. Complex spirits show unique graph structures
</verification>

<success_criteria>
- Database reseeded with new format
- All spirits render presence tracks in app
- No console errors during rendering
- Visual verification confirms correct layouts
</success_criteria>

<output>
After completion, create `.planning/phases/03.4-presence-track-graph-dsl/03.4-07-SUMMARY.md`
</output>
