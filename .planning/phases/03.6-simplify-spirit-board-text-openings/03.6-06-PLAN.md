---
phase: 03.6-simplify-spirit-board-text-openings
plan: 06
type: execute
wave: 3
depends_on: ["03.6-04"]
files_modified:
  - app/components/spirits/turn-accordion.tsx
  - app/components/spirits/opening-section.tsx
autonomous: true

must_haves:
  truths:
    - "Turn accordion displays turn-by-turn instructions"
    - "Opening section queries and displays openings for a spirit"
    - "All turns are expanded by default"
  artifacts:
    - path: "app/components/spirits/turn-accordion.tsx"
      provides: "Accordion component for turn display"
      contains: "AccordionItem"
    - path: "app/components/spirits/opening-section.tsx"
      provides: "Section component that queries openings"
      contains: "listBySpirit"
  key_links:
    - from: "app/components/spirits/opening-section.tsx"
      to: "convex/openings.ts"
      via: "Convex query"
      pattern: "api.openings.listBySpirit"
---

<objective>
Create the opening display components: TurnAccordion for individual opening display and OpeningSection for querying and showing openings.

Purpose: Frontend components to display text-based turn-by-turn opening guides
Output: Reusable components ready to integrate into spirit detail page
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.6-simplify-spirit-board-text-openings/03.6-RESEARCH.md
@app/components/ui/accordion.tsx
@app/components/spirits/overview-section.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TurnAccordion component</name>
  <files>app/components/spirits/turn-accordion.tsx</files>
  <action>
Create `app/components/spirits/turn-accordion.tsx`:

```tsx
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from "@/components/ui/accordion";
import { Text } from "@/components/ui/typography";

interface Turn {
  turn: number;
  title?: string;
  instructions: string;
  notes?: string;
}

interface TurnAccordionProps {
  turns: Turn[];
}

export function TurnAccordion({ turns }: TurnAccordionProps) {
  // Default all turns to open
  const defaultValues = turns.map((t) => `turn-${t.turn}`);

  return (
    <Accordion type="multiple" defaultValue={defaultValues} className="w-full">
      {turns.map((turn) => (
        <AccordionItem key={turn.turn} value={`turn-${turn.turn}`}>
          <AccordionTrigger className="text-left">
            {turn.title || `Turn ${turn.turn}`}
          </AccordionTrigger>
          <AccordionContent>
            <Text className="text-foreground whitespace-pre-wrap">
              {turn.instructions}
            </Text>
            {turn.notes && (
              <Text variant="muted" className="mt-3 text-sm italic">
                {turn.notes}
              </Text>
            )}
          </AccordionContent>
        </AccordionItem>
      ))}
    </Accordion>
  );
}
```
  </action>
  <verify>Run `pnpm typecheck` - should pass</verify>
  <done>TurnAccordion component created with default-open behavior</done>
</task>

<task type="auto">
  <name>Task 2: Create OpeningSection component</name>
  <files>app/components/spirits/opening-section.tsx</files>
  <action>
Create `app/components/spirits/opening-section.tsx`:

```tsx
import { convexQuery } from "@convex-dev/react-query";
import { useQuery } from "@tanstack/react-query";
import { api } from "convex/_generated/api";
import type { Id } from "convex/_generated/dataModel";
import { BookOpen } from "lucide-react";
import { Badge } from "@/components/ui/badge";
import { Heading, Text } from "@/components/ui/typography";
import { TurnAccordion } from "./turn-accordion";

interface OpeningSectionProps {
  spiritId: Id<"spirits">;
}

export function OpeningSection({ spiritId }: OpeningSectionProps) {
  const { data: openings, isLoading } = useQuery(
    convexQuery(api.openings.listBySpirit, { spiritId }),
  );

  // Don't render section if no openings exist
  if (!isLoading && (!openings || openings.length === 0)) {
    return null;
  }

  // Loading state
  if (isLoading) {
    return (
      <section className="space-y-4">
        <Heading variant="h2" as="h2" className="flex items-center gap-2">
          <BookOpen className="h-5 w-5" />
          Openings
        </Heading>
        <div className="animate-pulse bg-muted/30 rounded-lg h-32" />
      </section>
    );
  }

  // For now, just show the first opening
  // Future: add tabs for multiple openings
  const opening = openings[0];

  return (
    <section className="space-y-4">
      <Heading variant="h2" as="h2" className="flex items-center gap-2">
        <BookOpen className="h-5 w-5" />
        Openings
      </Heading>

      <div className="bg-card border border-border rounded-lg p-4 space-y-4">
        <div className="flex items-center justify-between">
          <Heading variant="h3" as="h3">
            {opening.name}
          </Heading>
          {opening.difficulty && (
            <Badge variant="outline" className="text-xs">
              {opening.difficulty}
            </Badge>
          )}
        </div>

        {opening.description && (
          <Text variant="muted">{opening.description}</Text>
        )}

        <TurnAccordion turns={opening.turns} />

        {(opening.author || opening.sourceUrl) && (
          <div className="pt-2 border-t border-border text-xs text-muted-foreground">
            {opening.author && <span>By {opening.author}</span>}
            {opening.author && opening.sourceUrl && <span> Â· </span>}
            {opening.sourceUrl && (
              <a
                href={opening.sourceUrl}
                target="_blank"
                rel="noopener noreferrer"
                className="text-primary hover:underline"
              >
                Source
              </a>
            )}
          </div>
        )}
      </div>
    </section>
  );
}
```
  </action>
  <verify>
Run `pnpm typecheck` - should pass
Run `pnpm build` - should complete successfully
  </verify>
  <done>OpeningSection component created with query integration and loading state</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. `pnpm build` completes
3. Components exist at:
   - app/components/spirits/turn-accordion.tsx
   - app/components/spirits/opening-section.tsx
4. TurnAccordion uses Radix Accordion with defaultValue for all turns
5. OpeningSection queries openings and handles loading/empty states
</verification>

<success_criteria>
- TurnAccordion renders turns with accordion UI, all open by default
- OpeningSection queries openings by spirit ID
- Loading state shown while data fetches
- Section hidden when no openings exist
- Author/source attribution displayed when present
</success_criteria>

<output>
After completion, create `.planning/phases/03.6-simplify-spirit-board-text-openings/03.6-06-SUMMARY.md`
</output>
