---
phase: 03.6-simplify-spirit-board-text-openings
plan: 06
subsystem: ui
tags: [react, radix, accordion, convex, tanstack-query, openings]

# Dependency graph
requires:
  - phase: 03.6-04
    provides: Openings schema and listBySpirit query
provides:
  - TurnAccordion component for turn-by-turn display
  - OpeningSection component for querying and rendering openings
affects: [03.6-07, spirit-detail-page-integration]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "TurnAccordion with all turns expanded by default via defaultValue"
    - "OpeningSection queries openings by spiritId, handles loading/empty states"

key-files:
  created:
    - app/components/spirits/turn-accordion.tsx
    - app/components/spirits/opening-section.tsx
  modified: []

key-decisions:
  - "All turns expanded by default - reduces clicks to view full opening"
  - "Section hidden entirely when no openings exist - clean empty state"
  - "First opening only displayed for now - tabs for multiple openings can be added later"

patterns-established:
  - "TurnAccordion: Reusable accordion component for turn arrays"
  - "OpeningSection: Query-aware section that gracefully handles loading/empty states"

# Metrics
duration: 1.5min
completed: 2026-01-28
---

# Phase 03.6 Plan 06: Opening Display Components Summary

**TurnAccordion and OpeningSection components for displaying text-based turn-by-turn spirit opening guides**

## Performance

- **Duration:** 1.5 min
- **Started:** 2026-01-28T13:02:32Z
- **Completed:** 2026-01-28T13:03:59Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments

- TurnAccordion component with Radix Accordion, all turns expanded by default
- OpeningSection component querying openings via Convex listBySpirit query
- Loading skeleton state while data fetches
- Section hidden when no openings exist (clean empty state)
- Author/source attribution display

## Task Commits

Each task was committed atomically:

1. **Task 1: Create TurnAccordion component** - `f488b2a` (feat)
2. **Task 2: Create OpeningSection component** - `54b26a7` (feat)

## Files Created/Modified

- `app/components/spirits/turn-accordion.tsx` - Accordion component for turn-by-turn instructions with all turns expanded by default
- `app/components/spirits/opening-section.tsx` - Section component that queries openings by spirit ID and handles loading/empty states

## Decisions Made

- **All turns expanded by default:** Using `defaultValue` with all turn IDs means users see the full opening without clicking to expand each turn
- **Section hidden when empty:** Rather than showing "No openings" message, the section renders null for a cleaner UI
- **First opening only for now:** Only displaying the first opening - tabs for multiple openings can be added in a future plan
- **Reordered loading/empty checks:** TypeScript type narrowing required checking isLoading first, then checking for empty openings

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Fixed TypeScript type narrowing for openings array**
- **Found during:** Task 2 (OpeningSection component)
- **Issue:** Original code checked `!isLoading && (!openings || openings.length === 0)` first, then checked `isLoading`. TypeScript couldn't narrow `openings` from `undefined` by the time we accessed `openings[0]`
- **Fix:** Reordered checks to check `isLoading` first (early return), then check for empty `openings` (early return), ensuring TypeScript knows `openings` is defined by line 39
- **Files modified:** app/components/spirits/opening-section.tsx
- **Verification:** `pnpm typecheck` passes
- **Committed in:** 54b26a7 (Task 2 commit)

---

**Total deviations:** 1 auto-fixed (1 bug)
**Impact on plan:** Minor TypeScript fix for proper type narrowing. No scope creep.

## Issues Encountered

None beyond the TypeScript narrowing fix documented above.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Components ready to integrate into spirit detail page
- OpeningSection can be added to spirit detail page with just the spirit ID prop
- No sample data yet - will need openings seeded to verify full flow

---
*Phase: 03.6-simplify-spirit-board-text-openings*
*Completed: 2026-01-28*
