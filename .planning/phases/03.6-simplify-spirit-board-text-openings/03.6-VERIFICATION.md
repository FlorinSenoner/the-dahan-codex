---
phase: 03.6-simplify-spirit-board-text-openings
verified: 2026-01-28T13:57:37Z
status: gaps_found
score: 5/6 must-haves verified
re_verification:
  previous_status: gaps_found
  previous_score: 5/6
  previous_date: 2026-01-28T13:10:44Z
  gaps_closed:
    - "SpecialRules component removed from spirit detail page"
    - "Opening source URL fixed (no broken fragment)"
    - "Aspect openings isolation verified and documented"
  gaps_remaining:
    - "Multiple openings per spirit shown as tabs (like aspects), stored in URL"
  regressions: []
gaps:
  - truth: "Multiple openings per spirit shown as tabs (like aspects), stored in URL"
    status: partial
    reason: "OpeningSection displays only first opening with TODO comment for future tabs"
    artifacts:
      - path: "app/components/spirits/opening-section.tsx"
        issue: "Line 39-40: TODO comment + hardcoded openings[0]"
    missing:
      - "OpeningTabs component following VariantTabs pattern (URL-based navigation)"
      - "Search param integration for ?opening= query parameter"
      - "Tab UI rendering when openings.length > 1"
      - "Navigation logic to switch between multiple openings"
---

# Phase 3.6: Simplify Spirit Board + Text Openings Verification Report

**Phase Goal:** Remove complex board visualization components and replace with simple text-based turn-by-turn opening guides

**Verified:** 2026-01-28T13:57:37Z
**Status:** gaps_found
**Re-verification:** Yes — after UAT gap closure (Plan 08)

## Re-Verification Summary

**Previous verification:** 2026-01-28T13:10:44Z (score: 5/6)
**UAT testing:** 8 tests conducted, 3 issues identified
**Gap closure:** Plan 08 addressed UAT issues

### UAT Gaps Closed

All 3 UAT gaps have been successfully closed:

1. ✓ **SpecialRules removed** - Component deleted, imports removed, schema field removed, all seed data cleaned
2. ✓ **sourceUrl fixed** - Changed from broken fragment `#!.7w4g8aw` to working root URL `https://querki.net/u/darker/spirit-island-faq`
3. ✓ **Aspect isolation verified** - Architecture confirmed: aspects query by own _id, design comment added

### Previous Gap Status

1. ⚠️ **Multiple openings tabs** - Still partial (same as previous verification)

**No regressions detected** - All previously passing items remain verified.

## Goal Achievement

### Observable Truths

| # | Truth | Status | Evidence |
|---|-------|--------|----------|
| 1 | Spirit detail page shows: image, title, element/complexity badges, overview with radar, strengths/weaknesses | ✓ VERIFIED | `spirits.$slug.tsx` L210-277: image with placeholder fallback, title/badges, summary text, OverviewSection (L282, L292) |
| 2 | Growth, presence track, innate powers, cards, and special rules sections are removed | ✓ VERIFIED | Zero imports in `spirits.$slug.tsx`, SpecialRules deleted, components directory confirmed empty of board components, no grep matches |
| 3 | New "openings" collection in Convex stores text-based turn-by-turn guides | ✓ VERIFIED | `convex/schema.ts` L61-94 defines openings table with spiritId, turns array, metadata. `convex/openings.ts` provides listBySpirit and getBySlug queries |
| 4 | Openings display as collapsible accordions (one per turn, default open) | ✓ VERIFIED | `turn-accordion.tsx` L25 uses Radix Accordion with `type="multiple"`, L22 sets `defaultValue` to all turn IDs |
| 5 | Multiple openings per spirit shown as tabs (like aspects), stored in URL | ⚠️ PARTIAL | `opening-section.tsx` L39-41: hardcoded `openings[0]` with TODO comment "Future: add tabs for multiple openings" |
| 6 | All related schema fields, components, tests, and seed data removed/cleaned | ✓ VERIFIED | Schema: no specialRules field (verified L45-54). Seed: 754 lines, zero specialRules properties, working sourceUrls (L365, L745). Components: growth/board components deleted. E2E tests updated |

**Score:** 5/6 truths verified (1 partial - same as previous verification)

### Required Artifacts

| Artifact | Expected | Status | Details |
|----------|----------|--------|---------|
| `app/routes/spirits.$slug.tsx` | Simplified spirit detail without board/SpecialRules | ✓ VERIFIED | 297 lines, imports OpeningSection (L16), renders it (L285), no SpecialRules import/JSX |
| `app/components/spirits/special-rules.tsx` | Deleted | ✓ VERIFIED | File does not exist (confirmed via test -f) |
| `convex/schema.ts` | Openings table, no specialRules field | ✓ VERIFIED | L61-94: openings table complete. L45-54: spirits table has no specialRules field |
| `convex/openings.ts` | Queries for openings | ✓ VERIFIED | 25 lines, listBySpirit (L5-13) and getBySlug (L16-24) implemented |
| `app/components/spirits/opening-section.tsx` | Section component with design comment | ✓ VERIFIED | 88 lines, queries via api.openings.listBySpirit, L14-15: design comment documenting aspect isolation |
| `app/components/spirits/turn-accordion.tsx` | Accordion for turns | ✓ VERIFIED | 46 lines, Radix Accordion with type="multiple", all turns default open |
| `convex/seed.ts` | Sample opening, no specialRules, fixed sourceUrl | ✓ VERIFIED | 754 lines, openings at L318-366 and L698-746, sourceUrl fixed to root URL (no fragment) |
| Board components | Growth, Presence, Innates, Cards deleted | ✓ VERIFIED | app/components/spirits/growth: DELETED. app/components/icons/growth: DELETED. Only 10 tsx files remain in spirits/ |

### Key Link Verification

| From | To | Via | Status | Details |
|------|----|----|--------|---------|
| `spirits.$slug.tsx` | `opening-section.tsx` | import + prop | ✓ WIRED | L16: import OpeningSection, L285: `<OpeningSection spiritId={spirit._id} />` |
| `opening-section.tsx` | `convex/openings.ts` | Convex query | ✓ WIRED | L17-19: useQuery with api.openings.listBySpirit, exact spiritId match |
| `opening-section.tsx` | `turn-accordion.tsx` | import + render | ✓ WIRED | L8: import TurnAccordion, L66: `<TurnAccordion turns={opening.turns} />` |
| `spirits.$slug.$aspect.tsx` | aspect spirit._id | getSpiritBySlug | ✓ WIRED | L21-23: loads aspect document, L47: passes spirit (aspect) to SpiritDetailContent, which passes spirit._id to OpeningSection |
| `turn-accordion.tsx` | Radix UI accordion | component | ✓ WIRED | L1-6: imports Accordion primitives, L25: renders with defaultValue for all-open behavior |

### Requirements Coverage

Not applicable - Phase 3.6 is a simplification pivot, not mapped to original REQUIREMENTS.md.

### Anti-Patterns Found

| File | Line | Pattern | Severity | Impact |
|------|------|---------|----------|--------|
| `app/components/spirits/opening-section.tsx` | 39-40 | TODO comment + hardcoded openings[0] | ⚠️ Warning | Success criteria #5 (multiple openings tabs) not implemented. Only affects spirits with >1 opening (none seeded yet except River with 1) |

**No blocker anti-patterns found** - The TODO is a known gap, not a stub that breaks functionality.

### Build & Type Verification

| Check | Status | Details |
|-------|--------|---------|
| TypeScript compilation | ✓ PASS | `pnpm typecheck` completed with no errors |
| Production build | ✓ PASS | `pnpm build` succeeded, generated SW with 14 precached files |
| SpecialRules references | ✓ CLEAN | Zero grep matches in app/ and convex/ |
| specialRules schema field | ✓ REMOVED | Not present in schema.ts spirits table definition |
| Broken sourceUrl fragment | ✓ FIXED | Both occurrences (L365, L745) use root URL without `#!.7w4g8aw` |

### Human Verification Required

All items from previous verification remain relevant:

#### 1. Visual Verification - Spirit Detail Page Layout

**Test:** Navigate to `/spirits/river-surges-in-sunlight` in a browser
**Expected:** 
- Page shows: spirit image, title, complexity/element badges, summary text
- Overview section visible (desktop: right sidebar, mobile: collapsible)
- Openings section with "Standard Opening" accordion
- External Links section
- NO Growth, Presence Tracks, Innate Powers, Cards, or Special Rules sections

**Why human:** Visual layout confirmation requires browser rendering

#### 2. Accordion Interaction

**Test:** Click on turn headers in the Openings accordion
**Expected:**
- All 3 turns are expanded by default
- Clicking a turn header collapses that turn
- Clicking again re-expands it
- Other turns remain in their state (multiple can be open/closed)

**Why human:** Interaction behavior requires user input

#### 3. Opening Content Readability

**Test:** Read the turn instructions in the Standard Opening accordion
**Expected:**
- Text is readable and formatted correctly (whitespace preserved)
- Notes appear in italic/muted style below instructions
- Author and source link visible at bottom
- Difficulty badge shows "Beginner"
- Source link points to https://querki.net/u/darker/spirit-island-faq (working URL)

**Why human:** Readability, styling, and link verification assessment

#### 4. Aspect Openings Isolation

**Test:** Navigate to an aspect (e.g., `/spirits/river-surges-in-sunlight/sunshine`)
**Expected:**
- No openings section appears (no openings seeded for Sunshine aspect)
- Aspect detail shows image, title, badges, overview, external links
- No error or "No openings available" message

**Why human:** End-to-end aspect behavior verification

### Gaps Summary

**1 gap remains from initial verification (unchanged):**

**Success Criteria #5: Multiple openings per spirit shown as tabs (like aspects), stored in URL**

**Current state:**
- OpeningSection (L39-41) displays only the first opening: `const opening = openings[0]`
- TODO comment acknowledges missing functionality: "Future: add tabs for multiple openings"

**Missing components:**
1. **OpeningTabs component** - Following VariantTabs pattern (L1-70 in variant-tabs.tsx):
   - URL-based navigation via search params (?opening=slug)
   - Tabs UI similar to aspect tabs
   - Active tab based on URL state
2. **Search param integration** - useSearch hook for ?opening= parameter
3. **Conditional rendering** - Show tabs only when openings.length > 1
4. **Navigation logic** - Switch between openings without page reload

**Why this is a gap:**
- ROADMAP success criteria explicitly requires "Multiple openings per spirit shown as tabs (like aspects), stored in URL"
- Current implementation cannot display multiple openings even if seeded
- Pattern exists in VariantTabs but not applied to openings

**Impact assessment:**
- **Priority: LOW** - Only affects spirits with multiple openings
- **Current scope: NONE** - Only River has an opening seeded (1 opening)
- **User impact: DEFERRED** - Feature works for current data set
- **Recommended action: DEFER** - Address in Phase 5 (Text Opening Management) when admin tools enable creating multiple openings

**Design consideration:**
The gap was identified in initial verification and intentionally left open. UAT testing (8 tests) focused on core functionality and found zero issues with the single-opening display. The TODO comment documents the limitation clearly.

### UAT Results Integration

From `3.6-UAT.md`:
- **Total tests:** 8
- **Passed:** 5 (no changes needed)
- **Issues identified:** 3 (all closed in Plan 08)

**UAT verification confirms:**
1. ✓ Board components successfully removed (visual inspection passed)
2. ✓ Openings section displays correctly for River
3. ✓ Accordion interaction works (all turns open by default, toggle individually)
4. ✓ Opening attribution visible with fixed source URL
5. ✓ No openings section for spirits without openings (empty state hidden)
6. ✓ Aspect tabs show "Base" label correctly
7. ✓ E2E tests pass (13 tests: 9 spirits + 4 smoke)
8. ✓ Aspects correctly isolate openings (no inheritance from base)

---

**Conclusion:** Phase 3.6 core goal achieved with 5/6 success criteria fully verified. UAT gaps have been closed. The remaining gap (multiple openings tabs) is a documented enhancement for Phase 5, not a blocker for marking Phase 3.6 complete.

_Verified: 2026-01-28T13:57:37Z_
_Verifier: Claude (gsd-verifier)_
_Re-verification: Yes (after UAT gap closure)_
