---
phase: 06.1-cleanup-thedahancodex
plan: 02
type: execute
wave: 2
depends_on: ["06.1-01"]
files_modified:
  - app/components/pwa/update-banner.tsx
  - CLAUDE.md
autonomous: true

must_haves:
  truths:
    - "Update banner uses subtle pill styling consistent with offline indicator"
    - "CLAUDE.md accurately describes client-only SPA architecture"
    - "CLAUDE.md Project Map reflects current file structure"
  artifacts:
    - path: "app/components/pwa/update-banner.tsx"
      provides: "Pill-styled update notification"
      contains: ["rounded-full", "border-zinc-700", "bg-zinc-800/90"]
    - path: "CLAUDE.md"
      provides: "Updated project documentation"
      not_contains: ["sw-register.ts"]
      contains: ["client-side SPA"]
  key_links:
    - from: "app/components/pwa/update-banner.tsx"
      to: "app/components/pwa/offline-indicator.tsx"
      via: "consistent styling pattern"
      pattern: "rounded-full.*border-zinc-700.*bg-zinc-800"
---

<objective>
Refactor update banner to match offline indicator styling and update CLAUDE.md with client-only SPA documentation.

Purpose: UI consistency (update banner should match the subtle pill style of the offline indicator) and documentation accuracy (CLAUDE.md references deleted sw-register.ts and lacks client-only SPA architecture notes).

Output: Consistent PWA UI and accurate project documentation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.1-cleanup-thedahancodex/06.1-RESEARCH.md

# Reference for pill styling pattern
@app/components/pwa/offline-indicator.tsx

# Files to modify
@app/components/pwa/update-banner.tsx
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor update banner to pill style</name>
  <files>app/components/pwa/update-banner.tsx</files>
  <action>
Refactor the update banner to use subtle pill styling matching the offline indicator.

Current (full-width banner):
```tsx
<div className="fixed top-0 left-0 right-0 z-50 flex items-center justify-center gap-3 bg-primary p-3 text-primary-foreground">
```

Target (subtle pill):
```tsx
<output
  aria-live="polite"
  className="fixed top-4 right-4 z-50 inline-flex items-center gap-2 rounded-full border border-zinc-700 bg-zinc-800/90 px-3 py-1.5 text-sm text-zinc-300 animate-in fade-in"
>
```

Key changes:
1. Change `<div>` to semantic `<output>` element with `aria-live="polite"`
2. Position: `fixed top-4 right-4` (top right corner, away from offline indicator which is bottom-20 right-4)
3. Shape: `rounded-full` pill instead of full-width bar
4. Colors: Match offline indicator - `border-zinc-700 bg-zinc-800/90 text-zinc-300`
5. Animation: Add `animate-in fade-in` for smooth appearance
6. Add RefreshCw icon from lucide-react for visual consistency

Updated component:
```tsx
import { RefreshCw } from "lucide-react";

interface UpdateBannerProps {
  onReload: () => void;
}

/**
 * Subtle pill-style update notification shown when a new service worker is waiting.
 * Positioned top-right to avoid overlap with offline indicator (bottom-right).
 */
export function UpdateBanner({ onReload }: UpdateBannerProps) {
  return (
    <output
      aria-live="polite"
      className="fixed top-4 right-4 z-50 inline-flex items-center gap-2 rounded-full border border-zinc-700 bg-zinc-800/90 px-3 py-1.5 text-sm text-zinc-300 animate-in fade-in"
    >
      <RefreshCw className="h-3.5 w-3.5" aria-hidden="true" />
      <span>Update available</span>
      <button
        type="button"
        onClick={onReload}
        className="rounded-full bg-primary px-2 py-0.5 text-xs font-medium text-primary-foreground hover:bg-primary/90"
      >
        Reload
      </button>
    </output>
  );
}
```
  </action>
  <verify>
- `grep "rounded-full" app/components/pwa/update-banner.tsx` returns match
- `grep "border-zinc-700" app/components/pwa/update-banner.tsx` returns match
- `grep "<output" app/components/pwa/update-banner.tsx` returns match
- `pnpm typecheck` passes
  </verify>
  <done>Update banner uses pill styling matching offline indicator</done>
</task>

<task type="auto">
  <name>Task 2: Update CLAUDE.md documentation</name>
  <files>CLAUDE.md</files>
  <action>
Update CLAUDE.md to reflect current architecture:

1. **Fix Project Map** - Remove sw-register.ts reference (file was deleted in Phase 4):

   Change:
   ```
   app/lib/             # Shared utilities (sw-register.ts, spirit-colors.ts)
   ```

   To:
   ```
   app/lib/             # Shared utilities (spirit-colors.ts, utils.ts)
   ```

2. **Add Client-Only SPA Architecture section** after "Key Patterns":

   ```markdown
   ## Client-Only SPA Architecture

   This app is a pure client-side SPA (switched from TanStack Start SSR in quick-010).

   **Implications:**
   - No server rendering - all code runs in browser
   - Route loaders run client-side (use for prefetching, not data requirements)
   - "use client" directives have no effect (Vite + React, not Next.js)
   - useSyncExternalStore still needs getServerSnapshot for React 18+ concurrency

   **PWA Notes:**
   - Service worker manages static asset caching
   - Convex data cached via TanStack Query + IndexedDB (not SW - WebSocket protocol)
   - typeof window checks in PWA hooks are defensive programming, not SSR handling
   ```

3. **Update Tech Stack description** - The description mentions "graphical opening scrubber" but the app now uses text-based openings:

   Change:
   ```
   Spirit Island companion PWA with offline-first reference library and graphical
   opening scrubber. The scrubber lets users visualize spirit openings turn-by-turn
   with interactive board state.
   ```

   To:
   ```
   Spirit Island companion PWA with offline-first reference library and game tracker.
   Includes text-based turn-by-turn opening guides for spirits.
   ```
  </action>
  <verify>
- `grep "sw-register.ts" CLAUDE.md` returns no match
- `grep "Client-Only SPA" CLAUDE.md` returns match
- `grep "graphical opening scrubber" CLAUDE.md` returns no match
- `grep "text-based turn-by-turn opening guides" CLAUDE.md` returns match
  </verify>
  <done>CLAUDE.md updated with accurate architecture documentation</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` - No TypeScript errors
2. `pnpm lint:fix` - No lint errors
3. `pnpm build` - Build succeeds
4. Manual review: Update banner pill styling matches offline indicator
</verification>

<success_criteria>
- Update banner uses `<output>` element with pill styling (rounded-full, border-zinc-700, bg-zinc-800/90)
- Update banner positioned top-4 right-4 z-50 (away from offline indicator at bottom-20 right-4 z-40)
- CLAUDE.md Project Map shows spirit-colors.ts and utils.ts (not sw-register.ts)
- CLAUDE.md has "Client-Only SPA Architecture" section
- CLAUDE.md description reflects text-based openings (not graphical scrubber)
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06.1-cleanup-thedahancodex/06.1-02-SUMMARY.md`
</output>
