---
phase: 03.3-spirit-board-final-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/spirits/presence-track.tsx
  - app/components/spirits/presence-slot.tsx
autonomous: true

must_haves:
  truths:
    - "Branching track indicator (GitBranch) shows tooltip with connection details"
    - "Unlock track indicator (Sprout) shows tooltip explaining the unlock"
    - "presenceCap slots display the cap value prominently"
    - "presenceCap tooltip explains what the cap means"
    - "Complex spirits (Finder, Starlight, Serpent) render correctly"
  artifacts:
    - path: "app/components/spirits/presence-track.tsx"
      provides: "Enhanced track indicators with Radix Tooltip"
      contains: "TooltipContent"
    - path: "app/components/spirits/presence-slot.tsx"
      provides: "presenceCap display in slots"
      contains: "presenceCap"
  key_links:
    - from: "presence-track.tsx"
      to: "@radix-ui/react-tooltip"
      via: "shadcn Tooltip components"
      pattern: "Tooltip.*TooltipTrigger.*TooltipContent"
    - from: "presence-slot.tsx"
      to: "slot.presenceCap"
      via: "conditional display logic"
      pattern: "presenceCap"
---

<objective>
Enhance presence track visualization for complex spirits with better indicators and presenceCap display.

Purpose: Make branching (Finder), unlock-triggered (Starlight), and capped (Serpent) tracks visually clear with proper tooltips and cap value rendering.
Output: Updated presence-track.tsx with Radix Tooltip for indicators, and presence-slot.tsx with presenceCap display.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.3-spirit-board-final-polish/03.3-RESEARCH.md

@app/components/spirits/presence-track.tsx
@app/components/spirits/presence-slot.tsx
@convex/schema.ts (lines 117-150 for presence track schema)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Upgrade presence track indicators to Radix Tooltip</name>
  <files>app/components/spirits/presence-track.tsx</files>
  <action>
Replace the basic `title` attribute on GitBranch and Sprout icons with proper Radix Tooltip components.

1. Import Tooltip components (already available via shadcn/ui):
```tsx
import {
  Tooltip,
  TooltipContent,
  TooltipTrigger,
} from "@/components/ui/tooltip";
```

2. Update the GitBranch icon (branching track indicator) to use Tooltip:
```tsx
{track.connectsTo && (
  <Tooltip delayDuration={100}>
    <TooltipTrigger asChild>
      <span className="text-muted-foreground cursor-help">
        <GitBranch className="w-3.5 h-3.5" />
      </span>
    </TooltipTrigger>
    <TooltipContent>
      <p className="text-xs">
        Connects to {track.connectsTo} track
        {track.connectionPoint !== undefined && ` at slot ${track.connectionPoint + 1}`}
      </p>
    </TooltipContent>
  </Tooltip>
)}
```

3. Update the Sprout icon (unlock growth indicator) to use Tooltip:
```tsx
{track.unlocksGrowth && (
  <Tooltip delayDuration={100}>
    <TooltipTrigger asChild>
      <span className="text-emerald-400 cursor-help">
        <Sprout className="w-3.5 h-3.5" />
      </span>
    </TooltipTrigger>
    <TooltipContent>
      <p className="text-xs">Unlocks growth options when emptied</p>
    </TooltipContent>
  </Tooltip>
)}
```

Key improvements:
- Use `cursor-help` to indicate hoverable indicator
- Include `connectionPoint + 1` in tooltip (1-indexed for user-friendly display)
- Consistent 100ms delay with other tooltips in the app
  </action>
  <verify>
1. `pnpm typecheck` passes
2. Visit /spirits/finder-of-paths-unseen - hover over GitBranch icon, tooltip shows "Connects to cardPlays track at slot 4"
3. Visit /spirits/starlight-seeks-its-form - hover over Sprout icons, tooltip shows "Unlocks growth options when emptied"
  </verify>
  <done>Track indicators use Radix Tooltip with detailed connection/unlock information</done>
</task>

<task type="auto">
  <name>Task 2: Add presenceCap display to presence slots</name>
  <files>app/components/spirits/presence-slot.tsx</files>
  <action>
Update PresenceSlot component to display presenceCap values and include them in tooltips.

1. Add `presenceCap` to the slot interface:
```tsx
interface PresenceSlotProps {
  slot: {
    value: number | string;
    elements?: string[];
    reclaim?: boolean;
    innateUnlock?: string;
    specialAbility?: string;
    presenceCap?: number; // Add this
  };
  // ... rest unchanged
}
```

2. Update displayValue logic to prioritize presenceCap:
```tsx
// Determine display value - presenceCap takes visual precedence for limit tracks
const displayValue = reclaim ? "R" : (slot.presenceCap !== undefined ? slot.presenceCap : value);
```

3. Add presenceCap info to tooltip:
```tsx
// After specialAbility handling, before rendering
if (slot.presenceCap !== undefined) {
  tooltipLines.push(`Presence limit: ${slot.presenceCap}`);
}
```

4. Add visual styling for presenceCap slots (subtle indicator):
```tsx
// In className of the button, add condition:
slot.presenceCap !== undefined && "border-stone-500/70 bg-stone-500/10 text-stone-300",
```

This gives Serpent's Deep Slumber track a distinct stone/gray appearance to differentiate from energy/card play tracks.
  </action>
  <verify>
1. `pnpm typecheck` passes
2. Visit /spirits/serpent-slumbering-beneath-the-island - Deep Slumber track shows values 5-13
3. Hover over a Deep Slumber slot - tooltip shows "Presence limit: X"
4. Slots have subtle stone/gray styling to differentiate from other tracks
  </verify>
  <done>presenceCap values display in slots with appropriate styling and tooltips</done>
</task>

</tasks>

<verification>
1. Run `pnpm typecheck` - no type errors
2. Run `pnpm build` - build succeeds
3. Browser verification for each complex spirit:

**Finder of Paths Unseen:**
- Navigate to /spirits/finder-of-paths-unseen
- Energy track shows GitBranch icon
- Hover over icon - tooltip shows "Connects to cardPlays track at slot 4"

**Starlight Seeks Its Form:**
- Navigate to /spirits/starlight-seeks-its-form
- Unlock tracks show Sprout icons (4 tracks with this indicator)
- Hover over icon - tooltip shows "Unlocks growth options when emptied"

**Serpent Slumbering Beneath the Island:**
- Navigate to /spirits/serpent-slumbering-beneath-the-island
- Deep Slumber track shows values 5 through 13
- Slots have stone/gray styling
- Hover over slot - tooltip shows "Presence limit: X"
</verification>

<success_criteria>
- Track indicators use Radix Tooltip with 100ms delay
- GitBranch tooltip includes connectionPoint (1-indexed)
- Sprout tooltip explains growth unlock
- presenceCap values displayed prominently in slots
- presenceCap slots have distinct stone/gray styling
- presenceCap info included in slot tooltips
- All complex spirits render their unique patterns correctly
</success_criteria>

<output>
After completion, create `.planning/phases/03.3-spirit-board-final-polish/03.3-02-SUMMARY.md`
</output>
